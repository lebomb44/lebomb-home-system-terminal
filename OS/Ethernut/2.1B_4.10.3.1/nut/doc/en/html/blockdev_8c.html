<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Nut/OS: dev/blockdev.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="nutos_logo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Nut/OS
   &#160;<span id="projectnumber">4.10.3</span>
   </div>
   <div id="projectbrief">API Reference</div>
  </td>
  
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blockdev_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">blockdev.c File Reference</div>  </div>
</div>
<div class="contents">

<p>Generic block I/O device routines.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="os_8h_source.html">cfg/os.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="memory_8h_source.html">cfg/memory.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="blockdev_8h_source.html">dev/blockdev.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="nutdebug_8h_source.html">sys/nutdebug.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="fs_2fs_8h_source.html">fs/fs.h</a>&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="memdebug_8h_source.html">memdebug.h</a>&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for blockdev.c:</div>
<div class="dyncontent">
<div class="center"><img src="blockdev_8c__incl.png" border="0" usemap="#dev_2blockdev_8c" alt=""/></div>
<map name="dev_2blockdev_8c" id="dev_2blockdev_8c">
<area shape="rect" id="node3" href="os_8h.html" title="cfg/os.h" alt="" coords="37,81,101,106"/><area shape="rect" id="node5" href="memory_8h.html" title="Default memory layout." alt="" coords="401,155,497,181"/><area shape="rect" id="node7" href="blockdev_8h.html" title="Block device driver definitions." alt="" coords="178,81,280,106"/><area shape="rect" id="node24" href="nutdebug_8h.html" title="sys/nutdebug.h" alt="" coords="305,81,412,106"/><area shape="rect" id="node28" href="fs_2fs_8h.html" title="File system access." alt="" coords="5,155,59,181"/><area shape="rect" id="node36" href="memdebug_8h.html" title="memdebug.h" alt="" coords="623,81,719,106"/><area shape="rect" id="node9" href="types_8h.html" title="Nut/OS type declarations." alt="" coords="297,305,380,330"/><area shape="rect" id="node15" href="stdint_8h.html" title="stdint.h" alt="" coords="66,230,128,255"/><area shape="rect" id="node17" href="device_8h.html" title="Nut/OS device definitions." alt="" coords="135,155,224,181"/><area shape="rect" id="node19" href="file_8h.html" title="sys/file.h" alt="" coords="179,230,249,255"/><area shape="rect" id="node11" href="compiler_8h.html" title="compiler.h" alt="" coords="501,379,581,405"/></map>
</div>
</div>
<p><a href="blockdev_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct___b_l_o_c_k_v_o_l_u_m_e.html">_BLOCKVOLUME</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Block volume information structure.  <a href="struct___b_l_o_c_k_v_o_l_u_m_e.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct___b_l_o_c_k_v_o_l_u_m_e.html">_BLOCKVOLUME</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blockdev_8c.html#a2044a41fdbb141cf61acd1ef051c3a91">BLOCKVOLUME</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Block volume information structure type.  <a href="#a2044a41fdbb141cf61acd1ef051c3a91"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blockdev_8c.html#a8dff5efbfd16eb8e5469cebdb4a48dd7">NutBlockDeviceInit</a> (<a class="el" href="group__xg_device.html#ga6e44357e76989d8e579d3f65bc3a2741">NUTDEVICE</a> *dev)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the block I/O device.  <a href="#a8dff5efbfd16eb8e5469cebdb4a48dd7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blockdev_8c.html#afffc23aaf619cbd701ae56f1f564add7">NutBlockDeviceOpen</a> (<a class="el" href="group__xg_device.html#ga6e44357e76989d8e579d3f65bc3a2741">NUTDEVICE</a> *dev, CONST char *name, int mode, int acc)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Mount a volume.  <a href="#afffc23aaf619cbd701ae56f1f564add7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blockdev_8c.html#aa2cb41faba478283c8f2d20ecd20f2de">NutBlockDeviceClose</a> (<a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a> *nfp)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Unmount a currently mounted volume.  <a href="#aa2cb41faba478283c8f2d20ecd20f2de"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blockdev_8c.html#a4bf0f1d91269e65455d063c5e202add1">NutBlockDeviceIOCtl</a> (<a class="el" href="group__xg_device.html#ga6e44357e76989d8e579d3f65bc3a2741">NUTDEVICE</a> *dev, int req, void *conf)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform block I/O device control functions.  <a href="#a4bf0f1d91269e65455d063c5e202add1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blockdev_8c.html#a6d4988c118b95110454bc6e5c0b369bd">NutBlockDeviceRead</a> (<a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a> *nfp, void *buffer, int num)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Read data blocks from a mounted volume.  <a href="#a6d4988c118b95110454bc6e5c0b369bd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blockdev_8c.html#a06d1a07ba0114de8976c9eb814b448df">NutBlockDeviceWrite</a> (<a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a> *nfp, CONST void *buffer, int num)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Write data blocks to a mounted volume.  <a href="#a06d1a07ba0114de8976c9eb814b448df"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blockdev_8c.html#a38e4c131ecf1add88ecf497563483ddd">NutBlockDeviceWrite_P</a> (<a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a> *nfp, PGM_P buffer, int num)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Write data blocks from program space to a mounted volume.  <a href="#a38e4c131ecf1add88ecf497563483ddd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="blockdev_8c.html#ad65b4cb4433a4cde45dce7cbb8fd3333">NutBlockDeviceSize</a> (<a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a> *nfp)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the size of a mounted volume.  <a href="#ad65b4cb4433a4cde45dce7cbb8fd3333"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Generic block I/O device routines. </p>
<div class="fragment"><pre class="fragment">
 * $Id: blockdev.c 2463 2009-02-13 14:52:05Z haraldkipp $
 * </pre></div> 
<p>Definition in file <a class="el" href="blockdev_8c_source.html">blockdev.c</a>.</p>
</div><hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a2044a41fdbb141cf61acd1ef051c3a91"></a><!-- doxytag: member="blockdev.c::BLOCKVOLUME" ref="a2044a41fdbb141cf61acd1ef051c3a91" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct___b_l_o_c_k_v_o_l_u_m_e.html">_BLOCKVOLUME</a> <a class="el" href="blockdev_8c.html#a2044a41fdbb141cf61acd1ef051c3a91">BLOCKVOLUME</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Block volume information structure type. </p>

<p>Definition at line <a class="el" href="blockdev_8c_source.html#l00059">59</a> of file <a class="el" href="blockdev_8c_source.html">blockdev.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a8dff5efbfd16eb8e5469cebdb4a48dd7"></a><!-- doxytag: member="blockdev.c::NutBlockDeviceInit" ref="a8dff5efbfd16eb8e5469cebdb4a48dd7" args="(NUTDEVICE *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutBlockDeviceInit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_device.html#ga6e44357e76989d8e579d3f65bc3a2741">NUTDEVICE</a> *&#160;</td>
          <td class="paramname"><em>dev</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize the block I/O device. </p>
<p>This dummy routine may be used by drivers, which do not need any specific initialization.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">dev</td><td>Specifies the device.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Always 0. </dd></dl>

<p>Definition at line <a class="el" href="blockdev_8c_source.html#l00131">131</a> of file <a class="el" href="blockdev_8c_source.html">blockdev.c</a>.</p>

<p>References <a class="el" href="nutdebug_8h_source.html#l00047">NUTASSERT</a>.</p>

</div>
</div>
<a class="anchor" id="afffc23aaf619cbd701ae56f1f564add7"></a><!-- doxytag: member="blockdev.c::NutBlockDeviceOpen" ref="afffc23aaf619cbd701ae56f1f564add7" args="(NUTDEVICE *dev, CONST char *name, int mode, int acc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a>* NutBlockDeviceOpen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_device.html#ga6e44357e76989d8e579d3f65bc3a2741">NUTDEVICE</a> *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CONST char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>acc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mount a volume. </p>
<p>Nut/OS doesn't provide specific routines for mounting. Instead routines for opening files are used.</p>
<p>Applications should not directly call this function, but use the high level stdio routines for opening a file.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">dev</td><td>Specifies the block I/O device. </td></tr>
    <tr><td class="paramname">name</td><td>Partition number followed by a slash followed by a name of the file system device. Both items are optional. If no file system driver name is given, the first file system driver found in the list of registered devices will be used. If no partition number is specified or if partition zero is given, the first active primary partition will be used. </td></tr>
    <tr><td class="paramname">mode</td><td>Opening mode. Currently ignored, but <div class="fragment"><pre class="fragment"> <a class="code" href="group__xg_crt_lowio.html#ga010187fb7398870cb57af650e65bded1">_O_RDWR</a> | <a class="code" href="group__xg_crt_lowio.html#ga166a079a4990ddeb0a32475728bbacd0">_O_BINARY</a> 
</pre></div> should be used for compatibility with future enhancements. </td></tr>
    <tr><td class="paramname">acc</td><td>File attributes, ignored.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Pointer to a newly created file pointer to the mounted partition or NUTFILE_EOF in case of any error. </dd></dl>

<p>Definition at line <a class="el" href="blockdev_8c_source.html#l00163">163</a> of file <a class="el" href="blockdev_8c_source.html">blockdev.c</a>.</p>

<p>References <a class="el" href="blockdev_8h_source.html#l00128">_NUTBLOCKIO::blkio_blk_cnt</a>, <a class="el" href="blockdev_8h_source.html#l00133">_NUTBLOCKIO::blkio_blk_siz</a>, <a class="el" href="blockdev_8h_source.html#l00138">_NUTBLOCKIO::blkio_vol_bot</a>, <a class="el" href="blockdev_8h_source.html#l00143">_NUTBLOCKIO::blkio_vol_top</a>, <a class="el" href="device_8h_source.html#l00216">_NUTDEVICE::dev_dcb</a>, <a class="el" href="device_8h_source.html#l00230">_NUTDEVICE::dev_ioctl</a>, <a class="el" href="errno_8h_source.html#l00072">ENODEV</a>, <a class="el" href="errno_8c_source.html#l00042">errno</a>, <a class="el" href="malloc_8c_source.html#l00084">free()</a>, <a class="el" href="fs_2fs_8h_source.html#l00123">FS_VOL_MOUNT</a>, <a class="el" href="fs_2fs_8h_source.html#l00153">_FSCP_VOL_MOUNT::fscp_bmnt</a>, <a class="el" href="fs_2fs_8h_source.html#l00155">_FSCP_VOL_MOUNT::fscp_part_type</a>, <a class="el" href="device_8h_source.html#l00143">IFTYP_FS</a>, <a class="el" href="malloc_8c_source.html#l00064">malloc()</a>, <a class="el" href="file_8h_source.html#l00080">_NUTFILE::nf_dev</a>, <a class="el" href="file_8h_source.html#l00085">_NUTFILE::nf_fcb</a>, <a class="el" href="file_8h_source.html#l00075">_NUTFILE::nf_next</a>, <a class="el" href="nutdebug_8h_source.html#l00047">NUTASSERT</a>, <a class="el" href="devreg_8c_source.html#l00090">NutDeviceLookup()</a>, <a class="el" href="file_8h_source.html#l00088">NUTFILE_EOF</a>, <a class="el" href="blockdev_8c_source.html#l00099">_BLOCKVOLUME::vol_blk_buf</a>, <a class="el" href="blockdev_8c_source.html#l00071">_BLOCKVOLUME::vol_blk_cnt</a>, <a class="el" href="blockdev_8c_source.html#l00075">_BLOCKVOLUME::vol_blk_len</a>, <a class="el" href="blockdev_8c_source.html#l00088">_BLOCKVOLUME::vol_blk_num</a>, <a class="el" href="blockdev_8c_source.html#l00079">_BLOCKVOLUME::vol_blk_off</a>, and <a class="el" href="blockdev_8c_source.html#l00067">_BLOCKVOLUME::vol_fsdev</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="blockdev_8c_afffc23aaf619cbd701ae56f1f564add7_cgraph.png" border="0" usemap="#blockdev_8c_afffc23aaf619cbd701ae56f1f564add7_cgraph" alt=""/></div>
<map name="blockdev_8c_afffc23aaf619cbd701ae56f1f564add7_cgraph" id="blockdev_8c_afffc23aaf619cbd701ae56f1f564add7_cgraph">
<area shape="rect" id="node3" href="group__xg_heap.html#ga9f850d0608418aea291e4c0fdab93826" title="Return a block to heap memory." alt="" coords="231,5,273,30"/><area shape="rect" id="node5" href="group__xg_heap.html#ga381d0a123dbf80ca3efe2614aa826e08" title="Allocate a block from heap memory." alt="" coords="223,54,281,79"/><area shape="rect" id="node7" href="group__xg_device.html#ga913130771bea4118ae58e2a0ccb50a4d" title="Find device entry by name." alt="" coords="193,103,311,129"/><area shape="rect" id="node9" href="group__xg_crt_string.html#gaafa356ff1e215725834bc57e8e4fae60" title="Compare two strings." alt="" coords="361,103,421,129"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa2cb41faba478283c8f2d20ecd20f2de"></a><!-- doxytag: member="blockdev.c::NutBlockDeviceClose" ref="aa2cb41faba478283c8f2d20ecd20f2de" args="(NUTFILE *nfp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutBlockDeviceClose </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a> *&#160;</td>
          <td class="paramname"><em>nfp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unmount a currently mounted volume. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">nfp</td><td>File pointer to a previously mounted volume.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="blockdev_8c_source.html#l00241">241</a> of file <a class="el" href="blockdev_8c_source.html">blockdev.c</a>.</p>

<p>References <a class="el" href="device_8h_source.html#l00230">_NUTDEVICE::dev_ioctl</a>, <a class="el" href="malloc_8c_source.html#l00084">free()</a>, <a class="el" href="fs_2fs_8h_source.html#l00124">FS_VOL_UNMOUNT</a>, <a class="el" href="file_8h_source.html#l00085">_NUTFILE::nf_fcb</a>, <a class="el" href="nutdebug_8h_source.html#l00047">NUTASSERT</a>, and <a class="el" href="blockdev_8c_source.html#l00067">_BLOCKVOLUME::vol_fsdev</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="blockdev_8c_aa2cb41faba478283c8f2d20ecd20f2de_cgraph.png" border="0" usemap="#blockdev_8c_aa2cb41faba478283c8f2d20ecd20f2de_cgraph" alt=""/></div>
<map name="blockdev_8c_aa2cb41faba478283c8f2d20ecd20f2de_cgraph" id="blockdev_8c_aa2cb41faba478283c8f2d20ecd20f2de_cgraph">
<area shape="rect" id="node3" href="group__xg_heap.html#ga9f850d0608418aea291e4c0fdab93826" title="Return a block to heap memory." alt="" coords="195,5,237,30"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4bf0f1d91269e65455d063c5e202add1"></a><!-- doxytag: member="blockdev.c::NutBlockDeviceIOCtl" ref="a4bf0f1d91269e65455d063c5e202add1" args="(NUTDEVICE *dev, int req, void *conf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutBlockDeviceIOCtl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_device.html#ga6e44357e76989d8e579d3f65bc3a2741">NUTDEVICE</a> *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>conf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Perform block I/O device control functions. </p>
<p>This function is called by the ioctl() function of the C runtime library. Applications should not directly call this function.</p>
<p>Unkown requests are passed to the block I/O device.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">dev</td><td>Identifies the device that receives the device-control function. </td></tr>
    <tr><td class="paramname">req</td><td>Requested control function. May be set to one of the following constants:<ul>
<li><a class="el" href="group__xg_block_dev.html#ga4bbfed5ff6ce9e59e382558829f3c8ff">NUTBLKDEV_INFO</a>, conf points to a <a class="el" href="group__xg_block_dev.html#ga55168d7061d799d74a492b0756f2a8f8">BLKPAR_INFO</a> structure.</li>
<li><a class="el" href="group__xg_block_dev.html#ga2c6a77c523c97bfc14789c8ab369fe58">NUTBLKDEV_SEEK</a>, conf points to a <a class="el" href="group__xg_block_dev.html#ga7db3bee8199e18b65c1609b8a2bc37eb">BLKPAR_SEEK</a> structure.</li>
</ul>
</td></tr>
    <tr><td class="paramname">conf</td><td>Points to a buffer that contains any data required for the given control function or receives data from that function.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="blockdev_8c_source.html#l00280">280</a> of file <a class="el" href="blockdev_8c_source.html">blockdev.c</a>.</p>

<p>References <a class="el" href="blockdev_8h_source.html#l00165">_NUTBLOCKIO::blkio_ioctl</a>, <a class="el" href="device_8h_source.html#l00216">_NUTDEVICE::dev_dcb</a>, <a class="el" href="file_8h_source.html#l00085">_NUTFILE::nf_fcb</a>, <a class="el" href="nutdebug_8h_source.html#l00047">NUTASSERT</a>, <a class="el" href="blockdev_8h_source.html#l00080">NUTBLKDEV_INFO</a>, <a class="el" href="blockdev_8h_source.html#l00082">NUTBLKDEV_SEEK</a>, <a class="el" href="blockdev_8h_source.html#l00105">_BLKPAR_INFO::par_blkbp</a>, <a class="el" href="blockdev_8h_source.html#l00093">_BLKPAR_SEEK::par_blknum</a>, <a class="el" href="blockdev_8h_source.html#l00104">_BLKPAR_INFO::par_blksz</a>, <a class="el" href="blockdev_8h_source.html#l00103">_BLKPAR_INFO::par_nblks</a>, <a class="el" href="blockdev_8h_source.html#l00092">_BLKPAR_SEEK::par_nfp</a>, <a class="el" href="blockdev_8h_source.html#l00102">_BLKPAR_INFO::par_nfp</a>, <a class="el" href="blockdev_8c_source.html#l00099">_BLOCKVOLUME::vol_blk_buf</a>, <a class="el" href="blockdev_8c_source.html#l00071">_BLOCKVOLUME::vol_blk_cnt</a>, <a class="el" href="blockdev_8c_source.html#l00075">_BLOCKVOLUME::vol_blk_len</a>, and <a class="el" href="blockdev_8c_source.html#l00088">_BLOCKVOLUME::vol_blk_num</a>.</p>

</div>
</div>
<a class="anchor" id="a6d4988c118b95110454bc6e5c0b369bd"></a><!-- doxytag: member="blockdev.c::NutBlockDeviceRead" ref="a6d4988c118b95110454bc6e5c0b369bd" args="(NUTFILE *nfp, void *buffer, int num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutBlockDeviceRead </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a> *&#160;</td>
          <td class="paramname"><em>nfp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read data blocks from a mounted volume. </p>
<p>The current position may have been set by a previous I/O control <a class="el" href="group__xg_block_dev.html#ga2c6a77c523c97bfc14789c8ab369fe58">NUTBLKDEV_SEEK</a>.</p>
<p>Applications should not call this function directly, but use the stdio interface.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">nfp</td><td>File pointer to a previously mounted volume. </td></tr>
    <tr><td class="paramname">buffer</td><td>Pointer to the data buffer to fill. </td></tr>
    <tr><td class="paramname">num</td><td>Number of blocks to read.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of blocks actually read. The current position is set to the next unread block. A return value of -1 indicates an error. </dd></dl>

<p>Definition at line <a class="el" href="blockdev_8c_source.html#l00348">348</a> of file <a class="el" href="blockdev_8c_source.html">blockdev.c</a>.</p>

<p>References <a class="el" href="blockdev_8h_source.html#l00148">_NUTBLOCKIO::blkio_read</a>, <a class="el" href="device_8h_source.html#l00216">_NUTDEVICE::dev_dcb</a>, <a class="el" href="file_8h_source.html#l00080">_NUTFILE::nf_dev</a>, <a class="el" href="file_8h_source.html#l00085">_NUTFILE::nf_fcb</a>, <a class="el" href="nutdebug_8h_source.html#l00047">NUTASSERT</a>, <a class="el" href="blockdev_8c_source.html#l00071">_BLOCKVOLUME::vol_blk_cnt</a>, <a class="el" href="blockdev_8c_source.html#l00075">_BLOCKVOLUME::vol_blk_len</a>, <a class="el" href="blockdev_8c_source.html#l00088">_BLOCKVOLUME::vol_blk_num</a>, and <a class="el" href="blockdev_8c_source.html#l00079">_BLOCKVOLUME::vol_blk_off</a>.</p>

</div>
</div>
<a class="anchor" id="a06d1a07ba0114de8976c9eb814b448df"></a><!-- doxytag: member="blockdev.c::NutBlockDeviceWrite" ref="a06d1a07ba0114de8976c9eb814b448df" args="(NUTFILE *nfp, CONST void *buffer, int num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutBlockDeviceWrite </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a> *&#160;</td>
          <td class="paramname"><em>nfp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CONST void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write data blocks to a mounted volume. </p>
<p>The current position may have been set by a previous I/O control <a class="el" href="group__xg_block_dev.html#ga2c6a77c523c97bfc14789c8ab369fe58">NUTBLKDEV_SEEK</a>.</p>
<p>Applications should not call this function directly, but use the stdio interface.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">nfp</td><td>File pointer to a previously mounted volume. </td></tr>
    <tr><td class="paramname">buffer</td><td>Pointer to the data to be written. </td></tr>
    <tr><td class="paramname">num</td><td>Number of blocks to write.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of blocks actually written. The current position is set to the next block. A return value of -1 indicates an error. </dd></dl>

<p>Definition at line <a class="el" href="blockdev_8c_source.html#l00400">400</a> of file <a class="el" href="blockdev_8c_source.html">blockdev.c</a>.</p>

<p>References <a class="el" href="blockdev_8h_source.html#l00153">_NUTBLOCKIO::blkio_write</a>, <a class="el" href="arm_8h_source.html#l00143">CONST</a>, <a class="el" href="device_8h_source.html#l00216">_NUTDEVICE::dev_dcb</a>, <a class="el" href="file_8h_source.html#l00080">_NUTFILE::nf_dev</a>, <a class="el" href="file_8h_source.html#l00085">_NUTFILE::nf_fcb</a>, <a class="el" href="nutdebug_8h_source.html#l00047">NUTASSERT</a>, <a class="el" href="blockdev_8c_source.html#l00071">_BLOCKVOLUME::vol_blk_cnt</a>, <a class="el" href="blockdev_8c_source.html#l00075">_BLOCKVOLUME::vol_blk_len</a>, <a class="el" href="blockdev_8c_source.html#l00088">_BLOCKVOLUME::vol_blk_num</a>, and <a class="el" href="blockdev_8c_source.html#l00079">_BLOCKVOLUME::vol_blk_off</a>.</p>

</div>
</div>
<a class="anchor" id="a38e4c131ecf1add88ecf497563483ddd"></a><!-- doxytag: member="blockdev.c::NutBlockDeviceWrite_P" ref="a38e4c131ecf1add88ecf497563483ddd" args="(NUTFILE *nfp, PGM_P buffer, int num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutBlockDeviceWrite_P </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a> *&#160;</td>
          <td class="paramname"><em>nfp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGM_P&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write data blocks from program space to a mounted volume. </p>
<p>Similar to <a class="el" href="blockdev_8h.html#a06d1a07ba0114de8976c9eb814b448df" title="Write data blocks to a mounted volume.">NutBlockDeviceWrite()</a> except that the data is located in program memory.</p>
<p>Applications should not call this function directly, but use the stdio interface.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">nfp</td><td>File pointer to a previously mounted volume. </td></tr>
    <tr><td class="paramname">buffer</td><td>Pointer to the data bytes in program space to be written. </td></tr>
    <tr><td class="paramname">num</td><td>Number of blocks to write.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of blocks actually written. The current position is set to the next block. A return value of -1 indicates an error. </dd></dl>

<p>Definition at line <a class="el" href="blockdev_8c_source.html#l00452">452</a> of file <a class="el" href="blockdev_8c_source.html">blockdev.c</a>.</p>

<p>References <a class="el" href="blockdev_8h_source.html#l00153">_NUTBLOCKIO::blkio_write</a>, <a class="el" href="blockdev_8h_source.html#l00159">_NUTBLOCKIO::blkio_write_P</a>, <a class="el" href="device_8h_source.html#l00216">_NUTDEVICE::dev_dcb</a>, <a class="el" href="file_8h_source.html#l00080">_NUTFILE::nf_dev</a>, <a class="el" href="file_8h_source.html#l00085">_NUTFILE::nf_fcb</a>, <a class="el" href="nutdebug_8h_source.html#l00047">NUTASSERT</a>, <a class="el" href="arm_8h_source.html#l00158">PGM_P</a>, <a class="el" href="blockdev_8c_source.html#l00071">_BLOCKVOLUME::vol_blk_cnt</a>, <a class="el" href="blockdev_8c_source.html#l00075">_BLOCKVOLUME::vol_blk_len</a>, <a class="el" href="blockdev_8c_source.html#l00088">_BLOCKVOLUME::vol_blk_num</a>, and <a class="el" href="blockdev_8c_source.html#l00079">_BLOCKVOLUME::vol_blk_off</a>.</p>

</div>
</div>
<a class="anchor" id="ad65b4cb4433a4cde45dce7cbb8fd3333"></a><!-- doxytag: member="blockdev.c::NutBlockDeviceSize" ref="ad65b4cb4433a4cde45dce7cbb8fd3333" args="(NUTFILE *nfp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long NutBlockDeviceSize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_device.html#ga66d4b4dd6b81551dadfe12d452ec4455">NUTFILE</a> *&#160;</td>
          <td class="paramname"><em>nfp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the size of a mounted volume. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">nfp</td><td>File pointer to a previously mounted volume.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Total number of bytes. </dd></dl>

<p>Definition at line <a class="el" href="blockdev_8c_source.html#l00495">495</a> of file <a class="el" href="blockdev_8c_source.html">blockdev.c</a>.</p>

<p>References <a class="el" href="file_8h_source.html#l00085">_NUTFILE::nf_fcb</a>, <a class="el" href="nutdebug_8h_source.html#l00047">NUTASSERT</a>, <a class="el" href="blockdev_8c_source.html#l00071">_BLOCKVOLUME::vol_blk_cnt</a>, and <a class="el" href="blockdev_8c_source.html#l00075">_BLOCKVOLUME::vol_blk_len</a>.</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="blockdev_8c.html">blockdev.c</a>      </li>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr>
<address>
  <small>
    &copy;&nbsp;2000-2010 by contributors - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
