<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
    <link href="nut_entabs.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.5.8 -->
  <div class="navpath"><a class="el" href="dir_62cc943d9a5c6ffd14cbda02228b93ec.html">dev</a>
  </div>
<div class="contents">
<h1>spibus.c File Reference</h1>Generic SPI bus driver routines.  
<a href="#_details">More...</a>
<p>

<p>
<a href="spibus_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spibus_8c.html#9f84b1e3e0d80febca1d2071b04f6fc7">NutRegisterSpiDevice</a> (NUTDEVICE *dev, NUTSPIBUS *bus, int cs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register and initialize an SPI device attached to a specified bus.  <a href="#9f84b1e3e0d80febca1d2071b04f6fc7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spibus_8c.html#fc8436860a2eb534dac97cdd3e595c95">NutSpiBusWait</a> (NUTSPINODE *node, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> tmo)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait until all SPI bus transfers are done.  <a href="#fc8436860a2eb534dac97cdd3e595c95"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="stdint_8h.html#6ed085329b153773ff76afa0702cf897">uint_fast16_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spibus_8c.html#97c4e8b5edd13bcbbe447b1f88c43506">NutSpiBusSetMode</a> (NUTSPINODE *node, <a class="el" href="stdint_8h.html#6ed085329b153773ff76afa0702cf897">uint_fast16_t</a> mode)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set SPI mode of a specified bus device.  <a href="#97c4e8b5edd13bcbbe447b1f88c43506"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="stdint_8h.html#8f075c759c74e109e8184306c663809d">uint_fast32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spibus_8c.html#75bb7de2545f6b22c2466fb9d9d188c3">NutSpiBusSetRate</a> (NUTSPINODE *node, <a class="el" href="stdint_8h.html#8f075c759c74e109e8184306c663809d">uint_fast32_t</a> rate)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set clock rate of a specified SPI device.  <a href="#75bb7de2545f6b22c2466fb9d9d188c3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="stdint_8h.html#d0fca8b15c218d2c687f8c373a71d228">uint_fast8_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spibus_8c.html#a29c28c7b0a5ceb06ddbacef4d88edf6">NutSpiBusSetBits</a> (NUTSPINODE *node, <a class="el" href="stdint_8h.html#d0fca8b15c218d2c687f8c373a71d228">uint_fast8_t</a> bits)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set clock rate of a specified SPI device.  <a href="#a29c28c7b0a5ceb06ddbacef4d88edf6"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Generic SPI bus driver routines. 
<p>
<div class="fragment"><pre class="fragment">
 * $Id: spibus.c 2375 2009-01-09 17:54:38Z haraldkipp $
 * </pre></div> 
<p>Definition in file <a class="el" href="spibus_8c-source.html">spibus.c</a>.</p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="9f84b1e3e0d80febca1d2071b04f6fc7"></a><!-- doxytag: member="spibus.c::NutRegisterSpiDevice" ref="9f84b1e3e0d80febca1d2071b04f6fc7" args="(NUTDEVICE *dev, NUTSPIBUS *bus, int cs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutRegisterSpiDevice           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NUTSPIBUS *&nbsp;</td>
          <td class="paramname"> <em>bus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Register and initialize an SPI device attached to a specified bus. 
<p>
Calls the bus controller initialization and, if successful, initializes the SPI device and adds it to the system device list.<p>
Applications should call this function during initialization for each SPI device they intend to use.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Pointer to the NUTDEVICE structure, which is provided by the device driver. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bus</em>&nbsp;</td><td>Pointer to the NUTSPIBUS structure, which is provided by the bus controller driver. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cs</em>&nbsp;</td><td>Zero based chip select number for this device. Must be set to 0, if only one device is attached to the bus and no chip select line is provided.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if the device has been registered for the first time and the initialization was successful. The function returns -1, if any device with the same name had been registered previously, if the NUTDEVICE structure or the chip select is invalid or if the device or bus controller initialization failed. </dd></dl>

<p>Definition at line <a class="el" href="spibus_8c-source.html#l00072">72</a> of file <a class="el" href="spibus_8c-source.html">spibus.c</a>.</p>

<p>References <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>, <a class="el" href="event_8c-source.html#l00454">NutEventPost()</a>, and <a class="el" href="devreg_8c-source.html#l00129">NutRegisterDevice()</a>.</p>

</div>
</div><p>
<a class="anchor" name="fc8436860a2eb534dac97cdd3e595c95"></a><!-- doxytag: member="spibus.c::NutSpiBusWait" ref="fc8436860a2eb534dac97cdd3e595c95" args="(NUTSPINODE *node, uint32_t tmo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutSpiBusWait           </td>
          <td>(</td>
          <td class="paramtype">NUTSPINODE *&nbsp;</td>
          <td class="paramname"> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>tmo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Wait until all SPI bus transfers are done. 
<p>
This dummy function is used by SPI device drivers, which do not provide asynchronous transfers.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>node</em>&nbsp;</td><td>Specifies the SPI bus node. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tmo</em>&nbsp;</td><td>Timeout in milliseconds. To disable timeout, set this parameter to NUT_WAIT_INFINITE.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Always 0. </dd></dl>

<p>Definition at line <a class="el" href="spibus_8c-source.html#l00111">111</a> of file <a class="el" href="spibus_8c-source.html">spibus.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="97c4e8b5edd13bcbbe447b1f88c43506"></a><!-- doxytag: member="spibus.c::NutSpiBusSetMode" ref="97c4e8b5edd13bcbbe447b1f88c43506" args="(NUTSPINODE *node, uint_fast16_t mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#6ed085329b153773ff76afa0702cf897">uint_fast16_t</a> NutSpiBusSetMode           </td>
          <td>(</td>
          <td class="paramtype">NUTSPINODE *&nbsp;</td>
          <td class="paramname"> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#6ed085329b153773ff76afa0702cf897">uint_fast16_t</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set SPI mode of a specified bus device. 
<p>
The new mode will be used during the next transfer. If its value is SPI_CURRENT_MODE, then the mode is not updated. This can be used to query the current mode.<p>
Otherwise this parameter may be the or'ed combination of the following bits:<p>
<ul>
<li>SPI_MODE_CPHA: Data updated on leading edge.</li><li>SPI_MODE_CPOL: Idle clock is high.</li><li>SPI_MODE_FAULT: Enables mode fault detection.</li><li>SPI_MODE_LOOPBACK: Loopback mode.</li><li>SPI_MODE_SLAVE: Slave mode.</li><li>SPI_MODE_CSKEEP: Chip select remains active after transfer.</li><li>SPI_MODE_CSDEC: Decoded chip selects.</li><li>SPI_MODE_CSHIGH: Chip select is high active.</li></ul>
<p>
Be aware, that SPI drivers may have implemented a subset only.<p>
Instead of SPI_MODE_CPHA and SPI_MODE_CPOL one of the following mode numbers may be used:<p>
<ul>
<li>SPI_MODE_0: Idle clock is low and data is captured on the rising edge.</li><li>SPI_MODE_1: Idle clock is low and data is captured on the falling edge.</li><li>SPI_MODE_2: Idle clock is high and data is captured on the falling edge.</li><li>SPI_MODE_3: Idle clock is high and data is captured on the rising edge.</li></ul>
<p>
The return value may additionally contain the bit SPI_MODE_UPDATE, which indicates that here had been no transfer since the last mode update.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>node</em>&nbsp;</td><td>Specifies the SPI bus node. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>New mode.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Old mode. </dd></dl>

<p>Definition at line <a class="el" href="spibus_8c-source.html#l00154">154</a> of file <a class="el" href="spibus_8c-source.html">spibus.c</a>.</p>

<p>References <a class="el" href="spibus_8h-source.html#l00050">SPI_CURRENT_MODE</a>, and <a class="el" href="spibus_8h-source.html#l00060">SPI_MODE_UPDATE</a>.</p>

</div>
</div><p>
<a class="anchor" name="75bb7de2545f6b22c2466fb9d9d188c3"></a><!-- doxytag: member="spibus.c::NutSpiBusSetRate" ref="75bb7de2545f6b22c2466fb9d9d188c3" args="(NUTSPINODE *node, uint_fast32_t rate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#8f075c759c74e109e8184306c663809d">uint_fast32_t</a> NutSpiBusSetRate           </td>
          <td>(</td>
          <td class="paramtype">NUTSPINODE *&nbsp;</td>
          <td class="paramname"> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#8f075c759c74e109e8184306c663809d">uint_fast32_t</a>&nbsp;</td>
          <td class="paramname"> <em>rate</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set clock rate of a specified SPI device. 
<p>
The new clock rate will be used for the next transfer. If the given rate is beyond the capabilities of the bus controller, it will automatically adjusted before the transfer starts.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>node</em>&nbsp;</td><td>Specifies the SPI bus node. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rate</em>&nbsp;</td><td>New clock rate, given in bits per second. If the value is SPI_CURRENT_RATE, then the current rate is kept.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Previous rate. </dd></dl>

<p>Definition at line <a class="el" href="spibus_8c-source.html#l00177">177</a> of file <a class="el" href="spibus_8c-source.html">spibus.c</a>.</p>

<p>References <a class="el" href="spibus_8h-source.html#l00068">SPI_CURRENT_RATE</a>, and <a class="el" href="spibus_8h-source.html#l00060">SPI_MODE_UPDATE</a>.</p>

</div>
</div><p>
<a class="anchor" name="a29c28c7b0a5ceb06ddbacef4d88edf6"></a><!-- doxytag: member="spibus.c::NutSpiBusSetBits" ref="a29c28c7b0a5ceb06ddbacef4d88edf6" args="(NUTSPINODE *node, uint_fast8_t bits)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#d0fca8b15c218d2c687f8c373a71d228">uint_fast8_t</a> NutSpiBusSetBits           </td>
          <td>(</td>
          <td class="paramtype">NUTSPINODE *&nbsp;</td>
          <td class="paramname"> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#d0fca8b15c218d2c687f8c373a71d228">uint_fast8_t</a>&nbsp;</td>
          <td class="paramname"> <em>bits</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set clock rate of a specified SPI device. 
<p>
The new clock rate will be used for the next transfer. If the given rate is beyond the capabilities of the bus controller, it will automatically adjusted before the transfer starts.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>node</em>&nbsp;</td><td>Specifies the SPI bus node. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rate</em>&nbsp;</td><td>New clock rate, given in bits per second. If the value is SPI_CURRENT_RATE, then the current rate is kept.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Previous rate. </dd></dl>

<p>Definition at line <a class="el" href="spibus_8c-source.html#l00201">201</a> of file <a class="el" href="spibus_8c-source.html">spibus.c</a>.</p>

<p>References <a class="el" href="spibus_8h-source.html#l00070">SPI_CURRENT_BITS</a>, and <a class="el" href="spibus_8h-source.html#l00060">SPI_MODE_UPDATE</a>.</p>

</div>
</div><p>
</div>
<hr>
<address>
  <small>
    &copy;&nbsp;2000-2007 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
