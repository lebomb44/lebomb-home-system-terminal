<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
    <link href="nut_entabs.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.5.8 -->
  <div class="navpath"><a class="el" href="dir_264e76a43993b4d38befcb6805fdec2d.html">arch</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_c85b06fcc0a6fafa3c0bec08eff683af.html">arm</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_569058a3be4f46594faf73e74adc92db.html">dev</a>
  </div>
<div class="contents">
<h1>spibus_at91.c File Reference</h1>General AT91 SPI bus controller routines.  
<a href="#_details">More...</a>
<p>

<p>
<a href="spibus__at91_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spibus__at91_8c.html#38b8d567d061f3aa951b3d8bf00cd030">At91SpiSetup</a> (NUTSPINODE *node)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update SPI shadow registers.  <a href="#38b8d567d061f3aa951b3d8bf00cd030"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spibus__at91_8c.html#e0f09c730d68917daa4c9c8b0a69e102">At91SpiBusNodeInit</a> (NUTSPINODE *node)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize an SPI bus node.  <a href="#e0f09c730d68917daa4c9c8b0a69e102"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spibus__at91_8c.html#1491afa859a173c6ab44a4528e9a30ad">At91SpiBusWait</a> (NUTSPINODE *node, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> tmo)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait until all SPI bus transfers are done.  <a href="#1491afa859a173c6ab44a4528e9a30ad"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
General AT91 SPI bus controller routines. 
<p>
<div class="fragment"><pre class="fragment">
 * $Id: spibus_at91.c 2468 2009-02-17 09:30:38Z haraldkipp $
 * </pre></div> 
<p>Definition in file <a class="el" href="spibus__at91_8c-source.html">spibus_at91.c</a>.</p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="38b8d567d061f3aa951b3d8bf00cd030"></a><!-- doxytag: member="spibus_at91.c::At91SpiSetup" ref="38b8d567d061f3aa951b3d8bf00cd030" args="(NUTSPINODE *node)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int At91SpiSetup           </td>
          <td>(</td>
          <td class="paramtype">NUTSPINODE *&nbsp;</td>
          <td class="paramname"> <em>node</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Update SPI shadow registers. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>node</em>&nbsp;</td><td>Specifies the SPI bus node.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Always 0. </dd></dl>

<p>Definition at line <a class="el" href="spibus__at91_8c-source.html#l00072">72</a> of file <a class="el" href="spibus__at91_8c-source.html">spibus_at91.c</a>.</p>

<p>References <a class="el" href="sys_2timer_8h-source.html#l00160">NUT_HWCLK_PERIPHERAL</a>, <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>, <a class="el" href="sys_2timer_8h-source.html#l00200">NutClockGet</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00117">SPI_BITS</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00127">SPI_BITS_LSB</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00114">SPI_CPOL</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00116">SPI_CSAAT</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00060">SPI_LLB</a>, <a class="el" href="spibus_8h-source.html#l00052">SPI_MODE_CPHA</a>, <a class="el" href="spibus_8h-source.html#l00053">SPI_MODE_CPOL</a>, <a class="el" href="spibus_8h-source.html#l00057">SPI_MODE_CSKEEP</a>, <a class="el" href="spibus_8h-source.html#l00054">SPI_MODE_FAULT</a>, <a class="el" href="spibus_8h-source.html#l00055">SPI_MODE_LOOPBACK</a>, <a class="el" href="spibus_8h-source.html#l00060">SPI_MODE_UPDATE</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00059">SPI_MODFDIS</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00115">SPI_NCPHA</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00128">SPI_SCBR</a>, and <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00129">SPI_SCBR_LSB</a>.</p>

<p>Referenced by <a class="el" href="spibus0at91_8c-source.html#l00185">At91SpiBus0Select()</a>, and <a class="el" href="spibus__at91_8c-source.html#l00137">At91SpiBusNodeInit()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e0f09c730d68917daa4c9c8b0a69e102"></a><!-- doxytag: member="spibus_at91.c::At91SpiBusNodeInit" ref="e0f09c730d68917daa4c9c8b0a69e102" args="(NUTSPINODE *node)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int At91SpiBusNodeInit           </td>
          <td>(</td>
          <td class="paramtype">NUTSPINODE *&nbsp;</td>
          <td class="paramname"> <em>node</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize an SPI bus node. 
<p>
This routine is called for each SPI node, which is registered via <a class="el" href="spibus_8h.html#9f84b1e3e0d80febca1d2071b04f6fc7" title="Register and initialize an SPI device attached to a specified bus.">NutRegisterSpiDevice()</a>.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>node</em>&nbsp;</td><td>Specifies the SPI bus node.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success or -1 if there is no valid chip select. </dd></dl>

<p>Definition at line <a class="el" href="spibus__at91_8c-source.html#l00137">137</a> of file <a class="el" href="spibus__at91_8c-source.html">spibus_at91.c</a>.</p>

<p>References <a class="el" href="spibus0at91_8c-source.html#l00121">At91Spi0ChipSelect()</a>, <a class="el" href="spibus__at91_8h.html#d3304d50eed856a13adba236054aab2f">At91Spi1ChipSelect()</a>, <a class="el" href="spibus0at91_8c-source.html#l00260">At91SpiBus0Interrupt()</a>, <a class="el" href="spibus__at91_8h.html#744d30f9af2efa61d4836e0cb2f8daea">At91SpiBus1Interrupt()</a>, <a class="el" href="spibus__at91_8c-source.html#l00072">At91SpiSetup()</a>, <a class="el" href="icc_8h-source.html#l00142">malloc</a>, <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>, <a class="el" href="ihndlr_8c-source.html#l00121">NutIrqEnable()</a>, <a class="el" href="ihndlr_8c-source.html#l00098">NutRegisterIrqHandler()</a>, <a class="el" href="arm_8h-source.html#l00195">outr</a>, <a class="el" href="at91sam7x_8h-source.html#l00113">SPI1_BASE</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00091">SPI_IDR_OFF</a>, <a class="el" href="spibus_8h-source.html#l00059">SPI_MODE_CSHIGH</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00059">SPI_MODFDIS</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00055">SPI_MSTR</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00062">SPI_PCS_0</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00063">SPI_PCS_1</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00064">SPI_PCS_2</a>, and <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00065">SPI_PCS_3</a>.</p>

</div>
</div><p>
<a class="anchor" name="1491afa859a173c6ab44a4528e9a30ad"></a><!-- doxytag: member="spibus_at91.c::At91SpiBusWait" ref="1491afa859a173c6ab44a4528e9a30ad" args="(NUTSPINODE *node, uint32_t tmo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int At91SpiBusWait           </td>
          <td>(</td>
          <td class="paramtype">NUTSPINODE *&nbsp;</td>
          <td class="paramname"> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>tmo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Wait until all SPI bus transfers are done. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>node</em>&nbsp;</td><td>Specifies the SPI bus node. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tmo</em>&nbsp;</td><td>Timeout in milliseconds. To disable timeout, set this parameter to NUT_WAIT_INFINITE.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Always 0. </dd></dl>

<p>Definition at line <a class="el" href="spibus__at91_8c-source.html#l00343">343</a> of file <a class="el" href="spibus__at91_8c-source.html">spibus_at91.c</a>.</p>

<p>References <a class="el" href="arm_8h-source.html#l00199">inr</a>, <a class="el" href="event_8c-source.html#l00271">NutEventWait()</a>, <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00100">SPI_RXBUFF</a>, and <a class="el" href="arch_2arm_2at91__spi_8h-source.html#l00089">SPI_SR_OFF</a>.</p>

<p>Referenced by <a class="el" href="spibus0at91_8c-source.html#l00236">At91SpiBus0Deselect()</a>.</p>

</div>
</div><p>
</div>
<hr>
<address>
  <small>
    &copy;&nbsp;2000-2007 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
