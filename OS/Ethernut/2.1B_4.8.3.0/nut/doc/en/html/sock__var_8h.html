<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
    <link href="nut_entabs.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.5.8 -->
  <div class="navpath"><a class="el" href="dir_81006e530ae69d901a01dddafc7fbce4.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_767639b207e69a2c2442b61ee02d5dc5.html">sys</a>
  </div>
<div class="contents">
<h1>sock_var.h File Reference</h1>UDP and TCP socket interface definitions.  
<a href="#_details">More...</a>
<p>

<p>
<a href="sock__var_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structudp__socket.html">UDPSOCKET</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">UDP socket information structure.  <a href="structudp__socket.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtcp__socket.html">TCPSOCKET</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">TCP socket information structure.  <a href="structtcp__socket.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_tcp_socket.html#gefdf0c5749674efdd40a37857ca45f78">SO_FIN</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Socket transmit flag. Send FIN after all data has been transmitted.  <a href="group__xg_tcp_socket.html#gefdf0c5749674efdd40a37857ca45f78"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_tcp_socket.html#g4a15c49046e1b3c0c3b4a3fad2b55c6c">SO_SYN</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Socket transmit flag. Send SYN first.  <a href="group__xg_tcp_socket.html#g4a15c49046e1b3c0c3b4a3fad2b55c6c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_tcp_socket.html#g070f5c81fc9c6442a0576f42d67c794c">SO_FORCE</a>&nbsp;&nbsp;&nbsp;0x08</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Socket transmit flag. Force sending ACK.  <a href="group__xg_tcp_socket.html#g070f5c81fc9c6442a0576f42d67c794c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_tcp_socket.html#gb60d40db730ce72950328301beae2c1c">SO_ACK</a>&nbsp;&nbsp;&nbsp;0x10</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Socket transmit flag. Send ACK.  <a href="group__xg_tcp_socket.html#gb60d40db730ce72950328301beae2c1c"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_u_d_p.html#g3057f4a4a81e80d7d7c024a5e0db73c5">NutUdpInput</a> (NUTDEVICE *dev, NETBUF *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle incoming UDP packets.  <a href="group__xg_u_d_p.html#g3057f4a4a81e80d7d7c024a5e0db73c5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_u_d_p.html#g518b1cc25e7c2e16bb631d0d143007a0">NutUdpOutput</a> (UDPSOCKET *sock, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> dest, <a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> port, NETBUF *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a UDP packet.  <a href="group__xg_u_d_p.html#g518b1cc25e7c2e16bb631d0d143007a0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__var_8h.html#2dbf5a03e60e89a32ffcfd429aa81775">NutTcpOutput</a> (TCPSOCKET *sock, CONST <a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *data, <a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initiate TCP segment transmission.  <a href="#2dbf5a03e60e89a32ffcfd429aa81775"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sock__var_8h.html#47fb9b8095e5720d1cf8bc1b9db8df2c">NutTcpReject</a> (NETBUF *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reject an incoming segment.  <a href="#47fb9b8095e5720d1cf8bc1b9db8df2c"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
UDP and TCP socket interface definitions. 
<p>

<p>Definition in file <a class="el" href="sock__var_8h-source.html">sock_var.h</a>.</p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="2dbf5a03e60e89a32ffcfd429aa81775"></a><!-- doxytag: member="sock_var.h::NutTcpOutput" ref="2dbf5a03e60e89a32ffcfd429aa81775" args="(TCPSOCKET *sock, CONST uint8_t *data, uint16_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutTcpOutput           </td>
          <td>(</td>
          <td class="paramtype">TCPSOCKET *&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CONST <a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initiate TCP segment transmission. 
<p>
Check the TCP socket status and send any segment waiting for transmission.<p>
The function will not return until the data has been stored in the network device hardware for transmission. If the device is not ready for transmitting a new packet, the calling thread will be suspended until the device becomes ready again.<p>
If the target host is connected through an Ethernet network and if the hardware address of that host is currently unknown, an ARP request is sent out and the function will block until a response is received or an ARP timeout occurs.<p>
Segments containing data or SYN and FIN flags are added to a special queue for unacknowledged segments and will be retransmitted by the TCP timer thread, if not acknowledged by the remote within a specific time. The state machine will remove these segments from the queue as soon as they are acknowledged.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This function is mainly used by the TCP state machine. Applications typically do not call this function but use <a class="el" href="group__xg_tcp_socket.html#gfc14dd4c910afbb9269adc5bebba0281" title="Send data on a connected TCP socket.">NutTcpSend()</a>, which is part of the TCP socket interface.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sock</em>&nbsp;</td><td>Socket descriptor. This pointer must have been retrieved by calling <a class="el" href="group__xg_tcp_socket.html#g6bf8ec59828c5a0e38423293b4dfe8e6" title="Create a TCP socket.">NutTcpCreateSocket()</a>. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Pointer to TCP segment contents. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>TCP segment length.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise. Returning 0 does not imply that the data has been successfully delivered, because flow control and retransmission is still handled in the background. </dd></dl>

<p>Definition at line <a class="el" href="tcpout_8c-source.html#l00209">209</a> of file <a class="el" href="tcpout_8c-source.html">tcpout.c</a>.</p>

<p>References <a class="el" href="netdebug_8c-source.html#l00103">__tcp_trf</a>, <a class="el" href="netdebug_8c-source.html#l00102">__tcp_trs</a>, <a class="el" href="errno_8h-source.html#l00117">ENOBUFS</a>, <a class="el" href="types_8h-source.html#l00330">htonl</a>, <a class="el" href="types_8h-source.html#l00321">htons</a>, <a class="el" href="in_8h-source.html#l00132">IPPROTO_TCP</a>, <a class="el" href="memcpy_8c-source.html#l00114">memcpy()</a>, <a class="el" href="netbuf_8h-source.html#l00132">NBAF_APPLICATION</a>, <a class="el" href="netbuf_8h-source.html#l00131">NBAF_TRANSPORT</a>, <a class="el" href="types_8h-source.html#l00348">ntohl</a>, <a class="el" href="netdebug_8c-source.html#l00105">NutDumpTcpHeader()</a>, <a class="el" href="timer_8c-source.html#l00734">NutGetMillis()</a>, <a class="el" href="ipcsum_8c-source.html#l00193">NutIpChkSum()</a>, <a class="el" href="ipcsum_8c-source.html#l00153">NutIpChkSumPartial()</a>, <a class="el" href="ipout_8c-source.html#l00182">NutIpOutput()</a>, <a class="el" href="ipcsum_8c-source.html#l00214">NutIpPseudoChkSumPartial()</a>, <a class="el" href="netbuf_8c-source.html#l00173">NutNetBufAlloc()</a>, <a class="el" href="netbuf_8c-source.html#l00251">NutNetBufClone()</a>, <a class="el" href="netbuf_8c-source.html#l00299">NutNetBufFree()</a>, <a class="el" href="sock__var_8h-source.html#l00273">SO_ACK</a>, <a class="el" href="sock__var_8h-source.html#l00270">SO_FIN</a>, <a class="el" href="sock__var_8h-source.html#l00272">SO_FORCE</a>, <a class="el" href="sock__var_8h-source.html#l00271">SO_SYN</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00170">TCPOLEN_MAXSEG</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00169">TCPOPT_MAXSEG</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00148">TCPHDR::th_ack</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00130">TH_ACK</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00146">TCPHDR::th_dport</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00126">TH_FIN</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00161">TCPHDR::th_flags</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00154">TCPHDR::th_off</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00129">TH_PUSH</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00147">TCPHDR::th_seq</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00145">TCPHDR::th_sport</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00163">TCPHDR::th_sum</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00127">TH_SYN</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00164">TCPHDR::th_urp</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00162">TCPHDR::th_win</a>, and <a class="el" href="netinet_2tcp_8h-source.html#l00154">TCPHDR::th_x2</a>.</p>

<p>Referenced by <a class="el" href="tcpsock_8c-source.html#l00694">NutTcpSend()</a>, <a class="el" href="tcpsm_8c-source.html#l01643">NutTcpSm()</a>, and <a class="el" href="tcpsm_8c-source.html#l00918">NutTcpStateWindowEvent()</a>.</p>

</div>
</div><p>
<a class="anchor" name="47fb9b8095e5720d1cf8bc1b9db8df2c"></a><!-- doxytag: member="sock_var.h::NutTcpReject" ref="47fb9b8095e5720d1cf8bc1b9db8df2c" args="(NETBUF *nb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutTcpReject           </td>
          <td>(</td>
          <td class="paramtype">NETBUF *&nbsp;</td>
          <td class="paramname"> <em>nb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Reject an incoming segment. 
<p>
Send RST in response to an incoming segment, which should be rejected.<p>
The function avoids to send out a RST segment in response to an incoming RST segment.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This function is mainly used by the TCP state machine. Applications typically do not call this function.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nb</em>&nbsp;</td><td>Network buffer structure of the incoming segment. Will be released within this function.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="tcpout_8c-source.html#l00391">391</a> of file <a class="el" href="tcpout_8c-source.html">tcpout.c</a>.</p>

<p>References <a class="el" href="netdebug_8c-source.html#l00103">__tcp_trf</a>, <a class="el" href="netdebug_8c-source.html#l00102">__tcp_trs</a>, <a class="el" href="types_8h-source.html#l00330">htonl</a>, <a class="el" href="types_8h-source.html#l00321">htons</a>, <a class="el" href="in_8h-source.html#l00132">IPPROTO_TCP</a>, <a class="el" href="types_8h-source.html#l00348">ntohl</a>, <a class="el" href="netdebug_8c-source.html#l00105">NutDumpTcpHeader()</a>, <a class="el" href="ipcsum_8c-source.html#l00193">NutIpChkSum()</a>, <a class="el" href="ipout_8c-source.html#l00182">NutIpOutput()</a>, <a class="el" href="ipcsum_8c-source.html#l00214">NutIpPseudoChkSumPartial()</a>, <a class="el" href="netbuf_8c-source.html#l00299">NutNetBufFree()</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00130">TH_ACK</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00128">TH_RST</a>, and <a class="el" href="netinet_2tcp_8h-source.html#l00127">TH_SYN</a>.</p>

<p>Referenced by <a class="el" href="tcpsm_8c-source.html#l01643">NutTcpSm()</a>, and <a class="el" href="tcpsm_8c-source.html#l01740">NutTcpStateMachine()</a>.</p>

</div>
</div><p>
</div>
<hr>
<address>
  <small>
    &copy;&nbsp;2000-2007 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
