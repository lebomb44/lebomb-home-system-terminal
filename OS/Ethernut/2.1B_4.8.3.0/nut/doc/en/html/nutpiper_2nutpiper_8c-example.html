<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
    <link href="nut_entabs.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="contents">
<h1>nutpiper/nutpiper.c</h1>$Log$ Revision 1.7 2009/02/18 12:18:58 olereinhardt 2009-02-18 Ole Reinhardt &lt;<a href="mailto:ole.reinhardt@thermotemp.de">ole.reinhardt@thermotemp.de</a>&gt;<p>
Fixed compilier warnings. Especialy signedness of char buffers as well as unused code on arm platform and main functions without return value<p>
Revision 1.6 2006/08/31 19:14:44 haraldkipp Not all platforms do have devDebug0. Use <a class="el" href="board_8h.html">board.h</a> to determine the correct driver.<p>
Revision 1.5 2006/07/21 09:06:36 haraldkipp Exclude AVR specific parts from building for other platforms. This does not imply, that all samples are working on all platforms.<p>
Revision 1.4 2006/05/15 12:51:47 haraldkipp Player start timeout increased.<p>
Revision 1.3 2004/05/11 17:22:12 drsung Deprecated header file removed.<p>
Revision 1.2 2003/11/04 17:46:52 haraldkipp Adapted to Ethernut 2<p>
Revision 1.1 2003/07/21 17:50:48 haraldkipp First check in<p>
Shoutcast radio application..<p>
<div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment"> * Copyright (C) 2003-2006 by egnite Software GmbH. All rights reserved.</span>
<span class="comment"> *</span>
<span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<span class="comment"> * modification, are permitted provided that the following conditions</span>
<span class="comment"> * are met:</span>
<span class="comment"> *</span>
<span class="comment"> * 1. Redistributions of source code must retain the above copyright</span>
<span class="comment"> *    notice, this list of conditions and the following disclaimer.</span>
<span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</span>
<span class="comment"> *    notice, this list of conditions and the following disclaimer in the</span>
<span class="comment"> *    documentation and/or other materials provided with the distribution.</span>
<span class="comment"> * 3. Neither the name of the copyright holders nor the names of</span>
<span class="comment"> *    contributors may be used to endorse or promote products derived</span>
<span class="comment"> *    from this software without specific prior written permission.</span>
<span class="comment"> *</span>
<span class="comment"> * THIS SOFTWARE IS PROVIDED BY EGNITE SOFTWARE GMBH AND CONTRIBUTORS</span>
<span class="comment"> * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span>
<span class="comment"> * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL EGNITE</span>
<span class="comment"> * SOFTWARE GMBH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<span class="comment"> * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span>
<span class="comment"> * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS</span>
<span class="comment"> * OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED</span>
<span class="comment"> * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<span class="comment"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF</span>
<span class="comment"> * THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
<span class="comment"> * SUCH DAMAGE.</span>
<span class="comment"> *</span>
<span class="comment"> * For additional information see http://www.ethernut.de/</span>
<span class="comment"> *</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="stdio_8h.html" title="C Standard I/O.">stdio.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="io_8h.html">io.h</a>&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="board_8h.html">dev/board.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="debug_8h.html" title="Debug device definitions.">dev/debug.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="term_8h.html" title="Terminal device definitions.">dev/term.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="hd44780_8h.html">dev/hd44780.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="vs1001k_8h.html" title="Network interface controller definitions.">dev/vs1001k.h</a>&gt;</span>
<span class="preprocessor">#ifdef ETHERNUT2</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="lanc111_8h.html" title="Network interface controller definitions.">dev/lanc111.h</a>&gt;</span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="nicrtl_8h.html" title="Network interface controller definitions.">dev/nicrtl.h</a>&gt;</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;<a class="code" href="heap_8h.html" title="Heap management definitions.">sys/heap.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="thread_8h.html" title="Thread management definitions.">sys/thread.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="sys_2timer_8h.html" title="Timer management definitions.">sys/timer.h</a>&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="netinet_2tcp_8h.html" title="TCP protocol definitions.">netinet/tcp.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="inet_8h.html" title="Internet address conversion.">arpa/inet.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="route_8h.html" title="Routing information definitions.">net/route.h</a>&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="pro_2dhcp_8h.html" title="DHCP protocol definitions.">pro/dhcp.h</a>&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="sys_2bankmem_8h.html" title="Banked memory management definitions.">sys/bankmem.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="irsony_8h.html" title="Sony remote control device definitions.">dev/irsony.h</a>&gt;</span>

<span class="preprocessor">#include "<a class="code" href="config_8h.html">config.h</a>"</span>
<span class="preprocessor">#include "<a class="code" href="display_8h.html">display.h</a>"</span>
<span class="preprocessor">#include "<a class="code" href="scanner_8h.html">scanner.h</a>"</span>
<span class="preprocessor">#include "<a class="code" href="player_8h.html">player.h</a>"</span>

<span class="preprocessor">#if defined(__AVR__)</span>
<span class="preprocessor"></span>
<span class="comment">/*</span>
<span class="comment"> * TCP buffer size.</span>
<span class="comment"> */</span>
<span class="keyword">static</span> <a name="a0"></a><a class="code" href="group__xg_nut_o_s.html#ga1a19deefc008737e6397f44d983cfd4" title="Unsigned 16-bit value.">u_short</a> tcpbufsiz = 4288;

<span class="comment">/*</span>
<span class="comment"> * Maximum segment size, choose 536 up to 1460. Note, that segment </span>
<span class="comment"> * sizes above 536 may result in fragmented packets. Remember, that </span>
<span class="comment"> * Ethernut doesn't support TCP fragmentation.</span>
<span class="comment"> */</span>
<span class="keyword">static</span> <a class="code" href="group__xg_nut_o_s.html#ga1a19deefc008737e6397f44d983cfd4" title="Unsigned 16-bit value.">u_short</a> mss = 536;

<span class="comment">/*</span>
<span class="comment"> * Socket receive timeout.</span>
<span class="comment"> */</span>
<span class="keyword">static</span> <a name="a1"></a><a class="code" href="group__xg_nut_o_s.html#g8f25a50daf29ce2cee1ec038a4d744ea" title="Unsigned 32-bit value.">u_long</a> rx_to = 1000;

<span class="comment">/*</span>
<span class="comment"> * Connect to a radio station.</span>
<span class="comment"> */</span>
<span class="keyword">static</span> TCPSOCKET *ConnectStation(<a name="_a2"></a><a class="code" href="struct_r_a_d_i_o_s_t_a_t_i_o_n.html">RADIOSTATION</a> * rsp)
{
    TCPSOCKET *sock;
    <span class="keywordtype">int</span> rc;

    <span class="comment">/* Create a socket. TODO: A failure is fatal and should restart</span>
<span class="comment">       the system. */</span>
    <span class="keywordflow">if</span> ((sock = <a name="a3"></a><a class="code" href="group__xg_tcp_socket.html#g6bf8ec59828c5a0e38423293b4dfe8e6" title="Create a TCP socket.">NutTcpCreateSocket</a>()) == 0)
        <span class="keywordflow">return</span> sock;

    <span class="comment">/* Set socket options. Failures are ignored. */</span>
    <span class="keywordflow">if</span> (<a name="a4"></a><a class="code" href="group__xg_tcp_socket.html#gb3bd1c81e2046e53cde6973b9c6bf6f4" title="Set value of a TCP socket option.">NutTcpSetSockOpt</a>(sock, <a name="a5"></a><a class="code" href="netinet_2tcp_8h.html#f20c12fa9bf018281e14c3b43b777e2e" title="Set maximum segment size.">TCP_MAXSEG</a>, &amp;mss, <span class="keyword">sizeof</span>(mss)))
        <a name="a6"></a><a class="code" href="icc_8h.html#3cb9f0894fab1c8fbb0753c9c7c2a8d9" title="Specify enhanced AVR target.">printf</a>(<span class="stringliteral">"Sockopt MSS failed\n"</span>);
    <span class="keywordflow">if</span> (<a class="code" href="group__xg_tcp_socket.html#gb3bd1c81e2046e53cde6973b9c6bf6f4" title="Set value of a TCP socket option.">NutTcpSetSockOpt</a>(sock, <a name="a7"></a><a class="code" href="socket_8h.html#f2d1ed6a34336a6f3df80fb518325846" title="Receive timeout.">SO_RCVTIMEO</a>, &amp;rx_to, <span class="keyword">sizeof</span>(rx_to)))
        <a class="code" href="icc_8h.html#3cb9f0894fab1c8fbb0753c9c7c2a8d9" title="Specify enhanced AVR target.">printf</a>(<span class="stringliteral">"Sockopt TO failed\n"</span>);
    <span class="keywordflow">if</span> (<a class="code" href="group__xg_tcp_socket.html#gb3bd1c81e2046e53cde6973b9c6bf6f4" title="Set value of a TCP socket option.">NutTcpSetSockOpt</a>(sock, <a name="a8"></a><a class="code" href="socket_8h.html#0db12e960ac303030400d9fd95391b52" title="Receive buffer size.">SO_RCVBUF</a>, &amp;tcpbufsiz, <span class="keyword">sizeof</span>(tcpbufsiz)))
        <a class="code" href="icc_8h.html#3cb9f0894fab1c8fbb0753c9c7c2a8d9" title="Specify enhanced AVR target.">printf</a>(<span class="stringliteral">"Sockopt rxbuf failed\n"</span>);

    <span class="comment">/* Connect the stream server. */</span>
    <a class="code" href="icc_8h.html#3cb9f0894fab1c8fbb0753c9c7c2a8d9" title="Specify enhanced AVR target.">printf</a>(<span class="stringliteral">"[CNCT %s:%u]"</span>, <a name="a9"></a><a class="code" href="group__xg_i_p.html#g9daa3cef32d6bcb76a95d0e869fd8b7a" title="Convert numeric IP address into decimal dotted ASCII representation.">inet_ntoa</a>(rsp-&gt;<a name="a10"></a><a class="code" href="struct_r_a_d_i_o_s_t_a_t_i_o_n.html#d9c449949d2d3fc0e4962b628503287f">rs_ip</a>), rsp-&gt;<a name="a11"></a><a class="code" href="struct_r_a_d_i_o_s_t_a_t_i_o_n.html#0d7703d4b9182fecce91ef69f9fbeffd">rs_port</a>);
    <span class="keywordflow">if</span> ((rc = <a name="a12"></a><a class="code" href="group__xg_tcp_socket.html#g48ff1e877483a0833cf38e428eac6457" title="Connect to a remote socket.">NutTcpConnect</a>(sock, rsp-&gt;<a class="code" href="struct_r_a_d_i_o_s_t_a_t_i_o_n.html#d9c449949d2d3fc0e4962b628503287f">rs_ip</a>, rsp-&gt;<a class="code" href="struct_r_a_d_i_o_s_t_a_t_i_o_n.html#0d7703d4b9182fecce91ef69f9fbeffd">rs_port</a>)) == 0) {
        <a class="code" href="icc_8h.html#3cb9f0894fab1c8fbb0753c9c7c2a8d9" title="Specify enhanced AVR target.">printf</a>(<span class="stringliteral">"[CNCTD]"</span>);
        <span class="comment">/* Process header from server. */</span>
        <span class="keywordflow">if</span> (<a name="a13"></a><a class="code" href="scanner_8c.html#d115fc3f461f4c393533ccc01c5adf4a" title="Process header from server.">ScanStreamHeader</a>(sock, rsp) == 0) {
            <span class="comment">/* TODO: Failed to start the player is fatal. */</span>
            <span class="keywordflow">if</span> (<a name="a14"></a><a class="code" href="player_8h.html#3808ae2542e45955a60016c14d829144">PlayerStart</a>(sock, rsp-&gt;<a name="a15"></a><a class="code" href="struct_r_a_d_i_o_s_t_a_t_i_o_n.html#c7254003d3967e3d1450c177d45e8145">rs_metaint</a>, 30000)) {
                <a name="a16"></a><a class="code" href="group__xg_tcp_socket.html#g09d94fd887683a0837e06c2cc08fc7ba" title="Close TCP socket.">NutTcpCloseSocket</a>(sock);
                sock = 0;
            }
        } <span class="keywordflow">else</span> {
            <a class="code" href="group__xg_tcp_socket.html#g09d94fd887683a0837e06c2cc08fc7ba" title="Close TCP socket.">NutTcpCloseSocket</a>(sock);
            sock = 0;
        }
    } <span class="keywordflow">else</span> {
        <a class="code" href="icc_8h.html#3cb9f0894fab1c8fbb0753c9c7c2a8d9" title="Specify enhanced AVR target.">printf</a>(<span class="stringliteral">"[CERR=%d]\n"</span>, <a name="a17"></a><a class="code" href="group__xg_tcp_socket.html#g3953f713369f008979d738b32d8fc255" title="Return specific code of the last error.">NutTcpError</a>(sock));
        <a class="code" href="group__xg_tcp_socket.html#g09d94fd887683a0837e06c2cc08fc7ba" title="Close TCP socket.">NutTcpCloseSocket</a>(sock);
        sock = 0;
    }
    <span class="keywordflow">return</span> sock;
}

<span class="comment">/*</span>
<span class="comment"> * Disconnect from a radio station.</span>
<span class="comment"> */</span>
<span class="keyword">static</span> <span class="keywordtype">void</span> DisconnectStation(TCPSOCKET * sock)
{
    <span class="keywordflow">if</span> (<a name="a18"></a><a class="code" href="player_8h.html#aa1ef243bd2f1b94562dfa23dfca485b">PlayerStop</a>(3000)) {
        <a class="code" href="icc_8h.html#3cb9f0894fab1c8fbb0753c9c7c2a8d9" title="Specify enhanced AVR target.">printf</a>(<span class="stringliteral">"[PPFAIL]"</span>);
    }
    <a class="code" href="icc_8h.html#3cb9f0894fab1c8fbb0753c9c7c2a8d9" title="Specify enhanced AVR target.">printf</a>(<span class="stringliteral">"Disconnecting\n"</span>);
    <a class="code" href="group__xg_tcp_socket.html#g09d94fd887683a0837e06c2cc08fc7ba" title="Close TCP socket.">NutTcpCloseSocket</a>(sock);
}

<span class="comment">/*</span>
<span class="comment"> * Get next command from user interface.</span>
<span class="comment"> *</span>
<span class="comment"> * We are supporting the remote control only for now.</span>
<span class="comment"> */</span>
<span class="keyword">static</span> <a class="code" href="group__xg_nut_o_s.html#ga1a19deefc008737e6397f44d983cfd4" title="Unsigned 16-bit value.">u_short</a> UserInput(<span class="keywordtype">void</span>)
{
    <a class="code" href="group__xg_nut_o_s.html#ga1a19deefc008737e6397f44d983cfd4" title="Unsigned 16-bit value.">u_short</a> rc;
    <span class="keyword">static</span> <a class="code" href="group__xg_nut_o_s.html#ga1a19deefc008737e6397f44d983cfd4" title="Unsigned 16-bit value.">u_short</a> old = 0xFFFF;

    <span class="keywordflow">if</span> ((rc = (<a class="code" href="group__xg_nut_o_s.html#ga1a19deefc008737e6397f44d983cfd4" title="Unsigned 16-bit value.">u_short</a>) <a name="a19"></a><a class="code" href="group__xg_ir.html#g6de7419441a351090eddd3c5fb33e3e1" title="Get next infrared code.">NutIrGet</a>(500)) == 0xFFFF)
        old = rc;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc == old || (rc &gt;&gt; 7) != <a name="a20"></a><a class="code" href="irsony_8h.html#57d2874336eb0d0f50a0d880bd06ef36">IR_DEVICE</a>)
        rc = 0xFFFF;
    <span class="keywordflow">else</span> {
        old = rc;
        rc &amp;= 0x7F;
        <span class="keywordflow">if</span> (rc == <a name="a21"></a><a class="code" href="irsony_8h.html#dc7fa53cea03a6cf36162c8785466b36">IRCMD_VOL_UP</a> || rc == <a name="a22"></a><a class="code" href="irsony_8h.html#d297bd639bbdb2c760f5361b993110d8">IRCMD_VOL_DN</a>)
            old = 0xFFFF;
    }
    <span class="keywordflow">return</span> rc;
}

<span class="comment">/*</span>
<span class="comment"> * If we got a background scanner </span>
<span class="comment"> */</span>
<span class="keyword">static</span> <span class="keywordtype">void</span> StationList(<span class="keywordtype">void</span>)
{
    <a name="a23"></a><a class="code" href="group__xg_nut_o_s.html#ge2b02ed168fc99cff3851603910b1fb6" title="Unsigned 8-bit value.">u_char</a> cf = 1;
    <a class="code" href="group__xg_nut_o_s.html#ge2b02ed168fc99cff3851603910b1fb6" title="Unsigned 8-bit value.">u_char</a> rs = <a name="a24"></a><a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a name="a25"></a><a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a>;
    <a class="code" href="group__xg_nut_o_s.html#ga1a19deefc008737e6397f44d983cfd4" title="Unsigned 16-bit value.">u_short</a> ircode;

    <a name="a26"></a><a class="code" href="display_8c.html#72e98105a0e494c142b020f8fb4a3660" title="Display a specified text.">DisplayMessage</a>(0, 1, <span class="stringliteral">"Stations"</span>);
    <a name="a27"></a><a class="code" href="display_8c.html#012eb73be7ef218f7a90e09a4d981bb4" title="Display specified entry of the list of stations.">DisplayEntry</a>(rs);
    <span class="keywordflow">while</span> (cf) {
        <span class="comment">/*</span>
<span class="comment">         * Process user input.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> ((ircode = UserInput()) != 0xFFFF) {
            <span class="keywordflow">switch</span> (ircode) {
            <span class="keywordflow">case</span> <a name="a28"></a><a class="code" href="irsony_8h.html#093fa684f6ab5c4bcf7ec389a6bbfd88">IRCMD_CHAN_UP</a>:
                <span class="keywordflow">if</span> (++rs &gt;= <a name="a29"></a><a class="code" href="config_8h.html#677295f2ad46a693534464dfb2abfdc8">MAXNUM_STATIONS</a>)
                    rs = 0;
                <a class="code" href="display_8c.html#012eb73be7ef218f7a90e09a4d981bb4" title="Display specified entry of the list of stations.">DisplayEntry</a>(rs);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a30"></a><a class="code" href="irsony_8h.html#e5ec5d7b164a4cf35e49a40b3d558fc0">IRCMD_CHAN_DN</a>:
                <span class="keywordflow">if</span> (rs)
                    rs--;
                <span class="keywordflow">else</span>
                    rs = <a class="code" href="config_8h.html#677295f2ad46a693534464dfb2abfdc8">MAXNUM_STATIONS</a> - 1;
                <a class="code" href="display_8c.html#012eb73be7ef218f7a90e09a4d981bb4" title="Display specified entry of the list of stations.">DisplayEntry</a>(rs);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a31"></a><a class="code" href="irsony_8h.html#339c38a2feab49cf178c9bf907d0538f">IRCMD_SELECT</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a name="a32"></a><a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = rs;
            <span class="keywordflow">default</span>:
                cf = 0;
                <span class="keywordflow">break</span>;
            }
        }
    }
    <a name="a33"></a><a class="code" href="display_8c.html#8688340f726571923cec34fee62a3ca6" title="Display a specified status.">DisplayStatus</a>(<a name="a34"></a><a class="code" href="config_8h.html#9c161a3455fdb284edd1e18e939d90b1">DIST_FORCE</a>);
}

<span class="keyword">static</span> <span class="keywordtype">void</span> UserInterface(<span class="keywordtype">void</span>)
{
    <a class="code" href="group__xg_nut_o_s.html#ge2b02ed168fc99cff3851603910b1fb6" title="Unsigned 8-bit value.">u_char</a> ief;
    <a class="code" href="group__xg_nut_o_s.html#ga1a19deefc008737e6397f44d983cfd4" title="Unsigned 16-bit value.">u_short</a> ircode;
    TCPSOCKET *sock = 0;

    <span class="keywordflow">for</span> (;;) {

        <span class="comment">/*</span>
<span class="comment">         * Process user input.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> ((ircode = UserInput()) != 0xFFFF) {
            <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a name="a35"></a><a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#ed2f13c2b1202984a71bd6b9f96e9d7d" title="Set when switched off.">rc_off</a> = 0;
            <span class="keywordflow">switch</span> (ircode) {
            <span class="keywordflow">case</span> <a name="a36"></a><a class="code" href="irsony_8h.html#8293b43fe3b6455fc20a5830b27aa4cc">IRCMD_CHAN_1</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = 1;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a37"></a><a class="code" href="irsony_8h.html#7246fa9daa8c9e6465f716981bc749a3">IRCMD_CHAN_2</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = 2;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a38"></a><a class="code" href="irsony_8h.html#8a93b17c7363f30cee69cd5ff6f0f22e">IRCMD_CHAN_3</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = 3;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a39"></a><a class="code" href="irsony_8h.html#38244ccc822a4c0a76bac10e7ec48af0">IRCMD_CHAN_4</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = 4;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a40"></a><a class="code" href="irsony_8h.html#39a26170be451122baf526d2ece99007">IRCMD_CHAN_5</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = 5;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a41"></a><a class="code" href="irsony_8h.html#0b90770aa852a005683438641408679c">IRCMD_CHAN_6</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = 6;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a42"></a><a class="code" href="irsony_8h.html#b2917d76a17454b437370cd6e6c9e73d">IRCMD_CHAN_7</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = 7;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a43"></a><a class="code" href="irsony_8h.html#e7deeec5884fda4b04850f5707329ba1">IRCMD_CHAN_8</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = 8;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a44"></a><a class="code" href="irsony_8h.html#8cf748574c417d9c56ccf10c825344ac">IRCMD_CHAN_9</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = 9;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="irsony_8h.html#093fa684f6ab5c4bcf7ec389a6bbfd88">IRCMD_CHAN_UP</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = <a name="a45"></a><a class="code" href="config_8h.html#fc706667e557578aafe9fd3234f28c2b">NEXT_STATION</a>;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="irsony_8h.html#e5ec5d7b164a4cf35e49a40b3d558fc0">IRCMD_CHAN_DN</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = <a name="a46"></a><a class="code" href="config_8h.html#b768f819824b231cfae776911b8fd1d9">PREV_STATION</a>;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="irsony_8h.html#dc7fa53cea03a6cf36162c8785466b36">IRCMD_VOL_UP</a>:
                <a name="a47"></a><a class="code" href="player_8c.html#5e261d0d19c020597b665c14e2a553dc">player</a>.<a name="a48"></a><a class="code" href="struct_p_l_a_y_e_r_i_n_f_o.html#6ff086cd790dc4f3c1072adb1e20f11a">psi_start</a> = 1;
                <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a name="a49"></a><a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#c01da36fd7508693548fad035d3b6658" title="Requested station.">rc_rvolume</a> &lt; 245)
                    <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#c01da36fd7508693548fad035d3b6658" title="Requested station.">rc_rvolume</a> += 10;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a class="code" href="irsony_8h.html#d297bd639bbdb2c760f5361b993110d8">IRCMD_VOL_DN</a>:
                <a class="code" href="player_8c.html#5e261d0d19c020597b665c14e2a553dc">player</a>.<a class="code" href="struct_p_l_a_y_e_r_i_n_f_o.html#6ff086cd790dc4f3c1072adb1e20f11a">psi_start</a> = 1;
                <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#c01da36fd7508693548fad035d3b6658" title="Requested station.">rc_rvolume</a> &gt; 10)
                    <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#c01da36fd7508693548fad035d3b6658" title="Requested station.">rc_rvolume</a> -= 10;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a50"></a><a class="code" href="irsony_8h.html#193e1c817369e45590e7883c43eb0bbe">IRCMD_MUTE</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a name="a51"></a><a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#8839ce014471940d22094e9976ee4a7c" title="Muted requested.">rc_rmute</a> = !<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#8839ce014471940d22094e9976ee4a7c" title="Muted requested.">rc_rmute</a>;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a52"></a><a class="code" href="irsony_8h.html#6adc13bf867f957e25f634ce89bb18cf">IRCMD_OFF</a>:
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#ed2f13c2b1202984a71bd6b9f96e9d7d" title="Set when switched off.">rc_off</a> = 1;
                <a class="code" href="display_8c.html#72e98105a0e494c142b020f8fb4a3660" title="Display a specified text.">DisplayMessage</a>(0, 0, <span class="stringliteral">"Shutdown..."</span>);
                <a class="code" href="display_8c.html#72e98105a0e494c142b020f8fb4a3660" title="Display a specified text.">DisplayMessage</a>(1, 0, <span class="stringliteral">""</span>);
                <a class="code" href="player_8h.html#aa1ef243bd2f1b94562dfa23dfca485b">PlayerStop</a>(1000);
                <a name="a53"></a><a class="code" href="config_8c.html#97a08e1f07dddc8b21291148279aceda" title="Save configuration in EEPROM.">ConfigSave</a>();
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a> = <a class="code" href="config_8h.html#b768f819824b231cfae776911b8fd1d9">PREV_STATION</a>;
                <a class="code" href="display_8c.html#72e98105a0e494c142b020f8fb4a3660" title="Display a specified text.">DisplayMessage</a>(0, 0, <span class="stringliteral">""</span>);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <a name="a54"></a><a class="code" href="irsony_8h.html#250183aa6fb7843013a799bcbfc493d9">IRCMD_VTEXT</a>:
                StationList();
                <span class="keywordflow">break</span>;
            <span class="keywordflow">default</span>:
                <a class="code" href="display_8c.html#72e98105a0e494c142b020f8fb4a3660" title="Display a specified text.">DisplayMessage</a>(0, 1, <span class="stringliteral">"Code %u"</span>, ircode);
                ief = <a name="a55"></a><a class="code" href="group__xg_vs1001.html#g526a4c9a195580052e581fbf089024ed" title="Enable or disable player interrupts.">VsPlayerInterrupts</a>(0);
                <a class="code" href="icc_8h.html#3cb9f0894fab1c8fbb0753c9c7c2a8d9" title="Specify enhanced AVR target.">printf</a>(<span class="stringliteral">"%lu kBytes used, %lu kBytes free\n"</span>, <a name="a56"></a><a class="code" href="group__xg_bank_mem.html#gcc5a7121fca5d27017c4d9f851a90475" title="Return the used buffer space.">NutSegBufUsed</a>() / 1024UL, <a name="a57"></a><a class="code" href="group__xg_bank_mem.html#g866d595bca99894fdee0e1e59cdc5d7d" title="Return the available buffer space.">NutSegBufAvailable</a>() / 1024UL);
                <a class="code" href="group__xg_vs1001.html#g526a4c9a195580052e581fbf089024ed" title="Enable or disable player interrupts.">VsPlayerInterrupts</a>(ief);
                <span class="keywordflow">break</span>;
            }
        }

        <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#ed2f13c2b1202984a71bd6b9f96e9d7d" title="Set when switched off.">rc_off</a>) {
            <a name="a58"></a><a class="code" href="group__xg_timer.html#gfefcf81d05019a8134b49fa44d8c114a" title="Temporarily suspends the current thread.">NutSleep</a>(500);
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">/*</span>
<span class="comment">         * Handle station changes.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> != <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a>) {
            <span class="comment">/* Disconnect current stream. */</span>
            <span class="keywordflow">if</span> (sock) {
                DisconnectStation(sock);
                sock = 0;
            }

            <span class="comment">/* If scanning, move to the next/previous station. */</span>
            <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> == <a class="code" href="config_8h.html#fc706667e557578aafe9fd3234f28c2b">NEXT_STATION</a>) {
                <span class="keywordflow">if</span> (++<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a> &gt;= <a class="code" href="config_8h.html#677295f2ad46a693534464dfb2abfdc8">MAXNUM_STATIONS</a>)
                    <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = 0;
            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> == <a class="code" href="config_8h.html#b768f819824b231cfae776911b8fd1d9">PREV_STATION</a>) {
                <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a>)
                    <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a>--;
                <span class="keywordflow">else</span>
                    <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a> = <a class="code" href="config_8h.html#677295f2ad46a693534464dfb2abfdc8">MAXNUM_STATIONS</a> - 1;
            } <span class="keywordflow">else</span> {
                <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a> = <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a>;
            }

            <a class="code" href="display_8c.html#72e98105a0e494c142b020f8fb4a3660" title="Display a specified text.">DisplayMessage</a>(0, 1, <span class="stringliteral">"Station %03u"</span>, <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a>);

            <span class="comment">/* Check for valid IP address and port. */</span>
            <span class="keywordflow">if</span> (<a name="a59"></a><a class="code" href="config_8c.html#81acab41209e38cb9e2e15b5ecafebb4" title="List of radio stations.">station</a>[<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a>].<a class="code" href="struct_r_a_d_i_o_s_t_a_t_i_o_n.html#d9c449949d2d3fc0e4962b628503287f">rs_ip</a> &amp;&amp; <a class="code" href="config_8c.html#81acab41209e38cb9e2e15b5ecafebb4" title="List of radio stations.">station</a>[<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a>].<a class="code" href="struct_r_a_d_i_o_s_t_a_t_i_o_n.html#0d7703d4b9182fecce91ef69f9fbeffd">rs_port</a>) {
                <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#81acab41209e38cb9e2e15b5ecafebb4" title="List of radio stations.">station</a>[<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a>].<a name="a60"></a><a class="code" href="struct_r_a_d_i_o_s_t_a_t_i_o_n.html#d29923cf1821ee0c262d09025f904918">rs_scandead</a>) {
                    <a class="code" href="display_8c.html#8688340f726571923cec34fee62a3ca6" title="Display a specified status.">DisplayStatus</a>(<a name="a61"></a><a class="code" href="config_8h.html#d71501da39afb67b4ce2be8e444bca51">DIST_DEAD</a>);
                } <span class="keywordflow">else</span> {
                    <a class="code" href="display_8c.html#8688340f726571923cec34fee62a3ca6" title="Display a specified status.">DisplayStatus</a>(<a name="a62"></a><a class="code" href="config_8h.html#f7b066ef91d0a50fcbc3132cea86f7c8">DIST_CONNECTING</a>);
                    <span class="keywordflow">if</span> ((sock = ConnectStation(&amp;<a class="code" href="config_8c.html#81acab41209e38cb9e2e15b5ecafebb4" title="List of radio stations.">station</a>[<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a>])) != 0) {
                        <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46c1510c5ba0083696a1ba4b28e88cb8" title="Requested station.">rc_rstation</a> = <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#f1616d4681b7e73d6b40d68537dac690" title="Current station.">rc_cstation</a>;
                        <a class="code" href="display_8c.html#8688340f726571923cec34fee62a3ca6" title="Display a specified status.">DisplayStatus</a>(<a name="a63"></a><a class="code" href="config_8h.html#6e899f1dcc6030691400bc26e526253b">DIST_CONNECTED</a>);
                    } <span class="keywordflow">else</span> {
                        <a class="code" href="display_8c.html#8688340f726571923cec34fee62a3ca6" title="Display a specified status.">DisplayStatus</a>(<a class="code" href="config_8h.html#d71501da39afb67b4ce2be8e444bca51">DIST_DEAD</a>);
                    }
                }
            } <span class="keywordflow">else</span> {
                <a class="code" href="display_8c.html#8688340f726571923cec34fee62a3ca6" title="Display a specified status.">DisplayStatus</a>(<a class="code" href="config_8h.html#d71501da39afb67b4ce2be8e444bca51">DIST_DEAD</a>);
            }
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a name="a64"></a><a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46690402c1443451acc9009cfe61bba8" title="Muted.">rc_cmute</a> != <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#8839ce014471940d22094e9976ee4a7c" title="Muted requested.">rc_rmute</a>) {

            <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46690402c1443451acc9009cfe61bba8" title="Muted.">rc_cmute</a> = <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#8839ce014471940d22094e9976ee4a7c" title="Muted requested.">rc_rmute</a>;
            <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#46690402c1443451acc9009cfe61bba8" title="Muted.">rc_cmute</a>) {
                <a class="code" href="display_8c.html#72e98105a0e494c142b020f8fb4a3660" title="Display a specified text.">DisplayMessage</a>(0, 1, <span class="stringliteral">"Mute"</span>);
                <a name="a65"></a><a class="code" href="group__xg_vs1001.html#g07d2ba8f8003afec15eff22ebb537868" title="Set volume.">VsSetVolume</a>(255, 255);
            } <span class="keywordflow">else</span> {
                <a class="code" href="display_8c.html#72e98105a0e494c142b020f8fb4a3660" title="Display a specified text.">DisplayMessage</a>(0, 1, <span class="stringliteral">"Volume %u"</span>, <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a name="a66"></a><a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#7baa13b50e1ef572d4f1e41a7a6eb15f" title="Current volume.">rc_cvolume</a>);
                <a class="code" href="group__xg_vs1001.html#g07d2ba8f8003afec15eff22ebb537868" title="Set volume.">VsSetVolume</a>(255 - <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#7baa13b50e1ef572d4f1e41a7a6eb15f" title="Current volume.">rc_cvolume</a>, 255 - <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#7baa13b50e1ef572d4f1e41a7a6eb15f" title="Current volume.">rc_cvolume</a>);
            }
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#7baa13b50e1ef572d4f1e41a7a6eb15f" title="Current volume.">rc_cvolume</a> != <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#c01da36fd7508693548fad035d3b6658" title="Requested station.">rc_rvolume</a>) {
            <a class="code" href="display_8c.html#72e98105a0e494c142b020f8fb4a3660" title="Display a specified text.">DisplayMessage</a>(0, 1, <span class="stringliteral">"Volume %u"</span>, <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#c01da36fd7508693548fad035d3b6658" title="Requested station.">rc_rvolume</a>);
            <a class="code" href="group__xg_vs1001.html#g07d2ba8f8003afec15eff22ebb537868" title="Set volume.">VsSetVolume</a>(255 - <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#c01da36fd7508693548fad035d3b6658" title="Requested station.">rc_rvolume</a>, 255 - <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#c01da36fd7508693548fad035d3b6658" title="Requested station.">rc_rvolume</a>);
            <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#7baa13b50e1ef572d4f1e41a7a6eb15f" title="Current volume.">rc_cvolume</a> = <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#c01da36fd7508693548fad035d3b6658" title="Requested station.">rc_rvolume</a>;
            <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#8839ce014471940d22094e9976ee4a7c" title="Muted requested.">rc_rmute</a> = 0;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="player_8c.html#5e261d0d19c020597b665c14e2a553dc">player</a>.<a name="a67"></a><a class="code" href="struct_p_l_a_y_e_r_i_n_f_o.html#ee9d18cac4f0c1c49034953bda1bf9b7">psi_metaupdate</a>) {
            <a class="code" href="display_8c.html#8688340f726571923cec34fee62a3ca6" title="Display a specified status.">DisplayStatus</a>(<a class="code" href="config_8h.html#9c161a3455fdb284edd1e18e939d90b1">DIST_FORCE</a>);
            <a class="code" href="player_8c.html#5e261d0d19c020597b665c14e2a553dc">player</a>.<a class="code" href="struct_p_l_a_y_e_r_i_n_f_o.html#ee9d18cac4f0c1c49034953bda1bf9b7">psi_metaupdate</a> = 0;
        }
    }
}

<span class="preprocessor">#endif </span><span class="comment">/* __AVR__ */</span>

<span class="comment">/*</span>
<span class="comment"> * Main entry of the Internet Radio Application.</span>
<span class="comment"> */</span>
<span class="keywordtype">int</span> <a name="a68"></a><a class="code" href="arm_8h.html#a4e97f3782107649d3e4eb3875090b3a">main</a>(<span class="keywordtype">void</span>)
{
<span class="preprocessor">#if defined(__AVR__)</span>
<span class="preprocessor"></span>    <span class="comment">/* Unique MAC address of the Ethernut Board. */</span>
    <a class="code" href="group__xg_nut_o_s.html#ge2b02ed168fc99cff3851603910b1fb6" title="Unsigned 8-bit value.">u_char</a> mac[6] = { 0x00, 0x06, 0x98, 0x00, 0x00, 0x00 };
    <span class="comment">/* Unique IP address of the Ethernut Board. Ignored if DHCP is used. */</span>
    <a class="code" href="group__xg_nut_o_s.html#g8f25a50daf29ce2cee1ec038a4d744ea" title="Unsigned 32-bit value.">u_long</a> ip_addr = <a name="a69"></a><a class="code" href="group__xg_i_p.html#gdbce564458332a83ab871b91a54269dd" title="Convert decimal dotted ASCII representation into numeric IP address.">inet_addr</a>(<span class="stringliteral">"192.168.192.100"</span>);
    <span class="comment">/* IP network mask of the Ethernut Board. Ignored if DHCP is used. */</span>
    <a class="code" href="group__xg_nut_o_s.html#g8f25a50daf29ce2cee1ec038a4d744ea" title="Unsigned 32-bit value.">u_long</a> ip_mask = <a class="code" href="group__xg_i_p.html#gdbce564458332a83ab871b91a54269dd" title="Convert decimal dotted ASCII representation into numeric IP address.">inet_addr</a>(<span class="stringliteral">"255.255.255.0"</span>);
    <span class="comment">/* Gateway IP address for the Ethernut Board. Ignored if DHCP is used. */</span>
    <a class="code" href="group__xg_nut_o_s.html#g8f25a50daf29ce2cee1ec038a4d744ea" title="Unsigned 32-bit value.">u_long</a> ip_gate = <a class="code" href="group__xg_i_p.html#gdbce564458332a83ab871b91a54269dd" title="Convert decimal dotted ASCII representation into numeric IP address.">inet_addr</a>(<span class="stringliteral">"192.168.192.3"</span>);
    <span class="comment">/* Baudrate for debug output. */</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    <a class="code" href="group__xg_nut_o_s.html#g8f25a50daf29ce2cee1ec038a4d744ea" title="Unsigned 32-bit value.">u_long</a> baud = 115200;

    <span class="comment">/*</span>
<span class="comment">     * Assign stdout to the debug device.</span>
<span class="comment">     */</span>
    <a name="a70"></a><a class="code" href="group__xg_device.html#g0d73e3153bf9f210194bd862d9b91c61" title="Register and initialize a device.">NutRegisterDevice</a>(&amp;<a name="a71"></a><a class="code" href="board_8h.html#a270f48e350ff81b1e62f2c73c248ef4">DEV_DEBUG</a>, 0, 0);
    <a name="a72"></a><a class="code" href="group__xg_crt_stdio.html#g76767cc4b7500920d83e53caad264189" title="Reassign a stream.">freopen</a>(<a name="a73"></a><a class="code" href="board_8h.html#83d947e8f5620ceb7ef54384588f83d4">DEV_DEBUG_NAME</a>, <span class="stringliteral">"w"</span>, <a name="a74"></a><a class="code" href="group__xg_crt_stdio.html#g0c0ef221f95f64e8632451312fd18cc8" title="Standard output stream.">stdout</a>);
    <a name="a75"></a><a class="code" href="group__xg_crt_lowio.html#g6b356746f1f26fb46f2afe4357ab3534" title="Perform device specific control functions.">_ioctl</a>(<a name="a76"></a><a class="code" href="group__xg_crt_stdio.html#gb5ec3b6c064aca1b990c342a82e64aae" title="Get the file descriptor associated with a stream.">_fileno</a>(<a class="code" href="group__xg_crt_stdio.html#g0c0ef221f95f64e8632451312fd18cc8" title="Standard output stream.">stdout</a>), <a name="a77"></a><a class="code" href="group__xg_u_a_r_t_i_o_c_t_l.html#g2f1b5053775ad3be83ae499273a04de8" title="UART _ioctl() command code to set the line speed.">UART_SETSPEED</a>, &amp;baud);

    <span class="comment">/*</span>
<span class="comment">     * Load configuration and display banner.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (<a name="a78"></a><a class="code" href="config_8c.html#bebf9dbfde12f2c730b924deae82d634" title="Load configuration from EEPROM.">ConfigLoad</a>())
        <a name="a79"></a><a class="code" href="config_8c.html#5f92bb07a113aff68fcf665fd997697c" title="Reset configuration.">ConfigResetFactory</a>();

<span class="preprocessor">#if defined(__AVR__)</span>
<span class="preprocessor"></span>    <span class="comment">/*</span>
<span class="comment">     * Initialize the MP3 device early to avoid noice, caused</span>
<span class="comment">     * by floating, tri-stated port lines.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (<a name="a80"></a><a class="code" href="group__xg_bank_mem.html#g54b4fc4de72531a2c413219187019e71" title="Initialize the segmented buffer.">NutSegBufInit</a>(8192) == 0) {
        <a class="code" href="icc_8h.html#3cb9f0894fab1c8fbb0753c9c7c2a8d9" title="Specify enhanced AVR target.">printf</a>(<span class="stringliteral">"Can't init segbuf\n"</span>);
        <span class="keywordflow">for</span> (;;);
    }
    <a name="a81"></a><a class="code" href="player_8h.html#89b177f0802bff15c701a0c889040635">PlayerInit</a>();

    <span class="comment">/*</span>
<span class="comment">     * Initialize the LCD.</span>
<span class="comment">     */</span>
    <a class="code" href="group__xg_device.html#g0d73e3153bf9f210194bd862d9b91c61" title="Register and initialize a device.">NutRegisterDevice</a>(&amp;<a name="a82"></a><a class="code" href="group__xg_display.html#g4cc60b300643fb901ceb75b0be4848b5" title="LCD device information structure.">devLcd</a>, 0, 0);
    <span class="keywordflow">if</span> (<a name="a83"></a><a class="code" href="display_8c.html#0b8e8bd3d8e9f2dfbda015e705e14951" title="Start background thread for display updates.">DisplayInit</a>(<span class="stringliteral">"lcd"</span>)) {
        <a class="code" href="icc_8h.html#3cb9f0894fab1c8fbb0753c9c7c2a8d9" title="Specify enhanced AVR target.">printf</a>(<span class="stringliteral">"Display failure\n"</span>);
        <span class="keywordflow">for</span> (;;);
    }

    <span class="comment">/*</span>
<span class="comment">     * Initialize IR remote control.</span>
<span class="comment">     */</span>
    <a name="a84"></a><a class="code" href="group__xg_ir_sony.html#g31c9a251fa0634d3a40401a339b8fbd8" title="Enable Sony infrared remote control.">NutIrInitSony</a>();

    <span class="comment">/*</span>
<span class="comment">     * LAN configuration using EEPROM values or DHCP/ARP method.</span>
<span class="comment">     * If it fails, use fixed values.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (<a class="code" href="group__xg_device.html#g0d73e3153bf9f210194bd862d9b91c61" title="Register and initialize a device.">NutRegisterDevice</a>(&amp;<a name="a85"></a><a class="code" href="dev_2at91__emac_8h.html#c8dd96e43e6ce38f3259b56db85065c9">DEV_ETHER</a>, 0x8300, 5))
        <a name="a86"></a><a class="code" href="icc_8h.html#80022cbe72a24b85437c2326543509be">puts</a>(<span class="stringliteral">"Registering device failed"</span>);
    <span class="keywordflow">if</span> (<a name="a87"></a><a class="code" href="group__xg_d_h_c_p_c.html#g23fddfde13e6e0581258ac7f0fc1d025" title="Automatically configure an Ethernet network interface.">NutDhcpIfConfig</a>(<span class="stringliteral">"eth0"</span>, 0, 60000)) {
        <a class="code" href="icc_8h.html#80022cbe72a24b85437c2326543509be">puts</a>(<span class="stringliteral">"EEPROM/DHCP/ARP config failed"</span>);
        <a name="a88"></a><a class="code" href="group__xg_i_p.html#g3d6e30d2a89522f9166d59cde5c85b94" title="Configure a network interface.">NutNetIfConfig</a>(<span class="stringliteral">"eth0"</span>, mac, ip_addr, ip_mask);
        <a name="a89"></a><a class="code" href="group__xg_i_p.html#geb3b4f86e57db7d3e047b0c53aa94e60" title="Add a new entry to the IP routing table.">NutIpRouteAdd</a>(0, 0, ip_gate, &amp;<a class="code" href="dev_2at91__emac_8h.html#c8dd96e43e6ce38f3259b56db85065c9">DEV_ETHER</a>);
    }
    <a class="code" href="icc_8h.html#80022cbe72a24b85437c2326543509be">puts</a>(<span class="stringliteral">"ready\n"</span>);

    <a class="code" href="group__xg_vs1001.html#g07d2ba8f8003afec15eff22ebb537868" title="Set volume.">VsSetVolume</a>(255 - <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#c01da36fd7508693548fad035d3b6658" title="Requested station.">rc_rvolume</a>, 255 - <a class="code" href="config_8c.html#fd0ff323af84f67b400d3394d68e0de9" title="Radio status and control.">radio</a>.<a class="code" href="struct_r_a_d_i_o_c_o_n_t_r_o_l.html#c01da36fd7508693548fad035d3b6658" title="Requested station.">rc_rvolume</a>);
    <a name="a90"></a><a class="code" href="group__xg_vs1001.html#gb90add1cb7df9071b6053eaf9082f57e" title="Sine wave beep.">VsBeep</a>(2, 100);

    <span class="comment">/*</span>
<span class="comment">     * Start the background scanner.</span>
<span class="comment">     */</span>
    <span class="comment">//ScannerInit();</span>

    <span class="comment">/*</span>
<span class="comment">     * Call the user interface..</span>
<span class="comment">     */</span>
    <span class="keywordflow">for</span> (;;) {
        UserInterface();
    }
<span class="preprocessor">#endif </span><span class="comment">/* __AVR__ */</span>

    <span class="keywordflow">for</span> (;;)
        <a class="code" href="group__xg_timer.html#gfefcf81d05019a8134b49fa44d8c114a" title="Temporarily suspends the current thread.">NutSleep</a>(1000);

    <span class="keywordflow">return</span> 0;
}
</pre></div> </div>
<hr>
<address>
  <small>
    &copy;&nbsp;2000-2007 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
