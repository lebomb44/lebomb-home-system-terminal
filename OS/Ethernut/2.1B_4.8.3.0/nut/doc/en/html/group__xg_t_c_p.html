<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
    <link href="nut_entabs.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="contents">
<h1>TCP<br>
<small>
[<a class="el" href="group__xg_base_pro.html">Base Protocols</a>]</small>
</h1>RFC 793 Transmission Control Protocol.  
<a href="#_details">More...</a>
<p>

<p>
<div class="dynheader">
Collaboration diagram for TCP:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__xg_t_c_p.png" border="0" alt="" usemap="#group____xg__t__c__p_map">
<map name="group____xg__t__c__p_map">
<area shape="rect" href="group__xg_base_pro.html" title="TCP/IP and UDP applications." alt="Base Protocols" coords="19,5,117,26"></map></td></tr></table></center>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#g33b9b66bdcf4a66bd1469c3cbfaa1c8a">TCP_RTTO_MIN</a>&nbsp;&nbsp;&nbsp;200</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#g1d0f9e323146b929c2daa8d7013c6823">TCP_RTTO_MAX</a>&nbsp;&nbsp;&nbsp;20000</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#gc6afabdc09a49a433ee19d8a9486056d">min</a>(a, b)&nbsp;&nbsp;&nbsp;((a&gt;b)?b:a)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#gffe776513b24d84b39af8ab0930fef7f">max</a>(a, b)&nbsp;&nbsp;&nbsp;((a&gt;b)?a:b)</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#ge07d8163a48c288273133b44e1aa1cee">NutTcpInput</a> (NUTDEVICE *dev, NETBUF *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Process incoming TCP segments from IP layer.  <a href="#ge07d8163a48c288273133b44e1aa1cee"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#gc5d18facd9bf6a983652d415fc806083">NutTcpStatePassiveOpenEvent</a> (TCPSOCKET *sock)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initiated by the application.  <a href="#gc5d18facd9bf6a983652d415fc806083"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#g77edd214cf89e11aebfc556b6879e487">NutTcpStateActiveOpenEvent</a> (TCPSOCKET *sock)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initiated by the application.  <a href="#g77edd214cf89e11aebfc556b6879e487"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#ge64ae871579ec8252d41240a947f1a5e">NutTcpStateCloseEvent</a> (TCPSOCKET *sock)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Socket close by application.  <a href="#ge64ae871579ec8252d41240a947f1a5e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#g9f691b65c2a49fbb90202f3d45c5b000">NutTcpStateWindowEvent</a> (TCPSOCKET *sock)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initiated by the application.  <a href="#g9f691b65c2a49fbb90202f3d45c5b000"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#gd8b7767f85c9dc3cd4a1f1f961ae7a84">NutTcpStateRetranTimeout</a> (TCPSOCKET *sock)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retransmit a segment after ACK timeout.  <a href="#gd8b7767f85c9dc3cd4a1f1f961ae7a84"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#gc0a5f54bde677941f7cf555c2f89a367">NutTcpSm</a> (void *arg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">TCP state machine thread.  <a href="#gc0a5f54bde677941f7cf555c2f89a367"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#g3402b7ed85f67803cc473f636290d22a">NutTcpStateMachine</a> (NETBUF *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Process incoming TCP segments.  <a href="#g3402b7ed85f67803cc473f636290d22a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#gf4276abdc9e3a9912632c592769eb13a">NutTcpInitStateMachine</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Start TCP state machine.  <a href="#gf4276abdc9e3a9912632c592769eb13a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#gf821e7425534f4f62fd8ea64b0f98992">NutTcpAbortSocket</a> (TCPSOCKET *sock, <a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> last_error)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Closes socket with error.  <a href="#gf821e7425534f4f62fd8ea64b0f98992"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#gcff7d63177023b5f4a6d1f9c32e7e7ab">IsInLimits</a> (<a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> x, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> low, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> high)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sequence number comparisons.  <a href="#gcff7d63177023b5f4a6d1f9c32e7e7ab"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#gf85cd27c9a8694e8098409b5f92003c7">NutTcpCalcRtt</a> (TCPSOCKET *sock)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__xg_nut_o_s.html#ga8c0374618b33785ccb02f74bcfebc46">HANDLE</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#ge222ee1ca91575390b1c8eb98272b8c3">tcp_in_rdy</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">NETBUF *volatile&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_t_c_p.html#g08e37e1f12909836bf31c91360e6fa7f">tcp_in_nbq</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
RFC 793 Transmission Control Protocol. 
<p>
TCP provides reliable, in-sequence delivery of a full-duplex stream of octets. It is used by applications which need a reliable, connection-oriented data transport.<p>
Applications should call the <a class="el" href="group__xg_tcp_socket.html">TCP Socket API</a> when using this protocol.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>Use an indirect call for <a class="el" href="group__xg_t_c_p.html#ge07d8163a48c288273133b44e1aa1cee" title="Process incoming TCP segments from IP layer.">NutTcpInput()</a>. Right now, the whole TCP code is linked to any application, even if only UDP is used. </dd></dl>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="g33b9b66bdcf4a66bd1469c3cbfaa1c8a"></a><!-- doxytag: member="tcputil.c::TCP_RTTO_MIN" ref="g33b9b66bdcf4a66bd1469c3cbfaa1c8a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCP_RTTO_MIN&nbsp;&nbsp;&nbsp;200          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcputil_8c-source.html#l00074">74</a> of file <a class="el" href="tcputil_8c-source.html">tcputil.c</a>.</p>

<p>Referenced by <a class="el" href="tcputil_8c-source.html#l00103">NutTcpCalcRtt()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g1d0f9e323146b929c2daa8d7013c6823"></a><!-- doxytag: member="tcputil.c::TCP_RTTO_MAX" ref="g1d0f9e323146b929c2daa8d7013c6823" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TCP_RTTO_MAX&nbsp;&nbsp;&nbsp;20000          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcputil_8c-source.html#l00077">77</a> of file <a class="el" href="tcputil_8c-source.html">tcputil.c</a>.</p>

<p>Referenced by <a class="el" href="tcputil_8c-source.html#l00103">NutTcpCalcRtt()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gc6afabdc09a49a433ee19d8a9486056d"></a><!-- doxytag: member="tcputil.c::min" ref="gc6afabdc09a49a433ee19d8a9486056d" args="(a, b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define min          </td>
          <td>(</td>
          <td class="paramtype">a,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">b&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;((a&gt;b)?b:a)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcputil_8c-source.html#l00097">97</a> of file <a class="el" href="tcputil_8c-source.html">tcputil.c</a>.</p>

<p>Referenced by <a class="el" href="tcputil_8c-source.html#l00103">NutTcpCalcRtt()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gffe776513b24d84b39af8ab0930fef7f"></a><!-- doxytag: member="tcputil.c::max" ref="gffe776513b24d84b39af8ab0930fef7f" args="(a, b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define max          </td>
          <td>(</td>
          <td class="paramtype">a,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">b&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;((a&gt;b)?a:b)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcputil_8c-source.html#l00098">98</a> of file <a class="el" href="tcputil_8c-source.html">tcputil.c</a>.</p>

<p>Referenced by <a class="el" href="tcputil_8c-source.html#l00103">NutTcpCalcRtt()</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ge07d8163a48c288273133b44e1aa1cee"></a><!-- doxytag: member="tcpin.c::NutTcpInput" ref="ge07d8163a48c288273133b44e1aa1cee" args="(NUTDEVICE *dev, NETBUF *nb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutTcpInput           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NETBUF *&nbsp;</td>
          <td class="paramname"> <em>nb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Process incoming TCP segments from IP layer. 
<p>
<dl class="warning" compact><dt><b>Warning:</b></dt><dd>The caller must take care not to pass broadcast or multicast segments.</dd></dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This routine is called by the IP layer on incoming TCP segments. Applications typically do not call this function. </dd></dl>

<p>Definition at line <a class="el" href="tcpin_8c-source.html#l00148">148</a> of file <a class="el" href="tcpin_8c-source.html">tcpin.c</a>.</p>

<p>References <a class="el" href="netbuf_8h-source.html#l00127">NBAF_UNICAST</a>, <a class="el" href="netbuf_8c-source.html#l00299">NutNetBufFree()</a>, <a class="el" href="tcpsm_8c-source.html#l01740">NutTcpStateMachine()</a>, and <a class="el" href="netinet_2tcp_8h-source.html#l00154">TCPHDR::th_off</a>.</p>

<p>Referenced by <a class="el" href="tcpsock_8c-source.html#l00375">NutTcpCreateSocket()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gc5d18facd9bf6a983652d415fc806083"></a><!-- doxytag: member="tcpsm.c::NutTcpStatePassiveOpenEvent" ref="gc5d18facd9bf6a983652d415fc806083" args="(TCPSOCKET *sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutTcpStatePassiveOpenEvent           </td>
          <td>(</td>
          <td class="paramtype">TCPSOCKET *&nbsp;</td>
          <td class="paramname"> <em>sock</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initiated by the application. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sock</em>&nbsp;</td><td>Socket descriptor. This pointer must have been retrieved by calling <a class="el" href="group__xg_tcp_socket.html#g6bf8ec59828c5a0e38423293b4dfe8e6" title="Create a TCP socket.">NutTcpCreateSocket()</a>.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if granted, error code otherwise. </dd></dl>

<p>Definition at line <a class="el" href="tcpsm_8c-source.html#l00806">806</a> of file <a class="el" href="tcpsm_8c-source.html">tcpsm.c</a>.</p>

<p>References <a class="el" href="errno_8h-source.html#l00118">EISCONN</a>, <a class="el" href="event_8c-source.html#l00271">NutEventWait()</a>, <a class="el" href="tcp__fsm_8h-source.html#l00095">TCPS_CLOSED</a>, and <a class="el" href="tcp__fsm_8h-source.html#l00096">TCPS_LISTEN</a>.</p>

<p>Referenced by <a class="el" href="tcpsock_8c-source.html#l00671">NutTcpAccept()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g77edd214cf89e11aebfc556b6879e487"></a><!-- doxytag: member="tcpsm.c::NutTcpStateActiveOpenEvent" ref="g77edd214cf89e11aebfc556b6879e487" args="(TCPSOCKET *sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutTcpStateActiveOpenEvent           </td>
          <td>(</td>
          <td class="paramtype">TCPSOCKET *&nbsp;</td>
          <td class="paramname"> <em>sock</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initiated by the application. 
<p>
The caller must make sure, that the socket is in closed state.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sock</em>&nbsp;</td><td>Socket descriptor. This pointer must have been retrieved by calling <a class="el" href="group__xg_tcp_socket.html#g6bf8ec59828c5a0e38423293b4dfe8e6" title="Create a TCP socket.">NutTcpCreateSocket()</a>.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if granted, -1 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="tcpsm_8c-source.html#l00831">831</a> of file <a class="el" href="tcpsm_8c-source.html">tcpsm.c</a>.</p>

<p>References <a class="el" href="event_8c-source.html#l00271">NutEventWait()</a>, <a class="el" href="tcp__fsm_8h-source.html#l00099">TCPS_ESTABLISHED</a>, and <a class="el" href="tcp__fsm_8h-source.html#l00097">TCPS_SYN_SENT</a>.</p>

<p>Referenced by <a class="el" href="tcpsock_8c-source.html#l00595">NutTcpConnect()</a>.</p>

</div>
</div><p>
<a class="anchor" name="ge64ae871579ec8252d41240a947f1a5e"></a><!-- doxytag: member="tcpsm.c::NutTcpStateCloseEvent" ref="ge64ae871579ec8252d41240a947f1a5e" args="(TCPSOCKET *sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutTcpStateCloseEvent           </td>
          <td>(</td>
          <td class="paramtype">TCPSOCKET *&nbsp;</td>
          <td class="paramname"> <em>sock</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Socket close by application. 
<p>
If socket is in state SYN_RECEIVED or ESTABLISHED, it is changed to FINWAIT1.<p>
No further data sending is accepted. Receiving is still allowed.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sock</em>&nbsp;</td><td>Socket descriptor. This pointer must have been retrieved by calling <a class="el" href="group__xg_tcp_socket.html#g6bf8ec59828c5a0e38423293b4dfe8e6" title="Create a TCP socket.">NutTcpCreateSocket()</a>. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="tcpsm_8c-source.html#l00863">863</a> of file <a class="el" href="tcpsm_8c-source.html">tcpsm.c</a>.</p>

<p>References <a class="el" href="errno_8h-source.html#l00095">EALREADY</a>, <a class="el" href="errno_8h-source.html#l00119">ENOTCONN</a>, <a class="el" href="tcpsock_8c-source.html#l00273">NutTcpDestroySocket()</a>, <a class="el" href="os_2thread_8c-source.html#l00468">NutThreadYield()</a>, <a class="el" href="tcp__fsm_8h-source.html#l00100">TCPS_CLOSE_WAIT</a>, <a class="el" href="tcp__fsm_8h-source.html#l00095">TCPS_CLOSED</a>, <a class="el" href="tcp__fsm_8h-source.html#l00102">TCPS_CLOSING</a>, <a class="el" href="tcp__fsm_8h-source.html#l00099">TCPS_ESTABLISHED</a>, <a class="el" href="tcp__fsm_8h-source.html#l00101">TCPS_FIN_WAIT_1</a>, <a class="el" href="tcp__fsm_8h-source.html#l00104">TCPS_FIN_WAIT_2</a>, <a class="el" href="tcp__fsm_8h-source.html#l00103">TCPS_LAST_ACK</a>, <a class="el" href="tcp__fsm_8h-source.html#l00096">TCPS_LISTEN</a>, <a class="el" href="tcp__fsm_8h-source.html#l00098">TCPS_SYN_RECEIVED</a>, <a class="el" href="tcp__fsm_8h-source.html#l00097">TCPS_SYN_SENT</a>, and <a class="el" href="tcp__fsm_8h-source.html#l00105">TCPS_TIME_WAIT</a>.</p>

<p>Referenced by <a class="el" href="tcpsock_8c-source.html#l00856">NutTcpCloseSocket()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g9f691b65c2a49fbb90202f3d45c5b000"></a><!-- doxytag: member="tcpsm.c::NutTcpStateWindowEvent" ref="g9f691b65c2a49fbb90202f3d45c5b000" args="(TCPSOCKET *sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutTcpStateWindowEvent           </td>
          <td>(</td>
          <td class="paramtype">TCPSOCKET *&nbsp;</td>
          <td class="paramname"> <em>sock</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initiated by the application. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sock</em>&nbsp;</td><td>Socket descriptor. This pointer must have been retrieved by calling <a class="el" href="group__xg_tcp_socket.html#g6bf8ec59828c5a0e38423293b4dfe8e6" title="Create a TCP socket.">NutTcpCreateSocket()</a>. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="tcpsm_8c-source.html#l00918">918</a> of file <a class="el" href="tcpsm_8c-source.html">tcpsm.c</a>.</p>

<p>References <a class="el" href="tcpout_8c-source.html#l00209">NutTcpOutput()</a>, <a class="el" href="sock__var_8h-source.html#l00273">SO_ACK</a>, and <a class="el" href="sock__var_8h-source.html#l00272">SO_FORCE</a>.</p>

<p>Referenced by <a class="el" href="tcpsock_8c-source.html#l00764">NutTcpReceive()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gd8b7767f85c9dc3cd4a1f1f961ae7a84"></a><!-- doxytag: member="tcpsm.c::NutTcpStateRetranTimeout" ref="gd8b7767f85c9dc3cd4a1f1f961ae7a84" args="(TCPSOCKET *sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutTcpStateRetranTimeout           </td>
          <td>(</td>
          <td class="paramtype">TCPSOCKET *&nbsp;</td>
          <td class="paramname"> <em>sock</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Retransmit a segment after ACK timeout. 
<p>
This function is called by the TCP timer.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sock</em>&nbsp;</td><td>Socket descriptor. This pointer must have been retrieved by calling <a class="el" href="group__xg_tcp_socket.html#g6bf8ec59828c5a0e38423293b4dfe8e6" title="Create a TCP socket.">NutTcpCreateSocket()</a>. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Nonzero if socket was aborted due to reach of retransmit limit or network error. </dd></dl>

<p>Definition at line <a class="el" href="tcpsm_8c-source.html#l00943">943</a> of file <a class="el" href="tcpsm_8c-source.html">tcpsm.c</a>.</p>

<p>References <a class="el" href="netdebug_8c-source.html#l00103">__tcp_trf</a>, <a class="el" href="netdebug_8c-source.html#l00102">__tcp_trs</a>, <a class="el" href="errno_8h-source.html#l00112">ENETDOWN</a>, <a class="el" href="errno_8h-source.html#l00122">ETIMEDOUT</a>, <a class="el" href="in_8h-source.html#l00132">IPPROTO_TCP</a>, <a class="el" href="netdebug_8c-source.html#l00105">NutDumpTcpHeader()</a>, <a class="el" href="timer_8c-source.html#l00734">NutGetMillis()</a>, <a class="el" href="ipout_8c-source.html#l00182">NutIpOutput()</a>, <a class="el" href="tcpsm_8c-source.html#l01803">NutTcpAbortSocket()</a>, and <a class="el" href="tcpsm_8c-source.html#l00272">TCP_RETRIES_MAX</a>.</p>

<p>Referenced by <a class="el" href="tcpsm_8c-source.html#l01643">NutTcpSm()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gc0a5f54bde677941f7cf555c2f89a367"></a><!-- doxytag: member="tcpsm.c::NutTcpSm" ref="gc0a5f54bde677941f7cf555c2f89a367" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NutTcpSm           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
TCP state machine thread. 
<p>
The TCP state machine serves two purposes: It processes incoming TCP segments and handles TCP timers. 
<p>Definition at line <a class="el" href="tcpsm_8c-source.html#l01643">1643</a> of file <a class="el" href="tcpsm_8c-source.html">tcpsm.c</a>.</p>

<p>References <a class="el" href="netdebug_8c-source.html#l00103">__tcp_trf</a>, <a class="el" href="netdebug_8c-source.html#l00102">__tcp_trs</a>, <a class="el" href="netdebug_8c-source.html#l00105">NutDumpTcpHeader()</a>, <a class="el" href="event_8c-source.html#l00271">NutEventWait()</a>, <a class="el" href="timer_8c-source.html#l00734">NutGetMillis()</a>, <a class="el" href="tcpsock_8c-source.html#l00273">NutTcpDestroySocket()</a>, <a class="el" href="tcpsock_8c-source.html#l00323">NutTcpFindSocket()</a>, <a class="el" href="tcpout_8c-source.html#l00209">NutTcpOutput()</a>, <a class="el" href="tcpout_8c-source.html#l00391">NutTcpReject()</a>, <a class="el" href="tcpsm_8c-source.html#l00943">NutTcpStateRetranTimeout()</a>, <a class="el" href="os_2thread_8c-source.html#l00518">NutThreadSetPriority()</a>, <a class="el" href="sock__var_8h-source.html#l00273">SO_ACK</a>, <a class="el" href="sock__var_8h-source.html#l00272">SO_FORCE</a>, <a class="el" href="tcpsm_8c-source.html#l00283">tcp_in_nbq</a>, <a class="el" href="tcpsm_8c-source.html#l00282">tcp_in_rdy</a>, <a class="el" href="tcp__fsm_8h-source.html#l00104">TCPS_FIN_WAIT_2</a>, <a class="el" href="tcp__fsm_8h-source.html#l00096">TCPS_LISTEN</a>, <a class="el" href="tcp__fsm_8h-source.html#l00098">TCPS_SYN_RECEIVED</a>, <a class="el" href="tcp__fsm_8h-source.html#l00105">TCPS_TIME_WAIT</a>, <a class="el" href="tcpsock_8c-source.html#l00238">tcpSocketList</a>, <a class="el" href="netinet_2tcp_8h-source.html#l00146">TCPHDR::th_dport</a>, and <a class="el" href="netinet_2tcp_8h-source.html#l00145">TCPHDR::th_sport</a>.</p>

<p>Referenced by <a class="el" href="tcpsm_8c-source.html#l01782">NutTcpInitStateMachine()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g3402b7ed85f67803cc473f636290d22a"></a><!-- doxytag: member="tcpsm.c::NutTcpStateMachine" ref="g3402b7ed85f67803cc473f636290d22a" args="(NETBUF *nb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NutTcpStateMachine           </td>
          <td>(</td>
          <td class="paramtype">NETBUF *&nbsp;</td>
          <td class="paramname"> <em>nb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Process incoming TCP segments. 
<p>
All incoming TCP packets are passed to this routine. They will be added to a global queue and processed by the TCP state machine, which is running on a separate thread.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This routine is called by the IP layer on incoming TCP segments. Applications typically do not call this function. </dd></dl>

<p>Definition at line <a class="el" href="tcpsm_8c-source.html#l01740">1740</a> of file <a class="el" href="tcpsm_8c-source.html">tcpsm.c</a>.</p>

<p>References <a class="el" href="event_8c-source.html#l00454">NutEventPost()</a>, <a class="el" href="heap_8h-source.html#l00076">NutHeapAvailable</a>, <a class="el" href="netbuf_8c-source.html#l00299">NutNetBufFree()</a>, <a class="el" href="tcpout_8c-source.html#l00391">NutTcpReject()</a>, <a class="el" href="tcpsm_8c-source.html#l00283">tcp_in_nbq</a>, and <a class="el" href="tcpsm_8c-source.html#l00282">tcp_in_rdy</a>.</p>

<p>Referenced by <a class="el" href="tcpin_8c-source.html#l00148">NutTcpInput()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gf4276abdc9e3a9912632c592769eb13a"></a><!-- doxytag: member="tcpsm.c::NutTcpInitStateMachine" ref="gf4276abdc9e3a9912632c592769eb13a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutTcpInitStateMachine           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Start TCP state machine. 
<p>
The socket interface will automatically call this routine as soon as the first socket is created.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="tcpsm_8c-source.html#l01782">1782</a> of file <a class="el" href="tcpsm_8c-source.html">tcpsm.c</a>.</p>

<p>References <a class="el" href="thread_8h-source.html#l00241">NUT_THREAD_STACK_ADD</a>, <a class="el" href="thread_8h-source.html#l00230">NUT_THREAD_STACK_MULT</a>, <a class="el" href="tcpsm_8c-source.html#l00267">NUT_THREAD_TCPSMSTACK</a>, <a class="el" href="tcpsm_8c-source.html#l01643">NutTcpSm()</a>, and <a class="el" href="context__gcc_8c-source.html#l00321">NutThreadCreate()</a>.</p>

<p>Referenced by <a class="el" href="tcpsock_8c-source.html#l00375">NutTcpCreateSocket()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gf821e7425534f4f62fd8ea64b0f98992"></a><!-- doxytag: member="tcpsm.c::NutTcpAbortSocket" ref="gf821e7425534f4f62fd8ea64b0f98992" args="(TCPSOCKET *sock, uint16_t last_error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutTcpAbortSocket           </td>
          <td>(</td>
          <td class="paramtype">TCPSOCKET *&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>last_error</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Closes socket with error. 
<p>
Aborts any socket activity and sets last error.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sock</em>&nbsp;</td><td>Socket descriptor. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>last_error</em>&nbsp;</td><td>Error number to report</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This routine is called internally by Nut/Net. Applications typically do not call this function.</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="tcpsm_8c-source.html#l01803">1803</a> of file <a class="el" href="tcpsm_8c-source.html">tcpsm.c</a>.</p>

<p>References <a class="el" href="event_8c-source.html#l00533">NutEventBroadcast()</a>, <a class="el" href="tcpsock_8c-source.html#l00244">NutTcpDiscardBuffers()</a>, <a class="el" href="tcp__fsm_8h-source.html#l00095">TCPS_CLOSED</a>, <a class="el" href="tcp__fsm_8h-source.html#l00101">TCPS_FIN_WAIT_1</a>, and <a class="el" href="tcp__fsm_8h-source.html#l00105">TCPS_TIME_WAIT</a>.</p>

<p>Referenced by <a class="el" href="tcpsm_8c-source.html#l00943">NutTcpStateRetranTimeout()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gcff7d63177023b5f4a6d1f9c32e7e7ab"></a><!-- doxytag: member="tcputil.c::IsInLimits" ref="gcff7d63177023b5f4a6d1f9c32e7e7ab" args="(uint32_t x, uint32_t low, uint32_t high)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int IsInLimits           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>low</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>high</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sequence number comparisons. 
<p>
Return true if x is between low and high inclusive, false otherwise 
<p>Definition at line <a class="el" href="tcputil_8c-source.html#l00086">86</a> of file <a class="el" href="tcputil_8c-source.html">tcputil.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="gf85cd27c9a8694e8098409b5f92003c7"></a><!-- doxytag: member="tcputil.c::NutTcpCalcRtt" ref="gf85cd27c9a8694e8098409b5f92003c7" args="(TCPSOCKET *sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NutTcpCalcRtt           </td>
          <td>(</td>
          <td class="paramtype">TCPSOCKET *&nbsp;</td>
          <td class="paramname"> <em>sock</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcputil_8c-source.html#l00103">103</a> of file <a class="el" href="tcputil_8c-source.html">tcputil.c</a>.</p>

<p>References <a class="el" href="tcputil_8c-source.html#l00098">max</a>, <a class="el" href="tcputil_8c-source.html#l00097">min</a>, <a class="el" href="timer_8c-source.html#l00734">NutGetMillis()</a>, <a class="el" href="tcputil_8c-source.html#l00077">TCP_RTTO_MAX</a>, and <a class="el" href="tcputil_8c-source.html#l00074">TCP_RTTO_MIN</a>.</p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="ge222ee1ca91575390b1c8eb98272b8c3"></a><!-- doxytag: member="tcpsm.c::tcp_in_rdy" ref="ge222ee1ca91575390b1c8eb98272b8c3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xg_nut_o_s.html#ga8c0374618b33785ccb02f74bcfebc46">HANDLE</a> <a class="el" href="group__xg_t_c_p.html#ge222ee1ca91575390b1c8eb98272b8c3">tcp_in_rdy</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcpsm_8c-source.html#l00282">282</a> of file <a class="el" href="tcpsm_8c-source.html">tcpsm.c</a>.</p>

<p>Referenced by <a class="el" href="tcpsm_8c-source.html#l01643">NutTcpSm()</a>, and <a class="el" href="tcpsm_8c-source.html#l01740">NutTcpStateMachine()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g08e37e1f12909836bf31c91360e6fa7f"></a><!-- doxytag: member="tcpsm.c::tcp_in_nbq" ref="g08e37e1f12909836bf31c91360e6fa7f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NETBUF* volatile <a class="el" href="group__xg_t_c_p.html#g08e37e1f12909836bf31c91360e6fa7f">tcp_in_nbq</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="tcpsm_8c-source.html#l00283">283</a> of file <a class="el" href="tcpsm_8c-source.html">tcpsm.c</a>.</p>

<p>Referenced by <a class="el" href="tcpsm_8c-source.html#l01643">NutTcpSm()</a>, and <a class="el" href="tcpsm_8c-source.html#l01740">NutTcpStateMachine()</a>.</p>

</div>
</div><p>
</div>
<hr>
<address>
  <small>
    &copy;&nbsp;2000-2007 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
