<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
    <link href="nut_entabs.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.5.8 -->
  <div class="navpath"><a class="el" href="dir_62cc943d9a5c6ffd14cbda02228b93ec.html">dev</a>
  </div>
<div class="contents">
<h1>spi_at45d.c File Reference</h1>Routines for Atmel AT45 serial DataFlash memory chips.  
<a href="#_details">More...</a>
<p>

<p>
<a href="spi__at45d_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#9606b54062f269d39e4fc8350c68471e">AT45_WRITE_POLLS</a>&nbsp;&nbsp;&nbsp;1000</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#040125696e7264e7592f88220802e4a2">SpiAt45dCommand</a> (NUTDEVICE *dev, <a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> op, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> parm, int oplen, CONST void *txbuf, void *rxbuf, int xlen)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send DataFlash command.  <a href="#040125696e7264e7592f88220802e4a2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#e1d03f2c983832328f1c9abb64442ba0">SpiAt45dStatus</a> (NUTDEVICE *dev)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Query the status of the DataFlash.  <a href="#e1d03f2c983832328f1c9abb64442ba0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#f8533b6e6328d02e9f50a6bf56410624">SpiAt45dWaitReady</a> (NUTDEVICE *dev, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> tmo, int poll)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait until DataFlash memory cycle finished.  <a href="#f8533b6e6328d02e9f50a6bf56410624"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#7d428e8797fa4c40d2f40d6abc7065b1">SpiAt45dPageErase</a> (NUTDEVICE *dev, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> pgn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Erase specified DataFlash page.  <a href="#7d428e8797fa4c40d2f40d6abc7065b1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#019516018349fe5f0ffab6ca98494025">SpiAt45dChipErase</a> (NUTDEVICE *dev)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Erase all DataFlash pages.  <a href="#019516018349fe5f0ffab6ca98494025"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#2de83058ef84bb3361b18313eda4e738">SpiAt45dInit</a> (NUTDEVICE *dev)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the DataFlash device.  <a href="#2de83058ef84bb3361b18313eda4e738"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#25cb2b6fad5064288ec0d52a86a9421d">SpiAt45dPageRead</a> (NUTDEVICE *dev, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> pgn, void *data, int len)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read data from DataFlash memory.  <a href="#25cb2b6fad5064288ec0d52a86a9421d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#7363f4646087da35b082f2bc61e5948e">SpiAt45dPageWrite</a> (NUTDEVICE *dev, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> pgn, CONST void *data, int len)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write data to DataFlash memory.  <a href="#7363f4646087da35b082f2bc61e5948e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#98cec9a103ede98743d6ff9a20c07a9f">SpiAt45dPageWrite_P</a> (NUTDEVICE *dev, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> pgn, PGM_P data, int len)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#511e65d18ee1e3223f5d077f9db35ace">SpiAt45dPages</a> (NUTDEVICE *dev)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the number of pages.  <a href="#511e65d18ee1e3223f5d077f9db35ace"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#a0c27889cf7245d2266c92c32bd0fdee">SpiAt45dPageSize</a> (NUTDEVICE *dev)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the page size.  <a href="#a0c27889cf7245d2266c92c32bd0fdee"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#b4c9fa59e861034fee22f78c0d1b2185">SpiAt45dIOCtl</a> (NUTDEVICE *dev, int req, void *conf)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform block I/O device control functions.  <a href="#b4c9fa59e861034fee22f78c0d1b2185"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">AT45D_INFO&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#146d1652724962c22682e48b0915e182">at45d_info</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Parameter table of known DataFlash types.  <a href="#146d1652724962c22682e48b0915e182"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="stdint_8h.html#d0fca8b15c218d2c687f8c373a71d228">uint_fast8_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="spi__at45d_8c.html#97b277717c25b224019c6ea5e3a4047a">at45d_known_types</a> = sizeof(<a class="el" href="spi__at45d_8c.html#146d1652724962c22682e48b0915e182">at45d_info</a>) / sizeof(AT45D_INFO)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number of known Dataflash types.  <a href="#97b277717c25b224019c6ea5e3a4047a"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Routines for Atmel AT45 serial DataFlash memory chips. 
<p>
<div class="fragment"><pre class="fragment">
 * $Id: spi_at45d.c 2469 2009-02-17 09:31:03Z haraldkipp $
 * </pre></div> 
<p>Definition in file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="9606b54062f269d39e4fc8350c68471e"></a><!-- doxytag: member="spi_at45d.c::AT45_WRITE_POLLS" ref="9606b54062f269d39e4fc8350c68471e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AT45_WRITE_POLLS&nbsp;&nbsp;&nbsp;1000          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00059">59</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="040125696e7264e7592f88220802e4a2"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dCommand" ref="040125696e7264e7592f88220802e4a2" args="(NUTDEVICE *dev, uint8_t op, uint32_t parm, int oplen, CONST void *txbuf, void *rxbuf, int xlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpiAt45dCommand           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>parm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>oplen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CONST void *&nbsp;</td>
          <td class="paramname"> <em>txbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>rxbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>xlen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send DataFlash command. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Specifies the DataFlash device. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>op</em>&nbsp;</td><td>Command operation code. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>parm</em>&nbsp;</td><td>Optional command parameter. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>oplen</em>&nbsp;</td><td>Command length. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>txbuf</em>&nbsp;</td><td>Pointer to the transmit data buffer, may be set to NULL. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rxbuf</em>&nbsp;</td><td>Pointer to the receive data buffer, may be set to NULL. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>xlen</em>&nbsp;</td><td>Number of byte to receive and/or transmit. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00195">195</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>References <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>.</p>

</div>
</div><p>
<a class="anchor" name="e1d03f2c983832328f1c9abb64442ba0"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dStatus" ref="e1d03f2c983832328f1c9abb64442ba0" args="(NUTDEVICE *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> SpiAt45dStatus           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Query the status of the DataFlash. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Specifies the Flash device.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success or -1 in case of an error. </dd></dl>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00208">208</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>References <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>.</p>

</div>
</div><p>
<a class="anchor" name="f8533b6e6328d02e9f50a6bf56410624"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dWaitReady" ref="f8533b6e6328d02e9f50a6bf56410624" args="(NUTDEVICE *dev, uint32_t tmo, int poll)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpiAt45dWaitReady           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>tmo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>poll</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Wait until DataFlash memory cycle finished. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Specifies the DataFlash device.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success or -1 in case of an error. </dd></dl>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00221">221</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>References <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>.</p>

</div>
</div><p>
<a class="anchor" name="7d428e8797fa4c40d2f40d6abc7065b1"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dPageErase" ref="7d428e8797fa4c40d2f40d6abc7065b1" args="(NUTDEVICE *dev, uint32_t pgn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpiAt45dPageErase           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>pgn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Erase specified DataFlash page. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Specifies the registered DataFlash device. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pgn</em>&nbsp;</td><td>Page number to erase, starting at 0.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success or -1 in case of an error. </dd></dl>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00235">235</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>References <a class="el" href="at45d_8h-source.html#l00079">DFCMD_PAGE_ERASE</a>, and <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>.</p>

</div>
</div><p>
<a class="anchor" name="019516018349fe5f0ffab6ca98494025"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dChipErase" ref="019516018349fe5f0ffab6ca98494025" args="(NUTDEVICE *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpiAt45dChipErase           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Erase all DataFlash pages. 
<p>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00257">257</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="2de83058ef84bb3361b18313eda4e738"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dInit" ref="2de83058ef84bb3361b18313eda4e738" args="(NUTDEVICE *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpiAt45dInit           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize the DataFlash device. 
<p>
This routine determines the DataFlash type. It is internally called by Nut/OS during device registration.<p>
The driver framework may call this function more than once.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Specifies the DataFlash device.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success or -1 if no valid DataFlash was found. </dd></dl>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00274">274</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>References <a class="el" href="spi__at45d_8c-source.html#l00063">at45d_info</a>, <a class="el" href="spi__at45d_8c-source.html#l00083">at45d_known_types</a>, <a class="el" href="at45d_8h-source.html#l00161">AT45D_STATUS_DENSITY</a>, <a class="el" href="at45d_8h-source.html#l00165">AT45D_STATUS_PAGE_SIZE</a>, and <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>.</p>

</div>
</div><p>
<a class="anchor" name="25cb2b6fad5064288ec0d52a86a9421d"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dPageRead" ref="25cb2b6fad5064288ec0d52a86a9421d" args="(NUTDEVICE *dev, uint32_t pgn, void *data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpiAt45dPageRead           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>pgn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read data from DataFlash memory. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Specifies the registered DataFlash device. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pgn</em>&nbsp;</td><td>Page number to read, starting at 0. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Points to a buffer that receives the data. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>Number of bytes to read.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The number of bytes actually read. A return value of -1 indicates an error. </dd></dl>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00314">314</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>References <a class="el" href="at45d_8h-source.html#l00148">DFCMD_CONT_READ</a>, and <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>.</p>

<p>Referenced by <a class="el" href="nvmem__at45d_8c-source.html#l00158">SpiAt45dConfigRead()</a>, and <a class="el" href="nvmem__at45d_8c-source.html#l00187">SpiAt45dConfigWrite()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7363f4646087da35b082f2bc61e5948e"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dPageWrite" ref="7363f4646087da35b082f2bc61e5948e" args="(NUTDEVICE *dev, uint32_t pgn, CONST void *data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpiAt45dPageWrite           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>pgn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CONST void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write data to DataFlash memory. 
<p>
Each page will be automatically erased before writing the data. If the last page is not completely filled with new data, the contents of remaining bytes at the end of the page is undetermined.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Specifies the registered DataFlash device. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pgn</em>&nbsp;</td><td>The page number. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Points to the buffer that contains the bytes to be written. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>Number of bytes available in the buffer. This may be less than the page size, in which case the remaining bytes of the page will be set to 0xff.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The number of bytes actually written. A return value of -1 indicates an error. </dd></dl>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00354">354</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>References <a class="el" href="at45db_8c-source.html#l00114">AT45_WRITE_POLLS</a>, <a class="el" href="at45d_8h-source.html#l00087">DFCMD_BUF1_FLASH</a>, <a class="el" href="at45d_8h-source.html#l00091">DFCMD_BUF1_WRITE</a>, and <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>.</p>

<p>Referenced by <a class="el" href="nvmem__at45d_8c-source.html#l00187">SpiAt45dConfigWrite()</a>.</p>

</div>
</div><p>
<a class="anchor" name="98cec9a103ede98743d6ff9a20c07a9f"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dPageWrite_P" ref="98cec9a103ede98743d6ff9a20c07a9f" args="(NUTDEVICE *dev, uint32_t pgn, PGM_P data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpiAt45dPageWrite_P           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>pgn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGM_P&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00408">408</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="511e65d18ee1e3223f5d077f9db35ace"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dPages" ref="511e65d18ee1e3223f5d077f9db35ace" args="(NUTDEVICE *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> SpiAt45dPages           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return the number of pages. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Specifies the registered DataFlash device.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The total number of pages available in this device. </dd></dl>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00421">421</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>References <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>.</p>

</div>
</div><p>
<a class="anchor" name="a0c27889cf7245d2266c92c32bd0fdee"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dPageSize" ref="a0c27889cf7245d2266c92c32bd0fdee" args="(NUTDEVICE *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpiAt45dPageSize           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return the page size. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Specifies the registered DataFlash device.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The number of bytes per page. </dd></dl>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00440">440</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>References <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>.</p>

<p>Referenced by <a class="el" href="nvmem__at45d_8c-source.html#l00134">SpiAt45dConfigSize()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b4c9fa59e861034fee22f78c0d1b2185"></a><!-- doxytag: member="spi_at45d.c::SpiAt45dIOCtl" ref="b4c9fa59e861034fee22f78c0d1b2185" args="(NUTDEVICE *dev, int req, void *conf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SpiAt45dIOCtl           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>conf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Perform block I/O device control functions. 
<p>
This function is called by the ioctl() function of the C runtime library. Applications should not directly call this function.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Identifies the device that receives the control command. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>req</em>&nbsp;</td><td>Requested control command. May be set to one of the following constants:<ul>
<li><a class="el" href="group__xg_block_dev.html#gd5bcfe283715d269e64a3d70fa58c3d3">NUTBLKDEV_MEDIAAVAIL</a></li><li><a class="el" href="group__xg_block_dev.html#g0021380fd206ad6327ee752d3df8722c">NUTBLKDEV_MEDIACHANGE</a></li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conf</em>&nbsp;</td><td>Points to a buffer that contains any data required for the given control function or receives data from that function. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00469">469</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>References <a class="el" href="nutdebug_8h-source.html#l00047">NUTASSERT</a>, <a class="el" href="blockdev_8h-source.html#l00076">NUTBLKDEV_MEDIAAVAIL</a>, and <a class="el" href="blockdev_8h-source.html#l00078">NUTBLKDEV_MEDIACHANGE</a>.</p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="146d1652724962c22682e48b0915e182"></a><!-- doxytag: member="spi_at45d.c::at45d_info" ref="146d1652724962c22682e48b0915e182" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AT45D_INFO <a class="el" href="spi__at45d_8c.html#146d1652724962c22682e48b0915e182">at45d_info</a>[]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
    {8, 512, 256, 0x0D},    
    {9, 512, 264, 0x0C},    
    {8, 1025, 256, 0x15},   
    {9, 1025, 264, 0x14},   
    {8, 2048, 256, 0x1D},   
    {9, 2048, 264, 0x1C},   
    {8, 4096, 256, 0x25},   
    {9, 4096, 264, 0x24},   
    {9, 4096, 512, 0x2D},   
    {10, 4096, 528, 0x2C},  
    {9, 8192, 512, 0x35},   
    {10, 8192, 528, 0x34},  
    {10, 8192, 1024, 0x39}, 
    {11, 8192, 1056, 0x38}, 
    {10, 8192, 1024, 0x3D}, 
    {11, 8192, 1056, 0x3C}  
}
</pre></div>Parameter table of known DataFlash types. 
<p>
<a class="el" href="struct_table.html">Table</a> of known AT45D DataFlash chips. 
<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00063">63</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>Referenced by <a class="el" href="spi__at45d_8c-source.html#l00274">SpiAt45dInit()</a>.</p>

</div>
</div><p>
<a class="anchor" name="97b277717c25b224019c6ea5e3a4047a"></a><!-- doxytag: member="spi_at45d.c::at45d_known_types" ref="97b277717c25b224019c6ea5e3a4047a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#d0fca8b15c218d2c687f8c373a71d228">uint_fast8_t</a> <a class="el" href="spi__at45d_8c.html#97b277717c25b224019c6ea5e3a4047a">at45d_known_types</a> = sizeof(<a class="el" href="spi__at45d_8c.html#146d1652724962c22682e48b0915e182">at45d_info</a>) / sizeof(AT45D_INFO)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Number of known Dataflash types. 
<p>
Number of known AT45D DataFlash chips. 
<p>Definition at line <a class="el" href="spi__at45d_8c-source.html#l00083">83</a> of file <a class="el" href="spi__at45d_8c-source.html">spi_at45d.c</a>.</p>

<p>Referenced by <a class="el" href="spi__at45d_8c-source.html#l00274">SpiAt45dInit()</a>.</p>

</div>
</div><p>
</div>
<hr>
<address>
  <small>
    &copy;&nbsp;2000-2007 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
