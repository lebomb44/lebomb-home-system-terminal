<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
    <link href="nut_entabs.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.5.8 -->
  <div class="navpath"><a class="el" href="dir_264e76a43993b4d38befcb6805fdec2d.html">arch</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_b0f1ad2db40117979aa0dc775463a1e9.html">avr</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_42e6833dcb69f3de75c6e85ab40d9c56.html">dev</a>
  </div>
<div class="contents">
<h1>twif.c File Reference</h1>
<p>
<a href="twif_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#198f849db20e64b46fa8bef175d28f25">TWGO</a>&nbsp;&nbsp;&nbsp;(_BV(TWINT) | _BV(TWEN) | _BV(TWIE))</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#be6654261c61050f912f4ad48458d7d2">TwMasterTransact</a> (<a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> sla, CONST void *txdata, <a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> txlen, void *rxdata, <a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> rxsiz, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> tmo)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Transmit and/or receive data as a master.  <a href="#be6654261c61050f912f4ad48458d7d2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#0910c498af43ca35a28b6c64c40d5b76">TwMasterError</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get last master mode error.  <a href="#0910c498af43ca35a28b6c64c40d5b76"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#69848f265d7dff23405ea1828291dcea">TwSlaveListen</a> (<a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *sla, void *rxdata, <a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> rxsiz, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> tmo)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Listen for incoming data from a master.  <a href="#69848f265d7dff23405ea1828291dcea"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#12625373101d9bb50d9ed3dc110c688b">TwSlaveRespond</a> (void *txdata, <a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> txlen, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> tmo)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send response to a master.  <a href="#12625373101d9bb50d9ed3dc110c688b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#161d4c6c2556a7fb89b151de29283392">TwSlaveError</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get last slave mode error.  <a href="#161d4c6c2556a7fb89b151de29283392"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#f49042cc4abc3b12378155db4af11924">TwIOCtl</a> (int req, void *conf)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform TWI control functions.  <a href="#f49042cc4abc3b12378155db4af11924"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#a4c8ead7d93be00c8a12be08e64f1666">TwInit</a> (<a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> sla)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize TWI interface.  <a href="#a4c8ead7d93be00c8a12be08e64f1666"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__xg_nut_o_s.html#ga8c0374618b33785ccb02f74bcfebc46">HANDLE</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#2b886224aacbdff4e8de2e98d9c8d46e">tw_mm_mutex</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__xg_nut_o_s.html#ga8c0374618b33785ccb02f74bcfebc46">HANDLE</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#04eb2cceefe8181b0369e69228deb1bb">tw_mm_que</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__xg_nut_o_s.html#ga8c0374618b33785ccb02f74bcfebc46">HANDLE</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#655239bad31f807ca3b158a6d9269468">tw_sr_que</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="group__xg_nut_o_s.html#ga8c0374618b33785ccb02f74bcfebc46">HANDLE</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twif_8c.html#ca176cd0cd741b73b6a16e8414fe1a93">tw_st_que</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="198f849db20e64b46fa8bef175d28f25"></a><!-- doxytag: member="twif.c::TWGO" ref="198f849db20e64b46fa8bef175d28f25" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TWGO&nbsp;&nbsp;&nbsp;(_BV(TWINT) | _BV(TWEN) | _BV(TWIE))          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00143">143</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

<p>Referenced by <a class="el" href="twif_8c-source.html#l00727">TwSlaveRespond()</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="be6654261c61050f912f4ad48458d7d2"></a><!-- doxytag: member="twif.c::TwMasterTransact" ref="be6654261c61050f912f4ad48458d7d2" args="(uint8_t sla, CONST void *txdata, uint16_t txlen, void *rxdata, uint16_t rxsiz, uint32_t tmo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TwMasterTransact           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>sla</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CONST void *&nbsp;</td>
          <td class="paramname"> <em>txdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>txlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>rxdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>rxsiz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>tmo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Transmit and/or receive data as a master. 
<p>
The two-wire serial interface must have been initialized by calling <a class="el" href="group__xg_at91_twi.html#ga4c8ead7d93be00c8a12be08e64f1666" title="Initialize TWI interface.">TwInit()</a> before this function can be used.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This function is only available on ATmega128 systems.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sla</em>&nbsp;</td><td>Slave address of the destination. This slave address must be specified as a 7-bit address. For example, the PCF8574A may be configured to slave addresses from 0x38 to 0x3F. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>txdata</em>&nbsp;</td><td>Points to the data to transmit. Ignored, if the number of data bytes to transmit is zero. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>txlen</em>&nbsp;</td><td>Number of data bytes to transmit. If zero, then the interface will not send any data to the slave device and will directly enter the master receive mode. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rxdata</em>&nbsp;</td><td>Points to a buffer, where the received data will be stored. Ignored, if the maximum number of bytes to receive is zero. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rxsiz</em>&nbsp;</td><td>Maximum number of bytes to receive. Set to zero, if no bytes are expected from the slave device. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tmo</em>&nbsp;</td><td>Timeout in milliseconds. To disable timeout, set this parameter to NUT_WAIT_INFINITE.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The number of bytes received, -1 in case of an error or timeout. </dd></dl>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00535">535</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

<p>References <a class="el" href="arm_8h-source.html#l00201">_BV</a>, <a class="el" href="arm_8h-source.html#l00197">inb</a>, <a class="el" href="include_2arch_2arm_2atom_8h-source.html#l00136">NutEnterCritical</a>, <a class="el" href="event_8c-source.html#l00454">NutEventPost()</a>, <a class="el" href="event_8c-source.html#l00271">NutEventWait()</a>, <a class="el" href="include_2arch_2arm_2atom_8h-source.html#l00147">NutExitCritical</a>, <a class="el" href="timer_8c-source.html#l00610">NutSleep()</a>, <a class="el" href="arm_8h-source.html#l00193">outb</a>, <a class="el" href="event_8h-source.html#l00120">SIGNALED</a>, <a class="el" href="twif_8c-source.html#l00109">tw_mm_mutex</a>, <a class="el" href="twif_8c-source.html#l00110">tw_mm_que</a>, <a class="el" href="twif_8h-source.html#l00066">TWERR_IF_LOCKED</a>, and <a class="el" href="twif_8h-source.html#l00064">TWERR_TIMEOUT</a>.</p>

</div>
</div><p>
<a class="anchor" name="0910c498af43ca35a28b6c64c40d5b76"></a><!-- doxytag: member="twif.c::TwMasterError" ref="0910c498af43ca35a28b6c64c40d5b76" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TwMasterError           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get last master mode error. 
<p>
You may call this function to determine the specific cause of an error after <a class="el" href="group__xg_at91_twi.html#gbe6654261c61050f912f4ad48458d7d2" title="Transmit and/or receive data as a master.">TwMasterTransact()</a> failed.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This function is only available on ATmega128 systems. </dd></dl>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00620">620</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="69848f265d7dff23405ea1828291dcea"></a><!-- doxytag: member="twif.c::TwSlaveListen" ref="69848f265d7dff23405ea1828291dcea" args="(uint8_t *sla, void *rxdata, uint16_t rxsiz, uint32_t tmo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TwSlaveListen           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *&nbsp;</td>
          <td class="paramname"> <em>sla</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>rxdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>rxsiz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>tmo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Listen for incoming data from a master. 
<p>
If this function returns without error, the bus is blocked. The caller must immediately process the request and return a response by calling <a class="el" href="twif_8h.html#12625373101d9bb50d9ed3dc110c688b" title="Send response to a master.">TwSlaveRespond()</a>.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This function is only available on ATmega128 systems. The function is not reentrant.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sla</em>&nbsp;</td><td>Points to a byte variable, which receives the slave address sent by the master. This can be used by the caller to determine whether the the interface has been addressed by a general call or its individual address. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rxdata</em>&nbsp;</td><td>Points to a data buffer where the received data bytes are stored. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rxsiz</em>&nbsp;</td><td>Specifies the maximum number of data bytes to receive. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tmo</em>&nbsp;</td><td>Timeout in milliseconds. To disable timeout, set this parameter to NUT_WAIT_INFINITE.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The number of bytes received, -1 in case of an error or timeout. </dd></dl>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00653">653</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

<p>References <a class="el" href="arm_8h-source.html#l00201">_BV</a>, <a class="el" href="arm_8h-source.html#l00197">inb</a>, <a class="el" href="include_2arch_2arm_2atom_8h-source.html#l00136">NutEnterCritical</a>, <a class="el" href="event_8c-source.html#l00271">NutEventWait()</a>, <a class="el" href="include_2arch_2arm_2atom_8h-source.html#l00147">NutExitCritical</a>, <a class="el" href="arm_8h-source.html#l00193">outb</a>, <a class="el" href="event_8h-source.html#l00120">SIGNALED</a>, <a class="el" href="twif_8c-source.html#l00111">tw_sr_que</a>, and <a class="el" href="twif_8h-source.html#l00064">TWERR_TIMEOUT</a>.</p>

</div>
</div><p>
<a class="anchor" name="12625373101d9bb50d9ed3dc110c688b"></a><!-- doxytag: member="twif.c::TwSlaveRespond" ref="12625373101d9bb50d9ed3dc110c688b" args="(void *txdata, uint16_t txlen, uint32_t tmo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TwSlaveRespond           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>txdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>txlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>tmo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send response to a master. 
<p>
This function must be called as soon as possible after <a class="el" href="twif_8h.html#69848f265d7dff23405ea1828291dcea" title="Listen for incoming data from a master.">TwSlaveListen()</a> returned successfully, even if no data needs to be returned. Not doing so will completely block the bus.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This function is only available on ATmega128 systems.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>txdata</em>&nbsp;</td><td>Points to the data to transmit. Ignored, if the number of bytes to transmit is zero. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>txlen</em>&nbsp;</td><td>Number of data bytes to transmit. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tmo</em>&nbsp;</td><td>Timeout in milliseconds. To disable timeout, set this parameter to NUT_WAIT_INFINITE.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The number of bytes transmitted, -1 in case of an error or timeout. </dd></dl>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00727">727</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

<p>References <a class="el" href="arm_8h-source.html#l00201">_BV</a>, <a class="el" href="arm_8h-source.html#l00197">inb</a>, <a class="el" href="include_2arch_2arm_2atom_8h-source.html#l00136">NutEnterCritical</a>, <a class="el" href="event_8c-source.html#l00271">NutEventWait()</a>, <a class="el" href="include_2arch_2arm_2atom_8h-source.html#l00147">NutExitCritical</a>, <a class="el" href="arm_8h-source.html#l00193">outb</a>, <a class="el" href="event_8h-source.html#l00120">SIGNALED</a>, <a class="el" href="twif_8c-source.html#l00112">tw_st_que</a>, <a class="el" href="twif_8h-source.html#l00064">TWERR_TIMEOUT</a>, and <a class="el" href="twif_8c-source.html#l00143">TWGO</a>.</p>

</div>
</div><p>
<a class="anchor" name="161d4c6c2556a7fb89b151de29283392"></a><!-- doxytag: member="twif.c::TwSlaveError" ref="161d4c6c2556a7fb89b151de29283392" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TwSlaveError           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get last slave mode error. 
<p>
You may call this function to determine the specific cause of an error after <a class="el" href="twif_8h.html#69848f265d7dff23405ea1828291dcea" title="Listen for incoming data from a master.">TwSlaveListen()</a> or <a class="el" href="twif_8h.html#12625373101d9bb50d9ed3dc110c688b" title="Send response to a master.">TwSlaveRespond()</a> failed.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This function is only available on ATmega128 systems. </dd></dl>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00802">802</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="f49042cc4abc3b12378155db4af11924"></a><!-- doxytag: member="twif.c::TwIOCtl" ref="f49042cc4abc3b12378155db4af11924" args="(int req, void *conf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TwIOCtl           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>conf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Perform TWI control functions. 
<p>
This function is only available on ATmega128 systems.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>req</em>&nbsp;</td><td>Requested control function. May be set to one of the following constants:<ul>
<li>TWI_SETSPEED, if conf points to an uint32_t value containing the bitrate.</li><li>TWI_GETSPEED, if conf points to an uint32_t value receiving the current bitrate. </li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conf</em>&nbsp;</td><td>Points to a buffer that contains any data required for the given control function or receives data from that function. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise.</dd></dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Timeout is limited to the granularity of the system timer. </dd></dl>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00830">830</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

<p>References <a class="el" href="icc_8h-source.html#l00272">bit_is_set</a>, <a class="el" href="icc_8h-source.html#l00265">cbi</a>, <a class="el" href="arm_8h-source.html#l00197">inb</a>, <a class="el" href="timer_8c-source.html#l00800">NutGetCpuClock()</a>, <a class="el" href="arm_8h-source.html#l00193">outb</a>, <a class="el" href="icc_8h-source.html#l00266">sbi</a>, <a class="el" href="twif_8h-source.html#l00058">TWI_GETSLAVEADDRESS</a>, <a class="el" href="twif_8h-source.html#l00056">TWI_GETSPEED</a>, <a class="el" href="twif_8h-source.html#l00060">TWI_GETSTATUS</a>, <a class="el" href="twif_8h-source.html#l00057">TWI_SETSLAVEADDRESS</a>, <a class="el" href="twif_8h-source.html#l00055">TWI_SETSPEED</a>, and <a class="el" href="twif_8h-source.html#l00059">TWI_SETSTATUS</a>.</p>

</div>
</div><p>
<a class="anchor" name="a4c8ead7d93be00c8a12be08e64f1666"></a><!-- doxytag: member="twif.c::TwInit" ref="a4c8ead7d93be00c8a12be08e64f1666" args="(uint8_t sla)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TwInit           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>sla</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize TWI interface. 
<p>
The specified slave address is used only, if the local system is running as a slave. Anyway, care must be taken that it doesn't conflict with another connected device.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This function is only available on ATmega128 systems.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sla</em>&nbsp;</td><td>Slave address, must be specified as a 7-bit address, always lower than 128. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00902">902</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

<p>References <a class="el" href="arm_8h-source.html#l00201">_BV</a>, <a class="el" href="event_8c-source.html#l00454">NutEventPost()</a>, <a class="el" href="ihndlr_8c-source.html#l00098">NutRegisterIrqHandler()</a>, <a class="el" href="arm_8h-source.html#l00193">outb</a>, <a class="el" href="arch_2avr_2irqreg_8h.html#5c3f23bef0207822b0bfdc43204a0e66">sig_2WIRE_SERIAL</a>, <a class="el" href="twif_8c-source.html#l00109">tw_mm_mutex</a>, <a class="el" href="twif_8h-source.html#l00055">TWI_SETSPEED</a>, and <a class="el" href="twif_8c-source.html#l00830">TwIOCtl()</a>.</p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="2b886224aacbdff4e8de2e98d9c8d46e"></a><!-- doxytag: member="twif.c::tw_mm_mutex" ref="2b886224aacbdff4e8de2e98d9c8d46e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xg_nut_o_s.html#ga8c0374618b33785ccb02f74bcfebc46">HANDLE</a> <a class="el" href="twif_8c.html#2b886224aacbdff4e8de2e98d9c8d46e">tw_mm_mutex</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00109">109</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

<p>Referenced by <a class="el" href="at91__twi_8c-source.html#l00503">TwInit()</a>, <a class="el" href="at91__twi_8c-source.html#l00269">TwMasterRegRead()</a>, <a class="el" href="at91__twi_8c-source.html#l00344">TwMasterRegWrite()</a>, and <a class="el" href="at91__twi_8c-source.html#l00173">TwMasterTransact()</a>.</p>

</div>
</div><p>
<a class="anchor" name="04eb2cceefe8181b0369e69228deb1bb"></a><!-- doxytag: member="twif.c::tw_mm_que" ref="04eb2cceefe8181b0369e69228deb1bb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xg_nut_o_s.html#ga8c0374618b33785ccb02f74bcfebc46">HANDLE</a> <a class="el" href="twif_8c.html#04eb2cceefe8181b0369e69228deb1bb">tw_mm_que</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00110">110</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

<p>Referenced by <a class="el" href="at91__twi_8c-source.html#l00269">TwMasterRegRead()</a>, <a class="el" href="at91__twi_8c-source.html#l00344">TwMasterRegWrite()</a>, and <a class="el" href="at91__twi_8c-source.html#l00173">TwMasterTransact()</a>.</p>

</div>
</div><p>
<a class="anchor" name="655239bad31f807ca3b158a6d9269468"></a><!-- doxytag: member="twif.c::tw_sr_que" ref="655239bad31f807ca3b158a6d9269468" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xg_nut_o_s.html#ga8c0374618b33785ccb02f74bcfebc46">HANDLE</a> <a class="el" href="twif_8c.html#655239bad31f807ca3b158a6d9269468">tw_sr_que</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00111">111</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

<p>Referenced by <a class="el" href="twif_8c-source.html#l00653">TwSlaveListen()</a>.</p>

</div>
</div><p>
<a class="anchor" name="ca176cd0cd741b73b6a16e8414fe1a93"></a><!-- doxytag: member="twif.c::tw_st_que" ref="ca176cd0cd741b73b6a16e8414fe1a93" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__xg_nut_o_s.html#ga8c0374618b33785ccb02f74bcfebc46">HANDLE</a> <a class="el" href="twif_8c.html#ca176cd0cd741b73b6a16e8414fe1a93">tw_st_que</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="twif_8c-source.html#l00112">112</a> of file <a class="el" href="twif_8c-source.html">twif.c</a>.</p>

<p>Referenced by <a class="el" href="twif_8c-source.html#l00727">TwSlaveRespond()</a>.</p>

</div>
</div><p>
</div>
<hr>
<address>
  <small>
    &copy;&nbsp;2000-2007 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
