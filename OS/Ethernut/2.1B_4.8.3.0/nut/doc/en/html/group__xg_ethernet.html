<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
    <link href="nut_entabs.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="contents">
<h1>Ethernet<br>
<small>
[<a class="el" href="group__xg_base_pro.html">Base Protocols</a>]</small>
</h1>RFC 894 IP over Ethernet.  
<a href="#_details">More...</a>
<p>

<p>
<div class="dynheader">
Collaboration diagram for Ethernet:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__xg_ethernet.png" border="0" alt="" usemap="#group____xg__ethernet_map">
<map name="group____xg__ethernet_map">
<area shape="rect" href="group__xg_base_pro.html" title="TCP/IP and UDP applications." alt="Base Protocols" coords="19,5,117,26"></map></td></tr></table></center>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_ethernet.html#gddf38bba503e95ba7da14e23c4246cad">NutRegisterEthHandler</a> (<a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> type, <a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> mask, int(*hdlr)(NUTDEVICE *, NETBUF *))</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register an additional Ethernet protocol handler.  <a href="#gddf38bba503e95ba7da14e23c4246cad"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_ethernet.html#g99fa1136157a0400962096b3e426ee2f">NutEtherInput</a> (NUTDEVICE *dev, NETBUF *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle incoming Ethernet frames.  <a href="#g99fa1136157a0400962096b3e426ee2f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_ethernet.html#g5342e8b68b9af648aa943a9a9166099b">NutEtherOutput</a> (NUTDEVICE *dev, <a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> type, <a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *ha, NETBUF *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send Ethernet frame.  <a href="#g5342e8b68b9af648aa943a9a9166099b"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_ethernet.html#g6710e3ff8f687881079642c7a715c5a5">ether_demux</a> )(NUTDEVICE *, NETBUF *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pointer to an optional demultiplexer.  <a href="#g6710e3ff8f687881079642c7a715c5a5"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
RFC 894 IP over Ethernet. 
<p>
These routines link the IP layer to the Ethernet driver. Applications do not directly use this.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd>Multicast support. </dd></dl>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="gddf38bba503e95ba7da14e23c4246cad"></a><!-- doxytag: member="ethdemux.c::NutRegisterEthHandler" ref="gddf38bba503e95ba7da14e23c4246cad" args="(uint16_t type, uint16_t mask, int(*hdlr)(NUTDEVICE *, NETBUF *))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutRegisterEthHandler           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(NUTDEVICE *, NETBUF *)&nbsp;</td>
          <td class="paramname"> <em>hdlr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Register an additional Ethernet protocol handler. 
<p>
The specified mask will be applied on the type field of incoming frames before compared with the type that had been specified for the handler. If more than one handler is registered for an incoming Ethernet frame, the handler being registered last is called first.<p>
Each handler should return 0 if it processed the frame, in which case it is also assumed, that the handler releases the memory allocated for the NETBUF. Otherwise the handler should return -1, in which case the frame is passed to the next handler that fits.<p>
The protocol types ETHERTYPE_IP and ETHERTYPE_ARP are pre-registered by default and processed by internal handlers after all registered handlers for that frame rejected processing. This allows to install filters on the Ethernet level.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>Ethernet protocol type processed by this handler. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mask</em>&nbsp;</td><td>Ethernet protocol type mask. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hdlr</em>&nbsp;</td><td>Pointer to the protocol handler function. If NULL, the handler will be temporarily disabled.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="ethdemux_8c-source.html#l00125">125</a> of file <a class="el" href="ethdemux_8c-source.html">ethdemux.c</a>.</p>

<p>References <a class="el" href="icc_8h-source.html#l00143">calloc</a>, and <a class="el" href="group__xg_ethernet.html#g6710e3ff8f687881079642c7a715c5a5">ether_demux</a>.</p>

</div>
</div><p>
<a class="anchor" name="g99fa1136157a0400962096b3e426ee2f"></a><!-- doxytag: member="ethin.c::NutEtherInput" ref="g99fa1136157a0400962096b3e426ee2f" args="(NUTDEVICE *dev, NETBUF *nb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NutEtherInput           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NETBUF *&nbsp;</td>
          <td class="paramname"> <em>nb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle incoming Ethernet frames. 
<p>
Splits the Ethernet frame into the data link and the network part. Then the frame is routed to the proper handler, based on the type field in the Ethernet header.<p>
If the frame neither contains an IP nor an ARP type telegram and if no registered handler exists or accepts the frame, then it is silently discarded.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This routine is called by the device driver on incoming ethernet packets. Applications typically do not call this function.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Identifies the device that received the frame. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb</em>&nbsp;</td><td>Pointer to a network buffer structure containing the ethernet frame. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="ethin_8c-source.html#l00156">156</a> of file <a class="el" href="ethin_8c-source.html">ethin.c</a>.</p>

<p>References <a class="el" href="group__xg_ethernet.html#g6710e3ff8f687881079642c7a715c5a5">ether_demux</a>, <a class="el" href="if__ether_8h-source.html#l00088">ETHERHDR::ether_type</a>, <a class="el" href="if__ether_8h-source.html#l00104">ETHERTYPE_ARP</a>, <a class="el" href="if__ether_8h-source.html#l00103">ETHERTYPE_IP</a>, <a class="el" href="types_8h-source.html#l00339">ntohs</a>, <a class="el" href="arpin_8c-source.html#l00143">NutArpInput()</a>, <a class="el" href="ipin_8c-source.html#l00165">NutIpInput()</a>, and <a class="el" href="netbuf_8c-source.html#l00299">NutNetBufFree()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g5342e8b68b9af648aa943a9a9166099b"></a><!-- doxytag: member="ethout.c::NutEtherOutput" ref="g5342e8b68b9af648aa943a9a9166099b" args="(NUTDEVICE *dev, uint16_t type, uint8_t *ha, NETBUF *nb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutEtherOutput           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *&nbsp;</td>
          <td class="paramname"> <em>ha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NETBUF *&nbsp;</td>
          <td class="paramname"> <em>nb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send Ethernet frame. 
<p>
Send an Ethernet frame of a given type using the specified device.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Identifies the device to use. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>Type of this frame, either ETHERTYPE_IP or ETHERTYPE_ARP. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ha</em>&nbsp;</td><td>MAC address of the destination, set null for broadcasts. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb</em>&nbsp;</td><td>Network buffer structure containing the packet to be sent. The structure must have been allocated by a previous call <a class="el" href="group__xgnetbuf.html#g7a733aed1e6c15aaabb6657abe5f4e39" title="Allocate or re-allocate a network buffer part.">NutNetBufAlloc()</a> and will be freed if this function returns with an error.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, -1 in case of any errors. </dd></dl>

<p>Definition at line <a class="el" href="ethout_8c-source.html#l00144">144</a> of file <a class="el" href="ethout_8c-source.html">ethout.c</a>.</p>

<p>References <a class="el" href="if__ether_8h-source.html#l00084">ETHERHDR::ether_dhost</a>, <a class="el" href="if__ether_8h-source.html#l00086">ETHERHDR::ether_shost</a>, <a class="el" href="if__ether_8h-source.html#l00088">ETHERHDR::ether_type</a>, <a class="el" href="types_8h-source.html#l00321">htons</a>, <a class="el" href="memcpy_8c-source.html#l00114">memcpy()</a>, <a class="el" href="memset_8c-source.html#l00088">memset()</a>, <a class="el" href="netbuf_8h-source.html#l00129">NBAF_DATALINK</a>, <a class="el" href="netbuf_8c-source.html#l00173">NutNetBufAlloc()</a>, and <a class="el" href="netbuf_8c-source.html#l00299">NutNetBufFree()</a>.</p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="g6710e3ff8f687881079642c7a715c5a5"></a><!-- doxytag: member="ethin.c::ether_demux" ref="g6710e3ff8f687881079642c7a715c5a5" args=")(NUTDEVICE *, NETBUF *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="group__xg_ethernet.html#g6710e3ff8f687881079642c7a715c5a5">ether_demux</a>)(NUTDEVICE *, NETBUF *)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Pointer to an optional demultiplexer. 
<p>
This pointer will be set on the first call to <a class="el" href="group__xg_ethernet.html#gddf38bba503e95ba7da14e23c4246cad" title="Register an additional Ethernet protocol handler.">NutRegisterEthHandler()</a>. 
<p>Referenced by <a class="el" href="ethin_8c-source.html#l00156">NutEtherInput()</a>, and <a class="el" href="ethdemux_8c-source.html#l00125">NutRegisterEthHandler()</a>.</p>

</div>
</div><p>
</div>
<hr>
<address>
  <small>
    &copy;&nbsp;2000-2007 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
