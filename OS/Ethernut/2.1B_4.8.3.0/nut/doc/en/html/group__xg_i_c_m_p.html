<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
    <link href="nut_entabs.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="contents">
<h1>ICMP<br>
<small>
[<a class="el" href="group__xg_base_pro.html">Base Protocols</a>]</small>
</h1>RFC 792 Internet Control Message Protocol.  
<a href="#_details">More...</a>
<p>

<p>
<div class="dynheader">
Collaboration diagram for ICMP:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__xg_i_c_m_p.png" border="0" alt="" usemap="#group____xg__i__c__m__p_map">
<map name="group____xg__i__c__m__p_map">
<area shape="rect" href="group__xg_base_pro.html" title="TCP/IP and UDP applications." alt="Base Protocols" coords="19,5,117,26"></map></td></tr></table></center>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_i_c_m_p.html#g39892eead0894298fcbacab426715720">NutIcmpInput</a> (NUTDEVICE *dev, NETBUF *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle incoming ICMP packets.  <a href="#g39892eead0894298fcbacab426715720"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_i_c_m_p.html#g66717aa9878b74c9e5801996b7de7431">NutIcmpOutput</a> (<a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> type, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> dest, NETBUF *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send an ICMP datagram.  <a href="#g66717aa9878b74c9e5801996b7de7431"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_i_c_m_p.html#ga1a3c8e2fce88cb2ed41e6bf106e49be">NutIcmpReply</a> (<a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> type, <a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> code, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> spec, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> dest, NETBUF *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send an ICMP message to a given destination.  <a href="#ga1a3c8e2fce88cb2ed41e6bf106e49be"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xg_i_c_m_p.html#g387c1b71bb0ec69aa6467bdcedefbe26">NutIcmpResponse</a> (<a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> type, <a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> code, <a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a> spec, NETBUF *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send an ICMP message as a response to a given destination.  <a href="#g387c1b71bb0ec69aa6467bdcedefbe26"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
RFC 792 Internet Control Message Protocol. 
<p>
Provides routing, diagnostic and error functionality for IP. Although ICMP messages are encapsulated within IP datagrams, ICMP processing is considered to be part of the IP layer.<p>
There is currently no API support for this layer. <hr><h2>Function Documentation</h2>
<a class="anchor" name="g39892eead0894298fcbacab426715720"></a><!-- doxytag: member="icmpin.c::NutIcmpInput" ref="g39892eead0894298fcbacab426715720" args="(NUTDEVICE *dev, NETBUF *nb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NutIcmpInput           </td>
          <td>(</td>
          <td class="paramtype">NUTDEVICE *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NETBUF *&nbsp;</td>
          <td class="paramname"> <em>nb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle incoming ICMP packets. 
<p>
Incoming ICMP packets are processed in the background. NutNet currently handles echo request and destination unreachable packets. Any other packet type is silently discarded.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This routine is called by the IP layer on incoming ICMP datagrams. Applications typically do not call this function.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Identifies the device that received the packet. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb</em>&nbsp;</td><td>Pointer to a network buffer structure containing the ICMP datagram. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="icmpin_8c-source.html#l00261">261</a> of file <a class="el" href="icmpin_8c-source.html">icmpin.c</a>.</p>

<p>References <a class="el" href="ip__icmp_8h-source.html#l00168">ICMPHDR::icmp_code</a>, <a class="el" href="ip__icmp_8h-source.html#l00138">ICMP_ECHO</a>, <a class="el" href="ip__icmp_8h-source.html#l00117">ICMP_ECHOREPLY</a>, <a class="el" href="ip__icmp_8h-source.html#l00167">ICMPHDR::icmp_type</a>, <a class="el" href="ip__icmp_8h-source.html#l00118">ICMP_UNREACH</a>, and <a class="el" href="netbuf_8c-source.html#l00299">NutNetBufFree()</a>.</p>

<p>Referenced by <a class="el" href="ipin_8c-source.html#l00165">NutIpInput()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g66717aa9878b74c9e5801996b7de7431"></a><!-- doxytag: member="icmpout.c::NutIcmpOutput" ref="g66717aa9878b74c9e5801996b7de7431" args="(uint8_t type, uint32_t dest, NETBUF *nb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutIcmpOutput           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NETBUF *&nbsp;</td>
          <td class="paramname"> <em>nb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send an ICMP datagram. 
<p>
Known ICMP types are:<p>
<ul>
<li><a class="el" href="ip__icmp_8h.html#82c3c22ccc3ab020f598fa6832a78d12" title="Echo reply type.">ICMP_ECHOREPLY</a> Echo reply</li><li><a class="el" href="ip__icmp_8h.html#d3a53e748928a6746ecf58e63a37a76a" title="Destination unreachable type.">ICMP_UNREACH</a> Destination unreachable</li><li><a class="el" href="ip__icmp_8h.html#8504ceb34b1a35c57b9d5ae26ad4b2c6" title="Packet lost type.">ICMP_SOURCEQUENCH</a> Packet lost</li><li><a class="el" href="ip__icmp_8h.html#4e35dd983f67e5e07de127890143152a" title="Shorter route type.">ICMP_REDIRECT</a> Shorter route</li><li><a class="el" href="ip__icmp_8h.html#d58231410d58e34b455328b888a9e73c" title="Echo reply type.">ICMP_ECHO</a> Echo reply</li><li><a class="el" href="ip__icmp_8h.html#378e8c9e15b519665b52161df53eea56" title="Router advertisement type.">ICMP_ROUTERADVERT</a> Router advertisement</li><li><a class="el" href="ip__icmp_8h.html#3c94ac7432cd169ab5c9ef37d50ad981" title="Router solicitation type.">ICMP_ROUTERSOLICIT</a> Router solicitation</li><li><a class="el" href="ip__icmp_8h.html#8e3af9a982f823093f685c01ea77903c" title="Time exceeded type.">ICMP_TIMXCEED</a> Time exceeded</li><li><a class="el" href="ip__icmp_8h.html#a4319c170ff4577ab7bd22a070643db7" title="Bad IP header type.">ICMP_PARAMPROB</a> Bad IP header</li><li><a class="el" href="ip__icmp_8h.html#62bf3a7886f5cbbd6f0f67303a39fc8f" title="Timestamp request type.">ICMP_TSTAMP</a> Timestamp request</li><li><a class="el" href="ip__icmp_8h.html#fa0adb2fb9705db67f1145ab92d581a7" title="Timestamp reply type.">ICMP_TSTAMPREPLY</a> Timestamp reply</li><li><a class="el" href="ip__icmp_8h.html#3fd3b310a59aa6bad86a0c37a99aeb8c" title="Information request type.">ICMP_IREQ</a> Information request</li><li><a class="el" href="ip__icmp_8h.html#c25271988d45328dc281f8ed301d0b2a" title="Information reply type.">ICMP_IREQREPLY</a> Information reply</li><li><a class="el" href="ip__icmp_8h.html#d200822fc3735b19416dbd8376b02e37" title="Address mask request type.">ICMP_MASKREQ</a> Address mask request</li><li><a class="el" href="ip__icmp_8h.html#eecbd895301a4ebe549f270a6486b0c5" title="Address mask reply type.">ICMP_MASKREPLY</a> Address mask reply</li></ul>
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>Type of the ICMP message. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dest</em>&nbsp;</td><td>Destination IP address. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb</em>&nbsp;</td><td>Network buffer structure containing the datagram.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="icmpout_8c-source.html#l00159">159</a> of file <a class="el" href="icmpout_8c-source.html">icmpout.c</a>.</p>

<p>References <a class="el" href="ip__icmp_8h-source.html#l00169">ICMPHDR::icmp_cksum</a>, <a class="el" href="ip__icmp_8h-source.html#l00167">ICMPHDR::icmp_type</a>, <a class="el" href="in_8h-source.html#l00130">IPPROTO_ICMP</a>, <a class="el" href="ipcsum_8c-source.html#l00193">NutIpChkSum()</a>, <a class="el" href="ipcsum_8c-source.html#l00153">NutIpChkSumPartial()</a>, and <a class="el" href="ipout_8c-source.html#l00182">NutIpOutput()</a>.</p>

<p>Referenced by <a class="el" href="icmpout_8c-source.html#l00189">NutIcmpReply()</a>.</p>

</div>
</div><p>
<a class="anchor" name="ga1a3c8e2fce88cb2ed41e6bf106e49be"></a><!-- doxytag: member="icmpout.c::NutIcmpReply" ref="ga1a3c8e2fce88cb2ed41e6bf106e49be" args="(uint8_t type, uint8_t code, uint32_t spec, uint32_t dest, NETBUF *nb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutIcmpReply           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NETBUF *&nbsp;</td>
          <td class="paramname"> <em>nb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send an ICMP message to a given destination. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>Type of the ICMP message. See <a class="el" href="group__xg_i_c_m_p.html#g66717aa9878b74c9e5801996b7de7431" title="Send an ICMP datagram.">NutIcmpOutput()</a> for a list of valid types. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>code</em>&nbsp;</td><td>Type subcode. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>spec</em>&nbsp;</td><td>Type specific data item. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dest</em>&nbsp;</td><td>IP address of the target. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb</em>&nbsp;</td><td>Network buffer structure containing the message to be sent. The structure must have been allocated by a previous call <a class="el" href="group__xgnetbuf.html#g7a733aed1e6c15aaabb6657abe5f4e39" title="Allocate or re-allocate a network buffer part.">NutNetBufAlloc()</a> and will be freed if this function returns with an error.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="icmpout_8c-source.html#l00189">189</a> of file <a class="el" href="icmpout_8c-source.html">icmpout.c</a>.</p>

<p>References <a class="el" href="ip__icmp_8h-source.html#l00168">ICMPHDR::icmp_code</a>, <a class="el" href="ip__icmp_8h-source.html#l00170">ICMPHDR::icmp_spec</a>, <a class="el" href="netbuf_8h-source.html#l00131">NBAF_TRANSPORT</a>, <a class="el" href="icmpout_8c-source.html#l00159">NutIcmpOutput()</a>, and <a class="el" href="netbuf_8c-source.html#l00173">NutNetBufAlloc()</a>.</p>

<p>Referenced by <a class="el" href="icmpout_8c-source.html#l00219">NutIcmpResponse()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g387c1b71bb0ec69aa6467bdcedefbe26"></a><!-- doxytag: member="icmpout.c::NutIcmpResponse" ref="g387c1b71bb0ec69aa6467bdcedefbe26" args="(uint8_t type, uint8_t code, uint32_t spec, NETBUF *nb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int NutIcmpResponse           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__xg_crt_string.html#gba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&nbsp;</td>
          <td class="paramname"> <em>code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#06896e8c53f721507066c079052171f8">uint32_t</a>&nbsp;</td>
          <td class="paramname"> <em>spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NETBUF *&nbsp;</td>
          <td class="paramname"> <em>nb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send an ICMP message as a response to a given destination. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>Type of the ICMP message. See <a class="el" href="group__xg_i_c_m_p.html#g66717aa9878b74c9e5801996b7de7431" title="Send an ICMP datagram.">NutIcmpOutput()</a> for a list of valid types. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>code</em>&nbsp;</td><td>Type subcode. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>spec</em>&nbsp;</td><td>Type specific data item. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb</em>&nbsp;</td><td>Network buffer structure containing the previously recevied network packet. According to RFC792 the complete <a class="el" href="structip.html" title="Structure of an internet header.">ip</a> header and the first 8 bytes of the transport netbuf is used as the application data for the response. If this function returns with an error, the buffer is freed. The destination addess is taken from the <a class="el" href="structip.html" title="Structure of an internet header.">ip</a> header.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise. </dd></dl>

<p>Definition at line <a class="el" href="icmpout_8c-source.html#l00219">219</a> of file <a class="el" href="icmpout_8c-source.html">icmpout.c</a>.</p>

<p>References <a class="el" href="memcpy_8c-source.html#l00114">memcpy()</a>, <a class="el" href="netbuf_8h-source.html#l00132">NBAF_APPLICATION</a>, <a class="el" href="icmpout_8c-source.html#l00189">NutIcmpReply()</a>, and <a class="el" href="netbuf_8c-source.html#l00173">NutNetBufAlloc()</a>.</p>

<p>Referenced by <a class="el" href="ipin_8c-source.html#l00165">NutIpInput()</a>, and <a class="el" href="udpin_8c-source.html#l00158">NutUdpInput()</a>.</p>

</div>
</div><p>
</div>
<hr>
<address>
  <small>
    &copy;&nbsp;2000-2007 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
