GAS LISTING C:\Temp/cc8H3Mtf.s 			page 1


   1               		.file	"spibus0avr.c"
   2               	__SREG__ = 0x3f
   3               	__SP_H__ = 0x3e
   4               	__SP_L__ = 0x3d
   5               	__CCP__  = 0x34
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  10               		.text
  11               		.type	AvrSpi0ChipSelect, @function
  12               	AvrSpi0ChipSelect:
  13               	/* prologue: function */
  14               	/* frame size = 0 */
  15 0000 8130      		cpi r24,lo8(1)
  16 0002 01F0      		breq .L13
  17 0004 8130      		cpi r24,lo8(1)
  18 0006 00F0      		brlo .L3
  19 0008 8230      		cpi r24,lo8(2)
  20 000a 01F4      		brne .L12
  21 000c 00C0      		rjmp .L14
  22               	.L3:
  23 000e 6623      		tst r22
  24 0010 01F0      		breq .L7
  25 0012 C49A      		sbi 56-32,4
  26 0014 00C0      		rjmp .L8
  27               	.L7:
  28 0016 C498      		cbi 56-32,4
  29               	.L8:
  30 0018 BC9A      		sbi 55-32,4
  31               	.L13:
  32 001a 20E0      		ldi r18,lo8(0)
  33 001c 30E0      		ldi r19,hi8(0)
  34 001e 00C0      		rjmp .L6
  35               	.L14:
  36 0020 6623      		tst r22
  37 0022 01F0      		breq .L9
  38 0024 979A      		sbi 50-32,7
  39 0026 00C0      		rjmp .L10
  40               	.L9:
  41 0028 9798      		cbi 50-32,7
  42               	.L10:
  43 002a 8F9A      		sbi 49-32,7
  44 002c 00C0      		rjmp .L13
  45               	.L12:
  46 002e 85E0      		ldi r24,lo8(5)
  47 0030 90E0      		ldi r25,hi8(5)
  48 0032 9093 0000 		sts (errno)+1,r25
  49 0036 8093 0000 		sts errno,r24
  50 003a 2FEF      		ldi r18,lo8(-1)
  51 003c 3FEF      		ldi r19,hi8(-1)
  52               	.L6:
  53 003e C901      		movw r24,r18
  54               	/* epilogue start */
  55 0040 0895      		ret
  56               		.size	AvrSpi0ChipSelect, .-AvrSpi0ChipSelect
  57               		.type	AvrSpi0Interrupt, @function
GAS LISTING C:\Temp/cc8H3Mtf.s 			page 2


  58               	AvrSpi0Interrupt:
  59               	/* prologue: function */
  60               	/* frame size = 0 */
  61 0042 2FB1      		in r18,47-32
  62 0044 8091 0000 		lds r24,spi0_xc
  63 0048 9091 0000 		lds r25,(spi0_xc)+1
  64 004c 892B      		or r24,r25
  65 004e 01F0      		breq .L16
  66 0050 8091 0000 		lds r24,spi0_rxp
  67 0054 9091 0000 		lds r25,(spi0_rxp)+1
  68 0058 892B      		or r24,r25
  69 005a 01F0      		breq .L17
  70 005c E091 0000 		lds r30,spi0_rxp
  71 0060 F091 0000 		lds r31,(spi0_rxp)+1
  72 0064 2193      		st Z+,r18
  73 0066 F093 0000 		sts (spi0_rxp)+1,r31
  74 006a E093 0000 		sts spi0_rxp,r30
  75               	.L17:
  76 006e 8091 0000 		lds r24,spi0_xc
  77 0072 9091 0000 		lds r25,(spi0_xc)+1
  78 0076 0197      		sbiw r24,1
  79 0078 9093 0000 		sts (spi0_xc)+1,r25
  80 007c 8093 0000 		sts spi0_xc,r24
  81               	.L16:
  82 0080 8091 0000 		lds r24,spi0_xc
  83 0084 9091 0000 		lds r25,(spi0_xc)+1
  84 0088 892B      		or r24,r25
  85 008a 01F4      		brne .L18
  86 008c E091 0000 		lds r30,spi0_que
  87 0090 F091 0000 		lds r31,(spi0_que)+1
  88 0094 3097      		sbiw r30,0
  89 0096 01F4      		brne .L19
  90 0098 8FEF      		ldi r24,lo8(-1)
  91 009a 9FEF      		ldi r25,hi8(-1)
  92 009c 9093 0000 		sts (spi0_que)+1,r25
  93 00a0 8093 0000 		sts spi0_que,r24
  94 00a4 00C0      		rjmp .L18
  95               	.L19:
  96 00a6 8FEF      		ldi r24,hi8(-1)
  97 00a8 EF3F      		cpi r30,lo8(-1)
  98 00aa F807      		cpc r31,r24
  99 00ac 01F0      		breq .L18
 100 00ae 8481      		ldd r24,Z+4
 101 00b0 9581      		ldd r25,Z+5
 102 00b2 0196      		adiw r24,1
 103 00b4 9583      		std Z+5,r25
 104 00b6 8483      		std Z+4,r24
 105               	.L18:
 106 00b8 8091 0000 		lds r24,spi0_xc
 107 00bc 9091 0000 		lds r25,(spi0_xc)+1
 108 00c0 892B      		or r24,r25
 109 00c2 01F0      		breq .L22
 110 00c4 8091 0000 		lds r24,spi0_txp
 111 00c8 9091 0000 		lds r25,(spi0_txp)+1
 112 00cc 892B      		or r24,r25
 113 00ce 01F0      		breq .L21
 114 00d0 E091 0000 		lds r30,spi0_txp
GAS LISTING C:\Temp/cc8H3Mtf.s 			page 3


 115 00d4 F091 0000 		lds r31,(spi0_txp)+1
 116 00d8 2191      		ld r18,Z+
 117 00da F093 0000 		sts (spi0_txp)+1,r31
 118 00de E093 0000 		sts spi0_txp,r30
 119               	.L21:
 120 00e2 2FB9      		out 47-32,r18
 121               	.L22:
 122 00e4 0895      		ret
 123               		.size	AvrSpi0Interrupt, .-AvrSpi0Interrupt
 124               	.global	AvrSpiBus0Deselect
 125               		.type	AvrSpiBus0Deselect, @function
 126               	AvrSpiBus0Deselect:
 127 00e6 0F93      		push r16
 128 00e8 1F93      		push r17
 129               	/* prologue: function */
 130               	/* frame size = 0 */
 131 00ea 8C01      		movw r16,r24
 132 00ec FC01      		movw r30,r24
 133 00ee 8185      		ldd r24,Z+9
 134 00f0 682F      		mov r22,r24
 135 00f2 6295      		swap r22
 136 00f4 6695      		lsr r22
 137 00f6 6695      		lsr r22
 138 00f8 6370      		andi r22,lo8(3)
 139 00fa 6095      		com r22
 140 00fc 6170      		andi r22,lo8(1)
 141 00fe 8385      		ldd r24,Z+11
 142 0100 0E94 0000 		call AvrSpi0ChipSelect
 143 0104 F801      		movw r30,r16
 144 0106 8081      		ld r24,Z
 145 0108 9181      		ldd r25,Z+1
 146 010a 0E94 0000 		call NutEventPost
 147 010e 80E0      		ldi r24,lo8(0)
 148 0110 90E0      		ldi r25,hi8(0)
 149               	/* epilogue start */
 150 0112 1F91      		pop r17
 151 0114 0F91      		pop r16
 152 0116 0895      		ret
 153               		.size	AvrSpiBus0Deselect, .-AvrSpiBus0Deselect
 154               	.global	AvrSpiBus0Transfer
 155               		.type	AvrSpiBus0Transfer, @function
 156               	AvrSpiBus0Transfer:
 157               	/* prologue: function */
 158               	/* frame size = 0 */
 159 0118 2115      		cp r18,__zero_reg__
 160 011a 3105      		cpc r19,__zero_reg__
 161 011c 01F0      		breq .L26
 162 011e 7093 0000 		sts (spi0_txp)+1,r23
 163 0122 6093 0000 		sts spi0_txp,r22
 164 0126 5093 0000 		sts (spi0_rxp)+1,r21
 165 012a 4093 0000 		sts spi0_rxp,r20
 166 012e 3093 0000 		sts (spi0_xc)+1,r19
 167 0132 2093 0000 		sts spi0_xc,r18
 168 0136 8091 0000 		lds r24,spi0_txp
 169 013a 9091 0000 		lds r25,(spi0_txp)+1
 170 013e 892B      		or r24,r25
 171 0140 01F4      		brne .L27
GAS LISTING C:\Temp/cc8H3Mtf.s 			page 4


 172 0142 8FEF      		ldi r24,lo8(-1)
 173 0144 00C0      		rjmp .L28
 174               	.L27:
 175 0146 E091 0000 		lds r30,spi0_txp
 176 014a F091 0000 		lds r31,(spi0_txp)+1
 177 014e 8191      		ld r24,Z+
 178 0150 F093 0000 		sts (spi0_txp)+1,r31
 179 0154 E093 0000 		sts spi0_txp,r30
 180               	.L28:
 181 0158 6F9A      		sbi 45-32,7
 182 015a 8FB9      		out 47-32,r24
 183 015c 40E0      		ldi r20,lo8(0)
 184 015e 50E0      		ldi r21,hi8(0)
 185 0160 60E0      		ldi r22,hlo8(0)
 186 0162 70E0      		ldi r23,hhi8(0)
 187 0164 80E0      		ldi r24,lo8(spi0_que)
 188 0166 90E0      		ldi r25,hi8(spi0_que)
 189 0168 0E94 0000 		call NutEventWait
 190 016c 6F98      		cbi 45-32,7
 191               	.L26:
 192 016e 80E0      		ldi r24,lo8(0)
 193 0170 90E0      		ldi r25,hi8(0)
 194               	/* epilogue start */
 195 0172 0895      		ret
 196               		.size	AvrSpiBus0Transfer, .-AvrSpiBus0Transfer
 197               	.global	AvrSpiBus0Select
 198               		.type	AvrSpiBus0Select, @function
 199               	AvrSpiBus0Select:
 200 0174 0F93      		push r16
 201 0176 1F93      		push r17
 202 0178 CF93      		push r28
 203 017a DF93      		push r29
 204               	/* prologue: function */
 205               	/* frame size = 0 */
 206 017c 8C01      		movw r16,r24
 207 017e FC01      		movw r30,r24
 208 0180 8081      		ld r24,Z
 209 0182 9181      		ldd r25,Z+1
 210 0184 0E94 0000 		call NutEventWait
 211 0188 EC01      		movw r28,r24
 212 018a 0097      		sbiw r24,0
 213 018c 01F0      		breq .L31
 214 018e 85E0      		ldi r24,lo8(5)
 215 0190 90E0      		ldi r25,hi8(5)
 216 0192 9093 0000 		sts (errno)+1,r25
 217 0196 8093 0000 		sts errno,r24
 218 019a 00C0      		rjmp .L32
 219               	.L31:
 220 019c F801      		movw r30,r16
 221 019e C281      		ldd r28,Z+2
 222 01a0 D381      		ldd r29,Z+3
 223 01a2 8085      		ldd r24,Z+8
 224 01a4 9185      		ldd r25,Z+9
 225 01a6 97FF      		sbrs r25,7
 226 01a8 00C0      		rjmp .L33
 227 01aa C801      		movw r24,r16
 228 01ac 0E94 0000 		call AvrSpiSetup
GAS LISTING C:\Temp/cc8H3Mtf.s 			page 5


 229               	.L33:
 230 01b0 8881      		ld r24,Y
 231 01b2 83FF      		sbrs r24,3
 232 01b4 00C0      		rjmp .L34
 233 01b6 C198      		cbi 56-32,1
 234 01b8 00C0      		rjmp .L35
 235               	.L34:
 236 01ba C19A      		sbi 56-32,1
 237               	.L35:
 238 01bc B99A      		sbi 55-32,1
 239 01be C298      		cbi 56-32,2
 240 01c0 BA9A      		sbi 55-32,2
 241 01c2 B89B      		sbis 55-32,0
 242 01c4 C09A      		sbi 56-32,0
 243               	.L36:
 244 01c6 C39A      		sbi 56-32,3
 245 01c8 8DB9      		out 45-32,r24
 246 01ca 8981      		ldd r24,Y+1
 247 01cc 8EB9      		out 46-32,r24
 248 01ce 8EB1      		in r24,46-32
 249 01d0 8FB1      		in r24,47-32
 250 01d2 F801      		movw r30,r16
 251 01d4 6185      		ldd r22,Z+9
 252 01d6 6295      		swap r22
 253 01d8 6695      		lsr r22
 254 01da 6695      		lsr r22
 255 01dc 6170      		andi r22,lo8(1)
 256 01de 8385      		ldd r24,Z+11
 257 01e0 0E94 0000 		call AvrSpi0ChipSelect
 258 01e4 EC01      		movw r28,r24
 259 01e6 0097      		sbiw r24,0
 260 01e8 01F0      		breq .L32
 261 01ea F801      		movw r30,r16
 262 01ec 8081      		ld r24,Z
 263 01ee 9181      		ldd r25,Z+1
 264 01f0 0E94 0000 		call NutEventPost
 265               	.L32:
 266 01f4 CE01      		movw r24,r28
 267               	/* epilogue start */
 268 01f6 DF91      		pop r29
 269 01f8 CF91      		pop r28
 270 01fa 1F91      		pop r17
 271 01fc 0F91      		pop r16
 272 01fe 0895      		ret
 273               		.size	AvrSpiBus0Select, .-AvrSpiBus0Select
 274               	.global	AvrSpiBus0NodeInit
 275               		.type	AvrSpiBus0NodeInit, @function
 276               	AvrSpiBus0NodeInit:
 277 0200 0F93      		push r16
 278 0202 1F93      		push r17
 279 0204 CF93      		push r28
 280 0206 DF93      		push r29
 281               	/* prologue: function */
 282               	/* frame size = 0 */
 283 0208 EC01      		movw r28,r24
 284 020a 8985      		ldd r24,Y+9
 285 020c 682F      		mov r22,r24
GAS LISTING C:\Temp/cc8H3Mtf.s 			page 6


 286 020e 6295      		swap r22
 287 0210 6695      		lsr r22
 288 0212 6695      		lsr r22
 289 0214 6370      		andi r22,lo8(3)
 290 0216 6095      		com r22
 291 0218 6170      		andi r22,lo8(1)
 292 021a 8B85      		ldd r24,Y+11
 293 021c 0E94 0000 		call AvrSpi0ChipSelect
 294 0220 8C01      		movw r16,r24
 295 0222 0097      		sbiw r24,0
 296 0224 01F4      		brne .L39
 297 0226 8A81      		ldd r24,Y+2
 298 0228 9B81      		ldd r25,Y+3
 299 022a 892B      		or r24,r25
 300 022c 01F4      		brne .L39
 301 022e 82E0      		ldi r24,lo8(2)
 302 0230 90E0      		ldi r25,hi8(2)
 303 0232 0E94 0000 		call malloc
 304 0236 9B83      		std Y+3,r25
 305 0238 8A83      		std Y+2,r24
 306 023a 0097      		sbiw r24,0
 307 023c 01F4      		brne .L40
 308 023e 0FEF      		ldi r16,lo8(-1)
 309 0240 1FEF      		ldi r17,hi8(-1)
 310 0242 00C0      		rjmp .L39
 311               	.L40:
 312 0244 CE01      		movw r24,r28
 313 0246 0E94 0000 		call AvrSpiSetup
 314 024a E881      		ld r30,Y
 315 024c F981      		ldd r31,Y+1
 316 024e 40E0      		ldi r20,lo8(0)
 317 0250 50E0      		ldi r21,hi8(0)
 318 0252 60E0      		ldi r22,lo8(gs(AvrSpi0Interrupt))
 319 0254 70E0      		ldi r23,hi8(gs(AvrSpi0Interrupt))
 320 0256 8681      		ldd r24,Z+6
 321 0258 9781      		ldd r25,Z+7
 322 025a 0E94 0000 		call NutRegisterIrqHandler
 323               	.L39:
 324 025e C801      		movw r24,r16
 325               	/* epilogue start */
 326 0260 DF91      		pop r29
 327 0262 CF91      		pop r28
 328 0264 1F91      		pop r17
 329 0266 0F91      		pop r16
 330 0268 0895      		ret
 331               		.size	AvrSpiBus0NodeInit, .-AvrSpiBus0NodeInit
 332               	.global	spiBus0Avr
 333               		.data
 334               		.type	spiBus0Avr, @object
 335               		.size	spiBus0Avr, 24
 336               	spiBus0Avr:
 337 0000 0000      		.word	0
 338 0002 0000      		.word	0
 339 0004 0000      		.word	0
 340 0006 0000      		.word	sig_SPI
 341 0008 0000      		.word	gs(AvrSpiBus0NodeInit)
 342 000a 0000      		.word	gs(AvrSpiBus0Select)
GAS LISTING C:\Temp/cc8H3Mtf.s 			page 7


 343 000c 0000      		.word	gs(AvrSpiBus0Deselect)
 344 000e 0000      		.word	gs(AvrSpiBus0Transfer)
 345 0010 0000      		.word	gs(NutSpiBusWait)
 346 0012 0000      		.word	gs(NutSpiBusSetMode)
 347 0014 0000      		.word	gs(NutSpiBusSetRate)
 348 0016 0000      		.word	gs(NutSpiBusSetBits)
 349               		.lcomm spi0_txp,2
 350               		.lcomm spi0_rxp,2
 351               		.lcomm spi0_que,2
 352               		.lcomm spi0_xc,2
GAS LISTING C:\Temp/cc8H3Mtf.s 			page 8


DEFINED SYMBOLS
                            *ABS*:00000000 spibus0avr.c
  C:\Temp/cc8H3Mtf.s:2      *ABS*:0000003f __SREG__
  C:\Temp/cc8H3Mtf.s:3      *ABS*:0000003e __SP_H__
  C:\Temp/cc8H3Mtf.s:4      *ABS*:0000003d __SP_L__
  C:\Temp/cc8H3Mtf.s:5      *ABS*:00000034 __CCP__
  C:\Temp/cc8H3Mtf.s:6      *ABS*:00000000 __tmp_reg__
  C:\Temp/cc8H3Mtf.s:7      *ABS*:00000001 __zero_reg__
  C:\Temp/cc8H3Mtf.s:12     .text:00000000 AvrSpi0ChipSelect
  C:\Temp/cc8H3Mtf.s:58     .text:00000042 AvrSpi0Interrupt
  C:\Temp/cc8H3Mtf.s:351    .bss:00000006 spi0_xc
  C:\Temp/cc8H3Mtf.s:349    .bss:00000002 spi0_rxp
  C:\Temp/cc8H3Mtf.s:350    .bss:00000004 spi0_que
                             .bss:00000000 spi0_txp
  C:\Temp/cc8H3Mtf.s:126    .text:000000e6 AvrSpiBus0Deselect
  C:\Temp/cc8H3Mtf.s:156    .text:00000118 AvrSpiBus0Transfer
  C:\Temp/cc8H3Mtf.s:199    .text:00000174 AvrSpiBus0Select
  C:\Temp/cc8H3Mtf.s:276    .text:00000200 AvrSpiBus0NodeInit
  C:\Temp/cc8H3Mtf.s:336    .data:00000000 spiBus0Avr

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
errno
NutEventPost
NutEventWait
AvrSpiSetup
malloc
NutRegisterIrqHandler
sig_SPI
NutSpiBusWait
NutSpiBusSetMode
NutSpiBusSetRate
NutSpiBusSetBits
