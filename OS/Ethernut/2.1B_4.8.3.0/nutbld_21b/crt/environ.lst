GAS LISTING C:\Temp/ccJ5Vrd6.s 			page 1


   1               		.file	"environ.c"
   2               	__SREG__ = 0x3f
   3               	__SP_H__ = 0x3e
   4               	__SP_L__ = 0x3d
   5               	__CCP__  = 0x34
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  10               		.text
  11               		.type	read_string, @function
  12               	read_string:
  13 0000 8F92      		push r8
  14 0002 9F92      		push r9
  15 0004 AF92      		push r10
  16 0006 BF92      		push r11
  17 0008 CF92      		push r12
  18 000a DF92      		push r13
  19 000c EF92      		push r14
  20 000e FF92      		push r15
  21 0010 0F93      		push r16
  22 0012 1F93      		push r17
  23 0014 DF93      		push r29
  24 0016 CF93      		push r28
  25 0018 0F92      		push __tmp_reg__
  26 001a CDB7      		in r28,__SP_L__
  27 001c DEB7      		in r29,__SP_H__
  28               	/* prologue: function */
  29               	/* frame size = 1 */
  30 001e 6C01      		movw r12,r24
  31 0020 7B01      		movw r14,r22
  32 0022 5A01      		movw r10,r20
  33 0024 00E0      		ldi r16,lo8(0)
  34 0026 10E0      		ldi r17,hi8(0)
  35 0028 4E01      		movw r8,r28
  36 002a 0894      		sec
  37 002c 811C      		adc r8,__zero_reg__
  38 002e 911C      		adc r9,__zero_reg__
  39               	.L5:
  40 0030 41E0      		ldi r20,lo8(1)
  41 0032 50E0      		ldi r21,hi8(1)
  42 0034 B401      		movw r22,r8
  43 0036 F601      		movw r30,r12
  44 0038 8081      		ld r24,Z
  45 003a 9181      		ldd r25,Z+1
  46 003c 0E94 0000 		call NutNvMemLoad
  47 0040 892B      		or r24,r25
  48 0042 01F0      		breq .L2
  49 0044 00E0      		ldi r16,lo8(0)
  50 0046 10E0      		ldi r17,hi8(0)
  51 0048 00C0      		rjmp .L3
  52               	.L2:
  53 004a F601      		movw r30,r12
  54 004c 8081      		ld r24,Z
  55 004e 9181      		ldd r25,Z+1
  56 0050 0196      		adiw r24,1
  57 0052 9183      		std Z+1,r25
GAS LISTING C:\Temp/ccJ5Vrd6.s 			page 2


  58 0054 8083      		st Z,r24
  59 0056 8981      		ldd r24,Y+1
  60 0058 8823      		tst r24
  61 005a 01F0      		breq .L3
  62 005c E114      		cp r14,__zero_reg__
  63 005e F104      		cpc r15,__zero_reg__
  64 0060 01F0      		breq .L4
  65 0062 F701      		movw r30,r14
  66 0064 8193      		st Z+,r24
  67 0066 7F01      		movw r14,r30
  68               	.L4:
  69 0068 0F5F      		subi r16,lo8(-(1))
  70 006a 1F4F      		sbci r17,hi8(-(1))
  71 006c A016      		cp r10,r16
  72 006e B106      		cpc r11,r17
  73 0070 00F4      		brsh .L5
  74               	.L3:
  75 0072 E114      		cp r14,__zero_reg__
  76 0074 F104      		cpc r15,__zero_reg__
  77 0076 01F0      		breq .L6
  78 0078 F701      		movw r30,r14
  79 007a 1082      		st Z,__zero_reg__
  80               	.L6:
  81 007c C801      		movw r24,r16
  82               	/* epilogue start */
  83 007e 0F90      		pop __tmp_reg__
  84 0080 CF91      		pop r28
  85 0082 DF91      		pop r29
  86 0084 1F91      		pop r17
  87 0086 0F91      		pop r16
  88 0088 FF90      		pop r15
  89 008a EF90      		pop r14
  90 008c DF90      		pop r13
  91 008e CF90      		pop r12
  92 0090 BF90      		pop r11
  93 0092 AF90      		pop r10
  94 0094 9F90      		pop r9
  95 0096 8F90      		pop r8
  96 0098 0895      		ret
  97               		.size	read_string, .-read_string
  98               	.global	findenv
  99               		.type	findenv, @function
 100               	findenv:
 101 009a 3F92      		push r3
 102 009c 4F92      		push r4
 103 009e 5F92      		push r5
 104 00a0 6F92      		push r6
 105 00a2 7F92      		push r7
 106 00a4 8F92      		push r8
 107 00a6 9F92      		push r9
 108 00a8 AF92      		push r10
 109 00aa BF92      		push r11
 110 00ac CF92      		push r12
 111 00ae DF92      		push r13
 112 00b0 EF92      		push r14
 113 00b2 FF92      		push r15
 114 00b4 0F93      		push r16
GAS LISTING C:\Temp/ccJ5Vrd6.s 			page 3


 115 00b6 1F93      		push r17
 116 00b8 DF93      		push r29
 117 00ba CF93      		push r28
 118 00bc 00D0      		rcall .
 119 00be 00D0      		rcall .
 120 00c0 00D0      		rcall .
 121 00c2 CDB7      		in r28,__SP_L__
 122 00c4 DEB7      		in r29,__SP_H__
 123               	/* prologue: function */
 124               	/* frame size = 6 */
 125 00c6 2C01      		movw r4,r24
 126 00c8 8091 0000 		lds r24,nut_environ
 127 00cc 9091 0000 		lds r25,(nut_environ)+1
 128 00d0 892B      		or r24,r25
 129 00d2 01F0      		breq .+2
 130 00d4 00C0      		rjmp .L10
 131 00d6 80E0      		ldi r24,lo8(256)
 132 00d8 91E0      		ldi r25,hi8(256)
 133 00da 9A83      		std Y+2,r25
 134 00dc 8983      		std Y+1,r24
 135 00de 44E0      		ldi r20,lo8(4)
 136 00e0 50E0      		ldi r21,hi8(4)
 137 00e2 BE01      		movw r22,r28
 138 00e4 6D5F      		subi r22,lo8(-(3))
 139 00e6 7F4F      		sbci r23,hi8(-(3))
 140 00e8 0E94 0000 		call NutNvMemLoad
 141 00ec 892B      		or r24,r25
 142 00ee 01F0      		breq .+2
 143 00f0 00C0      		rjmp .L10
 144 00f2 8B81      		ldd r24,Y+3
 145 00f4 9C81      		ldd r25,Y+4
 146 00f6 AD81      		ldd r26,Y+5
 147 00f8 BE81      		ldd r27,Y+6
 148 00fa 8554      		subi r24,lo8(5656133)
 149 00fc 9E44      		sbci r25,hi8(5656133)
 150 00fe A645      		sbci r26,hlo8(5656133)
 151 0100 B040      		sbci r27,hhi8(5656133)
 152 0102 01F0      		breq .+2
 153 0104 00C0      		rjmp .L10
 154 0106 8981      		ldd r24,Y+1
 155 0108 9A81      		ldd r25,Y+2
 156 010a 0496      		adiw r24,4
 157 010c 9A83      		std Y+2,r25
 158 010e 8983      		std Y+1,r24
 159 0110 8824      		clr r8
 160 0112 9924      		clr r9
 161 0114 7E01      		movw r14,r28
 162 0116 0894      		sec
 163 0118 E11C      		adc r14,__zero_reg__
 164 011a F11C      		adc r15,__zero_reg__
 165 011c 00C0      		rjmp .L27
 166               	.L14:
 167 011e 40E4      		ldi r20,lo8(64)
 168 0120 50E0      		ldi r21,hi8(64)
 169 0122 60E0      		ldi r22,lo8(0)
 170 0124 70E0      		ldi r23,hi8(0)
 171 0126 C701      		movw r24,r14
GAS LISTING C:\Temp/ccJ5Vrd6.s 			page 4


 172 0128 0E94 0000 		call read_string
 173 012c 9C01      		movw r18,r24
 174 012e C801      		movw r24,r16
 175 0130 0217      		cp r16,r18
 176 0132 1307      		cpc r17,r19
 177 0134 00F4      		brsh .L12
 178 0136 C901      		movw r24,r18
 179               	.L12:
 180 0138 8816      		cp r8,r24
 181 013a 9906      		cpc r9,r25
 182 013c 00F4      		brsh .L27
 183 013e 4C01      		movw r8,r24
 184               	.L27:
 185 0140 40E4      		ldi r20,lo8(64)
 186 0142 50E0      		ldi r21,hi8(64)
 187 0144 60E0      		ldi r22,lo8(0)
 188 0146 70E0      		ldi r23,hi8(0)
 189 0148 C701      		movw r24,r14
 190 014a 0E94 0000 		call read_string
 191 014e 8C01      		movw r16,r24
 192 0150 0097      		sbiw r24,0
 193 0152 01F4      		brne .L14
 194 0154 84E0      		ldi r24,lo8(260)
 195 0156 91E0      		ldi r25,hi8(260)
 196 0158 9A83      		std Y+2,r25
 197 015a 8983      		std Y+1,r24
 198 015c 8114      		cp r8,__zero_reg__
 199 015e 9104      		cpc r9,__zero_reg__
 200 0160 01F4      		brne .+2
 201 0162 00C0      		rjmp .L10
 202 0164 C401      		movw r24,r8
 203 0166 0196      		adiw r24,1
 204 0168 0E94 0000 		call malloc
 205 016c 7C01      		movw r14,r24
 206 016e 0097      		sbiw r24,0
 207 0170 01F4      		brne .+2
 208 0172 00C0      		rjmp .L10
 209 0174 AA24      		clr r10
 210 0176 BB24      		clr r11
 211 0178 3E01      		movw r6,r28
 212 017a 0894      		sec
 213 017c 611C      		adc r6,__zero_reg__
 214 017e 711C      		adc r7,__zero_reg__
 215 0180 88E0      		ldi r24,lo8(8)
 216 0182 382E      		mov r3,r24
 217 0184 00C0      		rjmp .L15
 218               	.L20:
 219 0186 88E0      		ldi r24,lo8(8)
 220 0188 90E0      		ldi r25,hi8(8)
 221 018a 0E94 0000 		call malloc
 222 018e 8C01      		movw r16,r24
 223 0190 0097      		sbiw r24,0
 224 0192 01F0      		breq .L16
 225 0194 FC01      		movw r30,r24
 226 0196 232D      		mov r18,r3
 227 0198 1192      		st Z+,__zero_reg__
 228 019a 2A95      	        dec r18
GAS LISTING C:\Temp/ccJ5Vrd6.s 			page 5


 229 019c 01F4      		brne .-6
 230 019e C601      		movw r24,r12
 231 01a0 0196      		adiw r24,1
 232 01a2 0E94 0000 		call malloc
 233 01a6 F801      		movw r30,r16
 234 01a8 9583      		std Z+5,r25
 235 01aa 8483      		std Z+4,r24
 236 01ac 0097      		sbiw r24,0
 237 01ae 01F4      		brne .L17
 238 01b0 C801      		movw r24,r16
 239 01b2 0E94 0000 		call free
 240 01b6 00C0      		rjmp .L16
 241               	.L17:
 242 01b8 B701      		movw r22,r14
 243 01ba 0E94 0000 		call strcpy
 244 01be A401      		movw r20,r8
 245 01c0 B701      		movw r22,r14
 246 01c2 C301      		movw r24,r6
 247 01c4 0E94 0000 		call read_string
 248 01c8 0196      		adiw r24,1
 249 01ca 0E94 0000 		call malloc
 250 01ce F801      		movw r30,r16
 251 01d0 9783      		std Z+7,r25
 252 01d2 8683      		std Z+6,r24
 253 01d4 0097      		sbiw r24,0
 254 01d6 01F0      		breq .L16
 255 01d8 B701      		movw r22,r14
 256 01da 0E94 0000 		call strcpy
 257 01de A114      		cp r10,__zero_reg__
 258 01e0 B104      		cpc r11,__zero_reg__
 259 01e2 01F0      		breq .L18
 260 01e4 F501      		movw r30,r10
 261 01e6 1183      		std Z+1,r17
 262 01e8 0083      		st Z,r16
 263 01ea F801      		movw r30,r16
 264 01ec B382      		std Z+3,r11
 265 01ee A282      		std Z+2,r10
 266 01f0 00C0      		rjmp .L19
 267               	.L18:
 268 01f2 1093 0000 		sts (nut_environ)+1,r17
 269 01f6 0093 0000 		sts nut_environ,r16
 270               	.L19:
 271 01fa 5801      		movw r10,r16
 272               	.L15:
 273 01fc A401      		movw r20,r8
 274 01fe B701      		movw r22,r14
 275 0200 C301      		movw r24,r6
 276 0202 0E94 0000 		call read_string
 277 0206 6C01      		movw r12,r24
 278 0208 0097      		sbiw r24,0
 279 020a 01F0      		breq .+2
 280 020c 00C0      		rjmp .L20
 281               	.L16:
 282 020e C701      		movw r24,r14
 283 0210 0E94 0000 		call free
 284               	.L10:
 285 0214 0091 0000 		lds r16,nut_environ
GAS LISTING C:\Temp/ccJ5Vrd6.s 			page 6


 286 0218 1091 0000 		lds r17,(nut_environ)+1
 287 021c 00C0      		rjmp .L21
 288               	.L23:
 289 021e B201      		movw r22,r4
 290 0220 F801      		movw r30,r16
 291 0222 8481      		ldd r24,Z+4
 292 0224 9581      		ldd r25,Z+5
 293 0226 0E94 0000 		call strcmp
 294 022a 0097      		sbiw r24,0
 295 022c 01F0      		breq .L22
 296 022e F801      		movw r30,r16
 297 0230 0081      		ld r16,Z
 298 0232 1181      		ldd r17,Z+1
 299               	.L21:
 300 0234 0115      		cp r16,__zero_reg__
 301 0236 1105      		cpc r17,__zero_reg__
 302 0238 01F4      		brne .L23
 303               	.L22:
 304 023a C801      		movw r24,r16
 305               	/* epilogue start */
 306 023c 2696      		adiw r28,6
 307 023e 0FB6      		in __tmp_reg__,__SREG__
 308 0240 F894      		cli
 309 0242 DEBF      		out __SP_H__,r29
 310 0244 0FBE      		out __SREG__,__tmp_reg__
 311 0246 CDBF      		out __SP_L__,r28
 312 0248 CF91      		pop r28
 313 024a DF91      		pop r29
 314 024c 1F91      		pop r17
 315 024e 0F91      		pop r16
 316 0250 FF90      		pop r15
 317 0252 EF90      		pop r14
 318 0254 DF90      		pop r13
 319 0256 CF90      		pop r12
 320 0258 BF90      		pop r11
 321 025a AF90      		pop r10
 322 025c 9F90      		pop r9
 323 025e 8F90      		pop r8
 324 0260 7F90      		pop r7
 325 0262 6F90      		pop r6
 326 0264 5F90      		pop r5
 327 0266 4F90      		pop r4
 328 0268 3F90      		pop r3
 329 026a 0895      		ret
 330               		.size	findenv, .-findenv
 331               		.comm nut_environ,2,1
GAS LISTING C:\Temp/ccJ5Vrd6.s 			page 7


DEFINED SYMBOLS
                            *ABS*:00000000 environ.c
  C:\Temp/ccJ5Vrd6.s:2      *ABS*:0000003f __SREG__
  C:\Temp/ccJ5Vrd6.s:3      *ABS*:0000003e __SP_H__
  C:\Temp/ccJ5Vrd6.s:4      *ABS*:0000003d __SP_L__
  C:\Temp/ccJ5Vrd6.s:5      *ABS*:00000034 __CCP__
  C:\Temp/ccJ5Vrd6.s:6      *ABS*:00000000 __tmp_reg__
  C:\Temp/ccJ5Vrd6.s:7      *ABS*:00000001 __zero_reg__
  C:\Temp/ccJ5Vrd6.s:12     .text:00000000 read_string
  C:\Temp/ccJ5Vrd6.s:100    .text:0000009a findenv
                            *COM*:00000002 nut_environ

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
NutNvMemLoad
malloc
free
strcpy
strcmp
